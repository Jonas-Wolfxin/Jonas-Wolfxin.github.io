(window.webpackJsonp=window.webpackJsonp||[]).push([[175],{775:function(s,a,t){"use strict";t.r(a);var n=t(14),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"playbook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook"}},[s._v("#")]),s._v(" playbook")]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("Playbook采用YAML语言编写")]),s._v(" "),t("li",[s._v('playbook是由一个或多个"play"组成的列表')]),s._v(" "),t("li",[s._v("play的主要功能在于将事先归为一组的主机，装扮成事先通过ansible中的task定义好的角色。")]),s._v(" "),t("li",[s._v("Task实际是调用ansible的一个module，将多个play组织在一个playbook中，即可以让它们联合起来，按事先编排的机制执行预定义的动作")])])]),s._v(" "),t("blockquote",[t("h5",{attrs:{id:"playbook的语法规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook的语法规则"}},[s._v("#")]),s._v(" Playbook的语法规则")]),s._v(" "),t("ul",[t("li",[s._v("用连续三个连字号(——)区分多个档案。另外，还有选择性的连续三个点号( ... )用来表示档案结尾")]),s._v(" "),t("li",[s._v("次行开始正常写Playbook的内容，一般建议写明该Playbook的功能")]),s._v(" "),t("li",[s._v("一个完整的代码块功能需最少元素需包括 name 和 task")]),s._v(" "),t("li",[s._v("一个name只能包括一个task")]),s._v(" "),t("li",[s._v("YAML文件扩展名通常为"),t("code",[s._v(".yml")]),s._v("或"),t("code",[s._v("yaml")]),s._v(";")])])]),s._v(" "),t("h3",{attrs:{id:"playbook执行过程图解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook执行过程图解"}},[s._v("#")]),s._v(" playbook执行过程图解")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303270343435.png",alt:"image-20230327034325126"}})]),s._v(" "),t("ol",[t("li",[s._v("用户通过ansible命令直接调用yml语言写好的playbook;")]),s._v(" "),t("li",[s._v("playbook由多条play组成, 每条play都有一个任务(task)相对应的操作;")]),s._v(" "),t("li",[s._v("然后调用模块modules，应用在主机清单上;")]),s._v(" "),t("li",[s._v("通过ssh远程连接, 从而控制远程主机或者网络设备")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"yaml介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yaml介绍"}},[s._v("#")]),s._v(" YAML介绍")]),s._v(" "),t("blockquote",[t("ul",[t("li",[t("p",[s._v("YAML (Yet Another Markup Language）是一种轻量级的数据序列化格式，通常用于配置文件、数据交换和应用程序间的通信。它被设计为易于人类阅读和编写，并且可以轻松地被机器解析和生成。")])]),s._v(" "),t("li",[t("p",[s._v("YAML 使用空格缩进表示层级关系，而不是像 XML 或 JSON 那样使用标记或符号。它还支持注释、多行字符串和包含其它文件的引用，这些特性使得 YAML 文件更加易于维护和阅读。")])]),s._v(" "),t("li",[t("p",[s._v("YAML 可以用于许多不同的编程语言和平台，并且已被广泛采用，比如在各种开源项目、配置文件和持续集成/部署工具中使用。）")])]),s._v(" "),t("li",[t("p",[s._v("在YAML中，数据通常以键值对的形式表示，并使用缩进来表示嵌套关系。它还支持数组、列表、映射、多行字符串等数据结构。")])])]),s._v(" "),t("h4",{attrs:{id:"特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[s._v("#")]),s._v(" 特性")]),s._v(" "),t("ol",[t("li",[s._v("易读性：YAML使用缩进来表示嵌套关系，同时也支持多种数据结构，这些特性使得YAML易读且易于理解。")]),s._v(" "),t("li",[s._v("易于编写：YAML使用简洁的语法结构，不需要繁琐的标记或语法，使得编写YAML文件非常方便。")]),s._v(" "),t("li",[s._v("可扩展性：YAML支持通过引用和锚点来引用其他部分的数据，这使得YAML文件可以被轻松地扩展和重用。")]),s._v(" "),t("li",[s._v("易于与多种编程语言集成：由于YAML的简洁性和可读性，许多编程语言都有相应的YAML解析库和工具，可以方便地将YAML与多种编程语言集成。")]),s._v(" "),t("li",[s._v("支持注释：YAML支持注释，开发者可以在文件中添加注释以提高可读性和可维护性。")]),s._v(" "),t("li",[s._v("支持多种数据类型：YAML支持多种数据类型，包括字符串、整数、浮点数、布尔值、数组、映射等。")]),s._v(" "),t("li",[s._v("可移植性：YAML文件可以在不同的操作系统和平台上使用，并且不会因为平台或操作系统的不同而出现问题。")])]),s._v(" "),t("p",[s._v("总的来说，YAML是一种灵活、易读、易写、可扩展、易于集成和可移植的数据序列化格式。")]),s._v(" "),t("p",[s._v("更多的内容及规范参见："),t("a",{attrs:{href:"http://www.yaml.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://www.yaml.org"),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"yaml语法简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yaml语法简介"}},[s._v("#")]),s._v(" YAML语法简介")]),s._v(" "),t("p",[s._v("YAML（Yet Another Markup Language）是一种简单易读的数据序列化语言。以下是YAML的语法：")]),s._v(" "),t("blockquote",[t("h5",{attrs:{id:"yaml的基本语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yaml的基本语法"}},[s._v("#")]),s._v(" YAML的基本语法：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("键值对：YAML中的键值对使用冒号“:”来分隔，键值对应用"),t("code",[s._v("键: 值")]),s._v("的格式表示。YAML文件内容是区别大小写的，"),t("code",[s._v("key: value")]),s._v(" 的值均需大小写敏感; 多个"),t("code",[s._v("key: value")]),s._v("可同行写也可换行写.")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Key：使用冒号"),t("code",[s._v(":")]),s._v("表示键值对，键必须是"),t("strong",[s._v("字符串")]),s._v("类型。")])]),s._v(" "),t("li",[t("p",[s._v("Value：YAML中的值可以是标量值、序列或映射。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("标量值：字符串、整数、浮点数、布尔值、Null等")]),s._v(" "),t("ul",[t("li",[s._v("字符串：字符串可以使用"),t("strong",[s._v("单引号")]),s._v("或"),t("strong",[s._v("双引号")]),s._v("包裹，"),t("em",[s._v("单引号表示纯量字符串，双引号表示含有转义字符的字符串")]),s._v("。")]),s._v(" "),t("li",[s._v("整数：十进制、八进制、十六进制等整数。")]),s._v(" "),t("li",[s._v("浮点数：包括小数、指数等。")]),s._v(" "),t("li",[s._v("布尔值：true或false。")]),s._v(" "),t("li",[s._v("空值：null。")])])]),s._v(" "),t("li",[t("p",[s._v("序列：用短横线"),t("code",[s._v("-")]),s._v("表示，表示列表或数组")])]),s._v(" "),t("li",[t("p",[s._v("映射：使用冒号"),t("code",[s._v(":")]),s._v("表示键值对，键值对之间使用换行符表示")])])])])])]),s._v(" "),t("li",[t("p",[s._v("注释：使用 hashtag"),t("code",[s._v("#")]),s._v("表示，可以在一行的任何位置添加注释，以#号开头。")])]),s._v(" "),t("li",[t("p",[s._v("缩进：缩进是YAML的一个重要概念。它表示了数据的层次结构和嵌套关系。")]),s._v(" "),t("ul",[t("li",[s._v("缩进必须是统一的，不能空格和tab混用; 一般使用空格表示，每个层次结构缩进两个空格。")]),s._v(" "),t("li",[s._v("缩进的级别也必须是一致的，同样的缩进代表同样的级别，程序判别配置的级别是通过缩进结合换行来实现的")])])]),s._v(" "),t("li",[t("p",[s._v("引用：使用"),t("code",[s._v("&")]),s._v("符号表示引用，使用"),t("code",[s._v("*")]),s._v("符号表示引用的位置。")])]),s._v(" "),t("li",[t("p",[s._v("YAML使用空格来表示缩进，缩进的空格数目必须一致。")])])])]),s._v(" "),t("h4",{attrs:{id:"列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#列表"}},[s._v("#")]),s._v(" 列表")]),s._v(" "),t("p",[s._v("List：列表，是一个有序的集合，每个元素以短横线“-”开头，可以包含任意数据类型，例如:")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A list of tasty fruits")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Apple\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Orange\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Strawberry\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Mango\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"字典"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字典"}},[s._v("#")]),s._v(" 字典")]),s._v(" "),t("p",[s._v("字典是一个无序的集合，每个元素包含一个键值对，以冒号“:”分隔，例如：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" John Doe  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 字典")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("age")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 值是另一个字典")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("city")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" New York\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NY\n  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以将key:value放置于{}中进行表示，用,分隔多个key:value; 示例：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Jonas Wolfxin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DevOps Engineer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("skill")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 冒号后有空格")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注释"}},[s._v("#")]),s._v(" 注释")]),s._v(" "),t("p",[s._v("注释以井号“#”开头，可以出现在任意位置。")]),s._v(" "),t("h4",{attrs:{id:"多行字符串"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多行字符串"}},[s._v("#")]),s._v(" 多行字符串")]),s._v(" "),t("p",[s._v("YAML支持多行字符串，用竖线“|”表示，例如：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vbnetCopy codedescription")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n  This is a\n  multiline\n  string.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("使用大于号"),t("code",[s._v(">")]),s._v("表示折叠式多行文本块，将换行符替换为空格，但保留文本块末尾的一个换行符。")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vbnetCopy codedescription")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n  This is a\n  multiline\n  string.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"yaml示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yaml示例"}},[s._v("#")]),s._v(" YAML示例")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# YAML的语法和其他高阶语言类似，并且可以简单表达清单、散列表、标量等数据结构。其结构（Structure）通过空格来展示，序列（Sequence）里的项用"-"来代表，Map里的键值对用":"分隔. 示例')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" John Smith\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("age")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Male\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spouse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Jane Smith\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("age")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Female\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("children")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Jimmy Smith\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("age")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Male\n    \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Jenny Smith\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("age")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gender")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Female\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h3",{attrs:{id:"三种常见的数据交换格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三种常见的数据交换格式"}},[s._v("#")]),s._v(" 三种常见的数据交换格式")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303270431817.png",alt:"よく見るデータ形式(xlsx, csv, xml, json, yaml) の違いについて - Qiita"}})]),s._v(" "),t("blockquote",[t("h5",{attrs:{id:"区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#区别"}},[s._v("#")]),s._v(" 区别")]),s._v(" "),t("ul",[t("li",[s._v("XML使用标记语言，使用开始和结束标签表示元素;")]),s._v(" "),t("li",[s._v("JSON使用键值对的方式表示数据;")]),s._v(" "),t("li",[s._v("YAML使用缩进来表示层次结构;")])]),s._v(" "),t("h5",{attrs:{id:"相似"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#相似"}},[s._v("#")]),s._v(" 相似")]),s._v(" "),t("p",[s._v("这些数据格式都支持各种数据类型，如字符串、数字、布尔值、数组和对象等。对于更复杂的数据结构，XML和YAML通常更适合，因为它们支持更复杂的嵌套和结构。对于简单的数据结构，JSON通常更为常用，因为它的语法比较简洁。")])]),s._v(" "),t("h2",{attrs:{id:"playbook核心元素"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook核心元素"}},[s._v("#")]),s._v(" Playbook核心元素")]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("Hosts          执行的远程主机列表(应用在哪些主机上)")]),s._v(" "),t("li",[s._v("Tasks          任务集")]),s._v(" "),t("li",[s._v("Variables      内置变量或自定义变量在playbook中调用")]),s._v(" "),t("li",[s._v("Templates模板  可替换模板文件中的变量并实现一些简单逻辑的文件")]),s._v(" "),t("li",[s._v("Handlers和notify结合使用，由特定条件触发的操作，满足条件方才执行，否则不执行")]),s._v(" "),t("li",[s._v("tags标签       指定某条任务执行，用于选择运行playbook中的部分代码。\nansible具有幂等性，因此会自动跳过没有变化的部分，\n即便如此，有些代码为测试其确实没有发生变化的时间依然会非常地长。\n此时，如果确信其没有变化，就可以通过tags跳过此些代码片断\nansible-playbook -t tagsname useradd.yml")])])]),s._v(" "),t("h3",{attrs:{id:"playbook基础组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook基础组件"}},[s._v("#")]),s._v(" playbook基础组件")]),s._v(" "),t("blockquote",[t("h4",{attrs:{id:"hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hosts"}},[s._v("#")]),s._v(" hosts")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("playbook中的每一个play的目的都是为了让特定主机以某个指定的用户身份执行任务。hosts用于指定要执行指定任务的主机，须事先定义在inventory中; 可以是如下形式：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("```yaml\none.example.com\none.example.com:two.example.com\n192.168.1.50\n192.168.1.*\nWebsrvs:dbsrvs       或者，两个组的并集\nWebsrvs:&dbsrvs      与，两个组的交集\nwebservers:!phoenix  在websrvs组，但不在dbsrvs组\n            \n# 示例: \n- hosts: websrvs:dbsrvs\n```\n")])])])])]),s._v(" "),t("h4",{attrs:{id:"remote-user"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remote-user"}},[s._v("#")]),s._v(" remote_user")]),s._v(" "),t("p",[s._v("​    可用于Host和task中。\n​    也可以通过指定其通过sudo的方式在远程主机上执行任务，其可用于play全局或某任务；\n​    此外，甚至可以在sudo时使用sudo_user指定sudo时切换的用户")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" websrvs\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root   (可省略"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("默认为root)  以root身份连接\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    指定任务\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test connection\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" magedu\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sudo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认sudo为root")]),s._v("\n      sudo_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("wang     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo为wang")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h4",{attrs:{id:"tasks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tasks"}},[s._v("#")]),s._v(" tasks")]),s._v(" "),t("p",[s._v("任务列表task:由多个动作,多个任务组合起来的,每个任务都调用了模块,一个模块一个模块执行")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("play的主体部分是task list，task list中的各任务按次序逐个在hosts中指定的所有主机上执行， 即在所有主机上完成第一个任务后，再开始第二个任务;")])]),s._v(" "),t("li",[t("p",[s._v("task的目的是使用指定的参数执行模块，而在模块参数中可以使用变量。模块执行是幂等的，这意味着多次执行是安全的，因为其结果均一致")])]),s._v(" "),t("li",[t("p",[s._v("每个task都应该有其name，用于playbook的执行结果输出，建议其内容能清晰地描述任务执行步骤。如果未提供name，则action的结果将用于输出.")])]),s._v(" "),t("li",[t("p",[s._v("tasks：任务列表\n两种格式：\n(1) action: module arguments\n(2) module: arguments     # 更加简单, 建议使用\n注意：shell和command模块后面跟命令，而非key=value")])]),s._v(" "),t("li",[t("p",[s._v('某任务的状态在运行后为changed时，可通过"notify"通知给相应的handlers.')]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v('任务可以通过"tags"打标签，可在ansible-playbook命令上使用-t指定进行调用\n示例：\n     \n```yaml\ntasks:\n  - name: disable selinux   # 描述\n    command: /sbin/setenforce 0   # 模块名: 模块对应的参数\n```\n')])])])])])]),s._v(" "),t("blockquote",[t("p",[s._v("如果命令或脚本的退出码不为零，可以使用如下方式忽略过程中出现的错误, 继续将.yml文件执行下去")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" run this command and ignore the result\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/bin/somecommand "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" /bin/true  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果||之前的命令失败, 则执行 true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("或者使用ignore_errors来忽略错误信息")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" run this command and ignore the result\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/bin/somecommand\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ignore_errors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("True")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略错误")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("p",[s._v("example.yaml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" netnodes\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" create new file\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=/root/newfile state=touch\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create new user\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=user2 shell=/sbin/nologin\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install package\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" copy httpd index.html\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=/var/www/html/index.html dest=/var/www/html/index.html\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" start httpd service\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd state=started enabled=true\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" allow http access\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" firewall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cmd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service=http "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("permanent\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reload firewall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cmd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" firewall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cmd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h3",{attrs:{id:"运行playbook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行playbook"}},[s._v("#")]),s._v(" 运行playbook")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("ansible-playbook "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("filename.yml"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n常见选项\n    -C --check       只检测可能会发生的改变，但不真正执行操作 \n                     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("只检查语法,如果执行过程中出现问题,-C无法检测出来"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("执行playbook生成的文件不存在,后面的程序如果依赖这些文件,也会导致检测失败"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    --list-hosts     列出运行任务的主机\n    --list-tags      列出tag  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("列出标签"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    --list-tasks     列出task "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("列出任务"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    --limit  主机列表 只针对主机列表中的主机执行\n    -v -vv -vvv      显示过程\n\n示例\n    ansible-playbook hello.yml --check 只检测\n    ansible-playbook hello.yml --list-hosts  显示运行任务的主机\n    ansible-playbook hello.yml --limit websrvs  限制主机\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook -C example.yml  # 检查.yml文件是否存在语法错误")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook example.yml   # 执行 .yml 文件")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook example.yml --list-hosts")]),s._v("\nplaybook: example.yml\n  play "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1 (netnodes): netnodes  TAGS: []")]),s._v("\n    pattern: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("u"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'netnodes'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    hosts "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.101\n      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.103\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook example.yml --limit *.101")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"playbook-vs-shell-scripts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook-vs-shell-scripts"}},[s._v("#")]),s._v(" Playbook VS Shell Scripts")]),s._v(" "),t("p",[s._v("安装httpd")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SHELL脚本")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装Apache")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --quiet -y httpd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /tmp/httpd.conf /etc/httpd/conf/httpd.conf\ncp/tmp/vhosts.conf /etc/httpd/conf.d/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动Apache，并设置开机启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" httpd start\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" httpd on\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("---\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Playbook定义")]),s._v("\n\n- hosts: all\n  remote_user: root\n  \n  tasks:   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一个name对应着一个 action, 不可以一对多")]),s._v("\n    - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"安装Apache"')]),s._v("\n      yum: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpd       yum模块:安装httpd\n    - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"复制配置文件"')]),s._v("\n      copy: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/httpd.conf "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/httpd/conf/  copy模块: 拷贝文件\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  - name: "复制配置文件"   # 注释后, 此处语法错误')]),s._v("\n      copy: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/vhosts.conf "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/httpd/conf.d/  \n    - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动Apache，并设置开机启动"')]),s._v("\n      service: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpd "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("started "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes   service模块: 启动服务 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h4",{attrs:{id:"示例-playbook-创建用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例-playbook-创建用户"}},[s._v("#")]),s._v(" 示例:Playbook 创建用户")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("示例：sysuser.yml\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" create mysql user\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=mysql system=yes uid=36\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" create a group\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd system=yes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"handlers和notify结合使用触发条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#handlers和notify结合使用触发条件"}},[s._v("#")]),s._v(" handlers和notify结合使用触发条件")]),s._v(" "),t("blockquote",[t("ul",[t("li",[t("p",[s._v("Handlers 实际上就是一个触发器, 是task列表，这些task与前述的task并没有本质上的不同,用于当关注的资源发生变化时，才会采取一定的操作")])]),s._v(" "),t("li",[t("p",[s._v("Notify此action可用于在每个play的最后被触发，这样可避免多次有改变发生时每次都执行指定的操作，仅在所有的变化发生完成后一次性地执行指定操作。")])]),s._v(" "),t("li",[t("p",[s._v("在notify中列出的操作称为handler，也即notify中调用handler中定义的操作")])])])]),s._v(" "),t("h4",{attrs:{id:"playbook中handlers使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook中handlers使用"}},[s._v("#")]),s._v(" Playbook中handlers使用")]),s._v(" "),t("p",[s._v("默认情况下, 对于未更改的操作, ansible-playbook 会跳过执行; 所以需要notify和handler结合使用, 触发action.")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" netnodes\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" create new file\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=/root/newfile state=touch\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create new user\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=user2 shell=/sbin/nologin\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install package\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" copy httpd index.html\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=/var/www/html/index.html dest=/var/www/html/index.html\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart httpd   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 触发对应的 handler")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" start httpd service\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd state=started enabled=true\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" allow http access\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" firewall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cmd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service=http "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("permanent\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reload firewall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cmd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" firewall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cmd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("reload\n      \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart httpd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd state=restarted\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h4",{attrs:{id:"在notify中定义一个notify并触发多个handler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在notify中定义一个notify并触发多个handler"}},[s._v("#")]),s._v(" 在notify中定义一个notify并触发多个handler")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" websrvs\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" add group nginx\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" user\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=nginx state=present\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" add user nginx\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=nginx state=present group=nginx\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install Nginx\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=nginx state=present\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" config\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=/root/config.txt dest=/etc/nginx/nginx.conf\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在notify中定义并触发多个handler")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Restart Nginx\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Check Nginx Process\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Restart Nginx\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=nginx state=restarted enabled=yes\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Check Nginx process\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" killall "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0 nginx "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /tmp/nginx.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h4",{attrs:{id:"多个相同的notify对应一个handler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多个相同的notify对应一个handler"}},[s._v("#")]),s._v(" 多个相同的notify对应一个handler")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# heartbeat.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hbhosts\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ensure heartbeat latest version\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=heartbeat state=present\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authkeys configure file\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=/root/hb_conf/authkeys dest=/etc/ha.d/authkeys\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" authkeys mode 600\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" path=/etc/ha.d/authkeys mode=600\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" restart heartbeat\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ha.cf configure file\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=/root/hb_conf/ha.cf dest=/etc/ha.d/ha.cf\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" restart heartbeat\n        \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart heartbeat\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=heartbeat state=restarted\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("h3",{attrs:{id:"playbook中tags使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook中tags使用"}},[s._v("#")]),s._v(" Playbook中tags使用")]),s._v(" "),t("p",[s._v("tags: 添加标签")]),s._v(" "),t("ul",[t("li",[s._v("可以指定某一个任务添加一个标签,添加标签以后,想执行某个动作可以做出挑选来执行")]),s._v(" "),t("li",[s._v("多个任务可以使用同一个标签")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例：httpd.yml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" websrvs\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install httpd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd state=present\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install_conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加tag键值对")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install configure file\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=files/httpd.conf dest=/etc/httpd/conf/\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install_conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加tag键值对")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" start httpd service\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" start_service  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加tag键值对")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd state=started enabled=yes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ansible-playbook –t install_conf,start_service httpd.yml   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定执行install,conf 两个标签对应的task")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"对整个playbook添加tags"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对整个playbook添加tags"}},[s._v("#")]),s._v(" 对整个playbook添加tags")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" testsrv\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" inshttpd   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对整个playbook添加tags")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install httpd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd state=present\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install configure file\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("copy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" src=files/httpd.conf dest=/etc/httpd/conf/\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rshttpd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("notify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart httpd\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handlers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" restart httpd\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=httpd status=restarted\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ansible-playbook –t inshttpd httpd2.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"playbook中变量的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbook中变量的使用"}},[s._v("#")]),s._v(" Playbook中变量的使用")]),s._v(" "),t("p",[s._v("变量名：仅能由字母、数字和下划线组成，且只能以字母开头\n变量来源：")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("Setup")]),s._v(" module 远程主机的所有变量都可直接调用 (系统自带变量), setup模块可以实现系统中很多系统信息的显示, 可以返回每个主机的系统信息包括:版本、主机名、cpu、内存")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有的系统变量")]),s._v("\nansible *.102 -m setup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("less")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示全部系统变量")]),s._v("\n\nansible all -m setup -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'filter=ansible_nodename'")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询主机名")]),s._v("\nansible all -m setup -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'filter=ansible_fqdn'")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询主机名")]),s._v("\n\nansible all -m setup -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'filter=ansible_memtotal_mb'")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询主机内存大小")]),s._v("\nansible all -m setup -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'filter=ansible_distribution_major_version'")]),s._v("  \nansible all -m setup -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'filter=ansible_processor_vcpus'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询主机cpu个数")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("在playbook中引用变量: "),t("code",[s._v(s._s(s.variable_name))]),s._v(" , 以及变量定义")])]),s._v(" "),t("li",[t("p",[s._v("在/etc/ansible/hosts(主机清单)中定义变量:")]),s._v(" "),t("ul",[t("li",[s._v("单主机变量：主机组中主机单独定义，优先级高于主机组变量;")]),s._v(" "),t("li",[s._v("主机组变量：针对主机组中所有主机定义统一变量(一组主机的同一类别);")])])]),s._v(" "),t("li",[t("p",[s._v("通过命令行指定进行变量赋值，优先级最高\nansible-playbook –e varname=value")])]),s._v(" "),t("li",[t("p",[s._v("在独立的变量YAML文件中定义")])]),s._v(" "),t("li",[t("p",[s._v("在role中定义")])])]),s._v(" "),t("h4",{attrs:{id:"使用系统变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用系统变量"}},[s._v("#")]),s._v(" 使用系统变量")]),s._v(" "),t("blockquote",[t("p",[s._v("Facts：是由正在通信的远程目标主机发回的信息，这些信息被保存在ansible变量中。要获取指定的远程主机所支持的所有facts，可使用如下命令进行 "),t("code",[s._v("ansible all -m setup")]),s._v(";")])]),s._v(" "),t("p",[s._v("var.yml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" appsrvs\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create ansible_log folder\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/log/ansible_log/\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" directory\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0775"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("recurse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" create log file\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=/var/log/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_fqdn "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".log state=touch\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook var.yml -C")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible appsrvs -a 'ls /var/log/*.log")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"在playbook中定义变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在playbook中定义变量"}},[s._v("#")]),s._v(" 在playbook中定义变量")]),s._v(" "),t("h5",{attrs:{id:"方式一"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式一"}},[s._v("#")]),s._v(" 方式一")]),s._v(" "),t("p",[s._v("app.yml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" netnodes\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install package\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" pkg_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" start service\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" pkg_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" state=started enabled=yes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("变量赋值: "),t("code",[s._v("ansible-playbook -e 'Vari_Name=Value' ...")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook app.yml -e 'pkg_name=vsftpd' -C ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook app.yml -e 'pkg_name=vsftpd'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否安装成功")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible all -a 'rpm -q vsftpd'   # 查看是否安装 vsftpd")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看vsftpd 服务端口是否开启")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible netnodes -a 'ss -ntl' | grep 21")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载 vsftpd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible all -m yum -a 'name=vsftpd state=removed'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h5",{attrs:{id:"方式二-直接在-playbook-中赋值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方式二-直接在-playbook-中赋值"}},[s._v("#")]),s._v(" 方式二: 直接在 Playbook 中赋值")]),s._v(" "),t("p",[s._v("示例：creat_user.yml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create user and add to group\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" all\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("become")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vars")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" user1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groupname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" group1\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create group\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ groupname }}"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("state")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" present\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create user\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ username }}"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ groupname }}"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("createhome")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yes\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shell")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /bin/bash\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Set user password\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ username }}"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{{ 'mypassword' | password_hash('sha512') }}\"")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ansible-playbook creat_user.yml\n\nansible all -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id user1'")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定用户是否存在")]),s._v("\nansible all -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'getent group group1'")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定用户组是否存在")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh 'user1@192.168.30.103'")]),s._v("\nuser1@192.168.30.103"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s password:\n\nansible all -a '")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("userdel")]),s._v(" -r user1"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'  # 删除指定用户, -r 同时删除其家目录和邮箱\nansible all -a '")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupdel")]),s._v(" group1'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ansible-playbook -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username=user2 groupname=group2'")]),s._v(" creat_user.yml\nansible -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id user1'")]),s._v(" all    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定用户是否存在")]),s._v("\nansible -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id user2'")]),s._v(" all    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定用户是否存在")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("blockquote",[t("p",[t("strong",[s._v("说明:")]),s._v(" 通过命令行赋值变量, 覆盖了Playbook中的变量赋值, 具有更高的优先级")])]),s._v(" "),t("h4",{attrs:{id:"inventory中定义变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#inventory中定义变量"}},[s._v("#")]),s._v(" Inventory中定义变量")]),s._v(" "),t("blockquote",[t("p",[s._v("Inventory中定义的变量, 优先级比 Playbook 中的优先级更低")])]),s._v(" "),t("h5",{attrs:{id:"单主机变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单主机变量"}},[s._v("#")]),s._v(" 单主机变量")]),s._v(" "),t("blockquote",[t("p",[s._v("单主机变量 的优先级比 主机组变量 更高")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/ansible/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("appsrvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.101 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("http_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("www\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.102 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("http_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("appsrvs.yml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" appsrvs\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Change Hostname\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接使用 hostname 模块, 调用inventory的主机变量")]),s._v("\nansible appsrvs -m "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v(" -a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name={{ node_name }}{{ http_port }}'")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更改主机名为各自被定义的变量 ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行yml文件中的hostname模块, 调用inventory的主机变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook appsrvs.yml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible appsrvs -a 'hostname'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h5",{attrs:{id:"主机组变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机组变量"}},[s._v("#")]),s._v(" 主机组变量")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  vim /etc/ansible/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("appsrvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单主机变量(优先级比 主机组变量更高)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.101 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("http_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("www\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.102 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("http_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("node_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("appsrvs:vars"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机组变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("domain_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("magedu.com\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("http_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("appsrvs.yml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" appsrvs\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Change Hostname\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" domain_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" http_port "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook appsrvs.yml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible appsrvs -a 'hostname")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.102 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANGED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\nweb.magedu.com.82\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".30.101 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANGED "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\nwww.magedu.com.81\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h5",{attrs:{id:"主机组嵌套"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主机组嵌套"}},[s._v("#")]),s._v(" 主机组嵌套")]),s._v(" "),t("p",[s._v("inventory中，组还可以包含其它的组，并且也可以向组中的主机指定变量。这些变量只能在ansible-playbook中使用，而ansible命令不支持")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  vim /etc/ansible/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhttpd1.magedu.com\nhttpd2.magedu.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nginx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nngx1.magedu.com\nngx2.magedu.com\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("websrvs:children"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含 子组")]),s._v("\napache\nnginx\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webservers:vars"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ntp_server")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ntp.magedu.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h4",{attrs:{id:"invertory参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#invertory参数"}},[s._v("#")]),s._v(" invertory参数")]),s._v(" "),t("p",[s._v("inventory参数:")]),s._v(" "),t("ul",[t("li",[s._v("ansible基于ssh连接inventory中指定的远程主机时，还可以通过参数指定其交互方式；")]),s._v(" "),t("li",[s._v("用于定义ansible远程连接目标主机时使用的参数，而非传递给playbook的变量")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/ansible/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("websrvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("magedu\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("magedu\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这些参数如下所示：")]),s._v("\nansible_ssh_host  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The name of the host to connect to, if different from the alias you wishto give to it.")]),s._v("\n\nansible_ssh_port  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The ssh port number, if not 22")]),s._v("\n\nansible_ssh_user\nThe default "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" user name to use.\n\nansible_ssh_pass  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The ssh password to use (this is insecure, we strongly recommendusing --ask-pass or SSH keys)")]),s._v("\n\nansible_sudo_pass  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The sudo password to use (this is insecure, we strongly recommendusing --ask-sudo-pass)")]),s._v("\n\nansible_connection  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Connection type of the host. Candidates are local, ssh or paramiko. The default is paramiko before Ansible 1.2, and 'smart' afterwards which detects whether usage of 'ssh' would be feasible based on whether ControlPersist is supported.")]),s._v("\n\nansible_ssh_private_key_file  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Private key file used by ssh. Useful if using multiple keys and you don't want to use SSH agent.")]),s._v("\n\nansible_shell_type  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The shell type of the target system. By default commands are formatted using 'sh'-style syntax by default. Setting this to 'csh' or 'fish' will cause commands executed on target systems to follow those shell's syntax instead.")]),s._v("\n\nansible_python_interpreter  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# The target host python path. This is useful for systems with more than one Python or not located at "/usr/bin/python" such as \\*BSD, or where /usr/bin/python is not a 2.X series Python. We do not use the "/usr/bin/env" mechanism as that requires the remote user\'s path to be set right and also assumes the "python" executable is named python,where the executable might be named something like "python26".')]),s._v("\n\nansible"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_interpreter   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Works for anything such as ruby or perl and works just like ansible_python_interpreter. This replaces shebang of modules which will run on that host.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h4",{attrs:{id:"独立的变量文件-yml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#独立的变量文件-yml"}},[s._v("#")]),s._v(" 独立的变量文件.yml")]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("将变量写进单独的YAML文件后, 被Playbook引用")])])]),s._v(" "),t("p",[s._v("vars.yml")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("var1: httpd\nvar2: vsftpd    \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("appinstal.yml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" appsrvs\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("vars_files")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /root/vars.yml\n\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install package\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("yum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name="),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" var1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Create File\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name=/root/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" var2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".log state=touch\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook appinstal.yml -C")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook appinstal.yml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible appsrvs -a 'ls /root/*.log'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible appsrvs -a 'rpm -q httpd'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);