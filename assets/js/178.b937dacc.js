(window.webpackJsonp=window.webpackJsonp||[]).push([[178],{779:function(s,a,n){"use strict";n.r(a);var t=n(14),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"roles"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#roles"}},[s._v("#")]),s._v(" roles")]),s._v(" "),n("blockquote",[n("p",[s._v("Ansible Roles是一种可重用的、模块化的Playbook的组织方式，它使得可以将一组相关的任务、变量、模板和文件等相关内容放置于单独的目录中, 然后打包在一起，方便地在不同的项目中重复使用。")]),s._v(" "),n("p",[s._v("一个Ansible Role通常包含以下几个部分：")]),s._v(" "),n("ul",[n("li",[s._v("tasks：定义了一组任务，即执行的操作步骤。")]),s._v(" "),n("li",[s._v("handlers：定义了一组处理程序，即在任务执行后需要运行的操作。")]),s._v(" "),n("li",[s._v("templates：包含了一些模板文件，可以根据变量值生成具体的配置文件等内容。")]),s._v(" "),n("li",[s._v("files：包含了一些文件，可以用来复制到目标机器上。")]),s._v(" "),n("li",[s._v("vars：包含了一些变量定义。")]),s._v(" "),n("li",[s._v("defaults：包含了一些默认值，当没有定义变量时会使用这些默认值。")]),s._v(" "),n("li",[s._v("meta：包含了一些Role相关的元数据信息，例如作者、依赖等。")])]),s._v(" "),n("p",[s._v("使用Ansible Roles可以大大简化Ansible Playbook的编写，尤其是在需要在多个项目中使用相同的代码时。通过将相关的代码组织在一个Role中，可以避免代码冗余，并且可以更方便地维护和更新代码。")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /etc/ansible/")]),s._v("\n/etc/ansible/\n├── ansible.cfg\n├── hosts\n└── roles  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 官方建议存放的目录, 非必须")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /etc/ansible/{nginx,mysql,memcache} -pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /etc/ansible/roles/")]),s._v("\n/etc/ansible/roles/                                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一般每个软件分别创建一个")]),s._v("\n├── nginx\n├── memcache\n└── mysql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h3",{attrs:{id:"ansible-roles目录编排"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ansible-roles目录编排"}},[s._v("#")]),s._v(" Ansible Roles目录编排")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303280252961.png",alt:"image-20230328025246577"}})]),s._v(" "),n("h3",{attrs:{id:"roles目录结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#roles目录结构"}},[s._v("#")]),s._v(" roles目录结构")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("每个角色，以特定的层级目录结构进行组织\nroles目录结构：\n\nplaybook.yml  调用角色\nroles/\n  project/ (角色名称)\n    tasks/\n    files/\n    vars/\n    templates/\n    handlers/\n    default/ 不常用\n    meta/    不常用\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"roles各目录作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#roles各目录作用"}},[s._v("#")]),s._v(" Roles各目录作用")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/roles/project/ :项目名称,有以下子目录\n    files/ ：存放由copy或script模块等调用的文件\n    templates/：template模块查找所需要模板文件的目录\n    tasks/：定义task,role的基本元素，至少应该包含一个名为main.yml的文件；\n            其它的文件需要在此文件中通过include进行包含\n    handlers/：至少应该包含一个名为main.yml的文件；\n               其它的文件需要在此文件中通过include进行包含\n    vars/：定义变量，至少应该包含一个名为main.yml的文件；\n           其它的文件需要在此文件中通过include进行包含\n    meta/：定义当前角色的特殊设定及其依赖关系,至少应该包含一个名为main.yml的文件，\n           其它文件需在此文件中通过include进行包含\n    default/：设定默认变量时使用此目录中的main.yml文件\n    \nroles/appname 目录结构\n    tasks目录：至少应该包含一个名为main.yml的文件，其定义了此角色的任务列表；\n               此文件可以使用include包含其它的位于此目录中的task文件\n    files目录：存放由copy或script等模块调用的文件；\n    templates目录：template模块会自动在此目录中寻找Jinja2模板文件\n    handlers目录：此目录中应当包含一个main.yml文件，用于定义此角色用到的各handler；\n                  在handler中使用include包含的其它的handler文件也应该位于此目录中；\n    vars目录：应当包含一个main.yml文件，用于定义此角色用到的变量；\n    meta目录：应当包含一个main.yml文件，用于定义此角色的特殊设定及其依赖关系；\n              ansible1.3及其以后的版本才支持；\n    default目录：为当前角色设定默认变量时使用此目录；应当包含一个main.yml文件\n\nroles/example_role/files/             所有文件，都将可存放在这里\nroles/example_role/templates/         所有模板都存放在这里\nroles/example_role/tasks/main.yml：   主函数，包括在其中的所有任务将被执行\nroles/example_role/handlers/main.yml：所有包括其中的 handlers 将被执行\nroles/example_role/vars/main.yml：    所有包括在其中的变量将在roles中生效\nroles/example_role/meta/main.yml：    roles所有依赖将被正常登入\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h3",{attrs:{id:"创建role"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建role"}},[s._v("#")]),s._v(" 创建role")]),s._v(" "),n("blockquote",[n("h5",{attrs:{id:"创建role的步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建role的步骤"}},[s._v("#")]),s._v(" 创建role的步骤")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("1. 创建以roles命名的目录\n2. 在roles目录中分别创建以各角色名称命名的目录，如webservers等\n3. 在每个角色命名的目录中分别创建files、handlers、meta、tasks、templates和vars目录；用不到的目录可以创建为空目录，也可以不创建\n4. 在playbook文件中，调用各角色\n")])])])]),s._v(" "),n("h5",{attrs:{id:"推荐的目录结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#推荐的目录结构"}},[s._v("#")]),s._v(" 推荐的目录结构")]),s._v(" "),n("p",[s._v("Ansible默认的工作目录是 "),n("code",[s._v("/etc/ansible/roles/")]),s._v(", 所以推荐: 所有的YAML文件引用的目录都从"),n("strong",[s._v("这个路径后")]),s._v("开始.")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /etc/ansible/roles/")]),s._v("\n/etc/ansible/roles/\n├── project/\n│   ├── default/\n│   ├── files/\n│   ├── handlers/\n│   ├── meta/\n│   ├── tasks/\n│   ├── templates/\n│   └── vars/\n└── project_role.yml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"实验-创建httpd角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实验-创建httpd角色"}},[s._v("#")]),s._v(" 实验: 创建httpd角色")]),s._v(" "),n("h5",{attrs:{id:"示例1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例1"}},[s._v("#")]),s._v(" 示例1:")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1> 创建roles目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/ansible/roles\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v("  -pv httpd/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("tasks,templates,handlers,files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" httpd/\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2> 创建任务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/user.yml")]),s._v("\n- name: Create Group\n  group: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91")]),s._v("\n\n- name: Create User "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Apache\n  user: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("system")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("shell")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin/nologin "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("91")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /etc/httpd/conf/httpd.conf files/")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/copy.yml")]),s._v("\n- name: Copy files\n  copy: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/httpd/files/httpd.conf "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/httpd/conf/httpd.conf "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("owner")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/main.yml")]),s._v("\n- include: user.yml\n- include: copy.yml\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible httpd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim ../httpd_role.yml")]),s._v("\n- hosts: all\n  remote_user: root\n\n  roles:\n    - httpd\n    \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible httpd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook ../httpd_role.yml -C")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h5",{attrs:{id:"示例2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例2"}},[s._v("#")]),s._v(" 示例2:")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir apache")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd apache")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 净化环境")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible all -a 'yum remove -y nginx'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible all -a 'userdel -r nginx'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible all -a 'groupdel nginx'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible all -a 'userdel -r apache'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible all -a 'groupdel apache'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("创建apache项目")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir tasks templates vars handlers files")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n├── files\n├── handlers\n├── tasks\n├── templates\n└── vars\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("创建tasks")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/grp_usr.yml")]),s._v("\n- name: Create Group\n  group: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("system")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n\n- name: Create User\n  user: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("system")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("shell")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin/nologin "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/pkg_insl.yml")]),s._v("\n- name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" PKG\n  yum: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpd\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/start.yml")]),s._v("\n- name: Start Service Apache\n  service: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpd "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("started "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /etc/httpd/conf/httpd.conf templates/httpd.conf.j2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim templates/httpd.conf.j2")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# User apache")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Group apache")]),s._v("\n    User "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" username  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    Group "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" groupname "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim vars/main.yml     ")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须是字典")]),s._v("\nusername: apache   \ngroupname: apache\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/cp_tmpl.yml")]),s._v("\n- name: Copy config "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n  template: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache/templates/httpd.conf.j2 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/httpd/conf/httpd.conf\n  notify: Restart Service\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim handlers/main.yml")]),s._v("\n- name: Restart Service\n  service: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpd "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("restarted\n  \n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "Hello Apache" >> files/index.html')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/cp_file.yml")]),s._v("\n- name: Copy File\n  copy: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache/files/index.html "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/www/html/index.html "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("owner")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apache\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/main.yml")]),s._v("\n- include: grp_usr.yml\n- include: pkg_insl.yml\n- include: cp_tmpl.yml\n- include: cp_file.yml\n- include: start.yml \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim ../apache_role.yml")]),s._v("\n- hosts: appsrvs\n  remote_user: root\n\n  roles:\n    - apache\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])]),n("h4",{attrs:{id:"创建一个nginx角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建一个nginx角色"}},[s._v("#")]),s._v(" 创建一个nginx角色")]),s._v(" "),n("p",[s._v("建立nginx角色在多台主机上来部署nginx, 建议创建统一的uid, gid")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1> 创建nginx角色目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/ansible/role/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir nginx/{tasks,templates,handlers} -pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd nginx/")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2> 创建任务文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建main.yml文件定义任务执行顺序")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/main.yml")]),s._v("\n- include: group.yml\n- include: user.yml\n- include: yum.yml\n- include: templ.yml\n- include: start.yml\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/group.yml")]),s._v("\n- name: Create Group\n  group: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/user.yml")]),s._v("\n- name: Create User\n  user: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("group")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("system")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("shell")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/sbin/nologin\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/yum.yml")]),s._v("\n- name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" package\n  yum: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/start.yml")]),s._v("\n- name: Start Nginx\n  service: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("started "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/restart.yml")]),s._v("\n- name: Restart Nginx\n  service: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("restarted\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/templ.yml")]),s._v("\n- name: copy config\n  template: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx/templates/nginx.conf.j2 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/nginx/nginx.conf\n  notify: Renew Config\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3> 准备 Template")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /etc/nginx/nginx.conf ./templates/nginx.conf.j2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim templates/nginx.conf.j2")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# worker_processes auto;")]),s._v("\n    worker_processes "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_processor_vcpus+2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4> 在roles目录下定义 role 文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim ../nginx_role.yml")]),s._v("\n- hosts: appsrvs\n  remote_user: root\n\n  roles:\n    - role: nginx\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5> 检查文件并执行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook nginx_role.yml -C")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook nginx_role.yml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible appsrvs -a 'lsof -i -P -n | grep nginx'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6> 总结目录结构")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /etc/ansible/roles/")]),s._v("\n/etc/ansible/roles/\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n├── nginx\n│   ├── handlers\n│   │   └── main.yml\n│   ├── tasks\n│   │   ├── group.yml\n│   │   ├── main.yml\n│   │   ├── restart.yml\n│   │   ├── start.yml\n│   │   ├── templ.yml\n│   │   ├── user.yml\n│   │   └── yum.yml\n│   └── templates\n│       └── nginx.conf.j2\n└── nginx_role.yml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br")])]),n("h4",{attrs:{id:"跨roles调用yml文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨roles调用yml文件"}},[s._v("#")]),s._v(" 跨roles调用yml文件")]),s._v(" "),n("ul",[n("li",[s._v("需要在 /tasks/main.yml 中 include 其他role的task")]),s._v(" "),n("li",[s._v("Ansible默认的工作路径是"),n("code",[s._v("/etc/ansible/roles/")]),s._v(", 所以文件引用的路径要从这个路径后开始.")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim nginx/tasks/main.yml ")]),s._v("\n- include: group.yml\n- include: user.yml\n- include: yum.yml\n- include: templ.yml\n- include: start.yml\n- include: httpd/tasks/copy.yml   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  跨roles调用yml文件, 默认的工作路径是`/etc/ansible/roles/`")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"创建角色memcached"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建角色memcached"}},[s._v("#")]),s._v(" 创建角色memcached")]),s._v(" "),n("p",[s._v("memcacched 当做缓存用, 会在内存中开启一块空间充当缓存")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y memcached")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql memcached ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/sysconfig/memcached")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PORT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"11211"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"memcached"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MAXCONN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1024"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CACHESIZE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"64"')]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存空间默认64M ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OPTIONS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" 创建对用目录\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /app/ansible/roles/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir memcached/{tasks,templates} -pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd memcached")]),s._v("\n   \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" 拷贝memcached配置文件模板\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /etc/sysconfig/memcached  templates/memcached.j2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim templates/memcached.j2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CACHESIZE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ansible_memtotal_mb//4 }}"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#物理内存的1/4用做缓存")]),s._v("\n   \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v(" 创建对应yml文件,并做相应配置\n   创建main.yml文件定义任务执行顺序\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/main.yml")]),s._v("\n- include: install.yml\n- include: config.yml\n- include: service.yml  \n   \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/install.yml")]),s._v("\n- name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" \n  yum: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("memcached\n     \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/config.yml")]),s._v("\n- name: config "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n  template: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("memcached.j2 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/sysconfig/memcached\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim tasks/service.yml")]),s._v("\n- name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n  service: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("memcached "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("started "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("4")]),s._v(">")]),s._v(" 创建调用角色文件\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim ../role_memcached.yml")]),s._v("\n---\n- hosts: appsrvs\n\n  roles: \n    - role: memcached\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("5")]),s._v(">")]),s._v(" 安装\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ansible-playbook  ../role_memcached.yml ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    memcached端口号11211")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br")])]),n("h3",{attrs:{id:"playbook调用多个roles"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#playbook调用多个roles"}},[s._v("#")]),s._v(" playbook调用多个roles")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例1：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/ansible/roles")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim websrvs_role.yml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" websrvs\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nginx\n    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例2：")]),s._v("\n传递变量给角色\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不同的role调用不同的变量  ")]),s._v("\n    键role用于指定角色名称\n    后续的k/v用于传递变量给角色\n\n调用角色方法3：还可基于条件测试实现角色调用\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ansible_distribution_major_version == '7' "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h3",{attrs:{id:"tags和when的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tags和when的使用"}},[s._v("#")]),s._v(" tags和when的使用")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("tags")]),s._v("可实现仅执行指定tag的roles;")]),s._v(" "),n("li",[n("code",[s._v("when")]),s._v(": 满足条件后, 才会执行相应的role")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# websrvs_role.yml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" appsrvs\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nginx'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' ansible_distribution_major_version == "6" '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 满足条件才会执行")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nginx'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n  \n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@Ansible roles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ansible-playbook websrvs_role.yml -t 'web' -C")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" testweb\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nginx'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'httpd'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mariadb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" php "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("playbook "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('tags="web'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('mysql" deploy.yml  '),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对标签进行挑选执行")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"通过roles传递变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过roles传递变量"}},[s._v("#")]),s._v(" 通过roles传递变量")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("通过roles传递变量\n当给一个主机应用角色的时候可以传递变量，然后在角色内使用这些变量\n示例：\n- hosts: webservers\n  roles:\n    - common\n    - { role: foo_app_instance, dir: '/web/htdocs/a.com', port: 8080 }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"推荐资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#推荐资料"}},[s._v("#")]),s._v(" 推荐资料")]),s._v(" "),n("blockquote",[n("ul",[n("li",[n("a",{attrs:{href:"http://galaxy.ansible.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://galaxy.ansible.com"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://galaxy.ansible.com/explore#/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://galaxy.ansible.com/explore#/"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://github.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://github.com/"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://ansible.com.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://ansible.com.cn/"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/ansible/ansible",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/ansible/ansible"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/ansible/ansible-examples",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/ansible/ansible-examples"),n("OutboundLink")],1)])])])])}),[],!1,null,null,null);a.default=e.exports}}]);