<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Switching_STP | Jonas Wolfxin Blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?267c5680c2ffb468ca29c45ffe6801da"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="Jonas Wolfxin个人博客, VuePress搭建, 使用了 Vdoing 主题, 学习Java, Web, 框架, 微服务, 工具, 前端等相关知识, 记录生活和技术路程, 同时分享编程技巧。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="Jonas Wolfxin个人博客, VuePress搭建, 学习Java、Web、框架、微服务、工具、前端等相关知识, 记录生活和技术路程。">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.7d3fc896.css" as="style"><link rel="preload" href="/assets/js/app.d858ddbb.js" as="script"><link rel="preload" href="/assets/js/2.309e711a.js" as="script"><link rel="preload" href="/assets/js/134.3f032f05.js" as="script"><link rel="preload" href="/assets/js/16.acd3428d.js" as="script"><link rel="preload" href="/assets/js/8.5b4b6c67.js" as="script"><link rel="preload" href="/assets/js/10.58f97cc7.js" as="script"><link rel="preload" href="/assets/js/17.0b7a5267.js" as="script"><link rel="prefetch" href="/assets/js/100.a245150c.js"><link rel="prefetch" href="/assets/js/101.dc21b366.js"><link rel="prefetch" href="/assets/js/102.d5a6dfd2.js"><link rel="prefetch" href="/assets/js/103.7675e438.js"><link rel="prefetch" href="/assets/js/104.08bff44e.js"><link rel="prefetch" href="/assets/js/105.8bf552ad.js"><link rel="prefetch" href="/assets/js/106.b3388dcc.js"><link rel="prefetch" href="/assets/js/107.708d16a8.js"><link rel="prefetch" href="/assets/js/108.8d67c3a1.js"><link rel="prefetch" href="/assets/js/109.adb072ef.js"><link rel="prefetch" href="/assets/js/11.1cff9f55.js"><link rel="prefetch" href="/assets/js/110.6a33e945.js"><link rel="prefetch" href="/assets/js/111.5b6daef7.js"><link rel="prefetch" href="/assets/js/112.30fa856b.js"><link rel="prefetch" href="/assets/js/113.2bea19a6.js"><link rel="prefetch" href="/assets/js/114.78693b98.js"><link rel="prefetch" href="/assets/js/115.24b2f36f.js"><link rel="prefetch" href="/assets/js/116.121c60d7.js"><link rel="prefetch" href="/assets/js/117.c2a343f1.js"><link rel="prefetch" href="/assets/js/118.4f472067.js"><link rel="prefetch" href="/assets/js/119.24255046.js"><link rel="prefetch" href="/assets/js/12.bca3c221.js"><link rel="prefetch" href="/assets/js/120.c049d4ee.js"><link rel="prefetch" href="/assets/js/121.27c7097d.js"><link rel="prefetch" href="/assets/js/122.89ae0c7e.js"><link rel="prefetch" href="/assets/js/123.92ff168d.js"><link rel="prefetch" href="/assets/js/124.42567e10.js"><link rel="prefetch" href="/assets/js/125.3bd92459.js"><link rel="prefetch" href="/assets/js/126.ce3b5ff1.js"><link rel="prefetch" href="/assets/js/127.62073e16.js"><link rel="prefetch" href="/assets/js/128.1e61e62d.js"><link rel="prefetch" href="/assets/js/129.1abfd9a0.js"><link rel="prefetch" href="/assets/js/13.fd509ce7.js"><link rel="prefetch" href="/assets/js/130.fd10656f.js"><link rel="prefetch" href="/assets/js/131.739a70c7.js"><link rel="prefetch" href="/assets/js/132.aead2e49.js"><link rel="prefetch" href="/assets/js/133.c996494c.js"><link rel="prefetch" href="/assets/js/135.c35c5612.js"><link rel="prefetch" href="/assets/js/136.b1a52d43.js"><link rel="prefetch" href="/assets/js/137.f6c998f0.js"><link rel="prefetch" href="/assets/js/138.5165a511.js"><link rel="prefetch" href="/assets/js/139.84e0898b.js"><link rel="prefetch" href="/assets/js/14.9a0c9450.js"><link rel="prefetch" href="/assets/js/140.f85c3c58.js"><link rel="prefetch" href="/assets/js/141.1b18b352.js"><link rel="prefetch" href="/assets/js/142.61b694c2.js"><link rel="prefetch" href="/assets/js/143.ca56fc45.js"><link rel="prefetch" href="/assets/js/144.634fc96a.js"><link rel="prefetch" href="/assets/js/145.7db28ded.js"><link rel="prefetch" href="/assets/js/146.0e801c74.js"><link rel="prefetch" href="/assets/js/147.26faa263.js"><link rel="prefetch" href="/assets/js/148.927832d5.js"><link rel="prefetch" href="/assets/js/149.8755eb42.js"><link rel="prefetch" href="/assets/js/15.d3755cc5.js"><link rel="prefetch" href="/assets/js/150.906609e5.js"><link rel="prefetch" href="/assets/js/151.7a52439b.js"><link rel="prefetch" href="/assets/js/152.c822b1fb.js"><link rel="prefetch" href="/assets/js/153.593575cc.js"><link rel="prefetch" href="/assets/js/154.2a16d8e7.js"><link rel="prefetch" href="/assets/js/155.6a18c733.js"><link rel="prefetch" href="/assets/js/156.bb65d909.js"><link rel="prefetch" href="/assets/js/157.862f6419.js"><link rel="prefetch" href="/assets/js/158.db76ed26.js"><link rel="prefetch" href="/assets/js/159.0f0b1ee8.js"><link rel="prefetch" href="/assets/js/160.8f421d08.js"><link rel="prefetch" href="/assets/js/161.4a521888.js"><link rel="prefetch" href="/assets/js/162.601dbfca.js"><link rel="prefetch" href="/assets/js/163.d76b166d.js"><link rel="prefetch" href="/assets/js/164.99b00d17.js"><link rel="prefetch" href="/assets/js/165.7809f82c.js"><link rel="prefetch" href="/assets/js/166.b29e508c.js"><link rel="prefetch" href="/assets/js/167.71af6bb1.js"><link rel="prefetch" href="/assets/js/168.aad10cfc.js"><link rel="prefetch" href="/assets/js/169.d807fd76.js"><link rel="prefetch" href="/assets/js/170.8cd1462a.js"><link rel="prefetch" href="/assets/js/171.ecbf63cf.js"><link rel="prefetch" href="/assets/js/172.e75cd345.js"><link rel="prefetch" href="/assets/js/173.1ab612d0.js"><link rel="prefetch" href="/assets/js/174.2366c5d2.js"><link rel="prefetch" href="/assets/js/175.50c5731b.js"><link rel="prefetch" href="/assets/js/176.ac8ad112.js"><link rel="prefetch" href="/assets/js/177.1abcf5d4.js"><link rel="prefetch" href="/assets/js/178.b937dacc.js"><link rel="prefetch" href="/assets/js/179.b6fa0b6d.js"><link rel="prefetch" href="/assets/js/18.64b7e666.js"><link rel="prefetch" href="/assets/js/180.e4a8bc36.js"><link rel="prefetch" href="/assets/js/181.b916da57.js"><link rel="prefetch" href="/assets/js/182.27a2bdb4.js"><link rel="prefetch" href="/assets/js/183.dcb4d635.js"><link rel="prefetch" href="/assets/js/184.820c8f5f.js"><link rel="prefetch" href="/assets/js/185.6654f558.js"><link rel="prefetch" href="/assets/js/186.2749179c.js"><link rel="prefetch" href="/assets/js/187.a301fd95.js"><link rel="prefetch" href="/assets/js/188.3a9e3226.js"><link rel="prefetch" href="/assets/js/189.5f2b0e83.js"><link rel="prefetch" href="/assets/js/19.7a102d25.js"><link rel="prefetch" href="/assets/js/190.76dc6e42.js"><link rel="prefetch" href="/assets/js/191.b6c01ef6.js"><link rel="prefetch" href="/assets/js/192.bd87e976.js"><link rel="prefetch" href="/assets/js/193.e3b20021.js"><link rel="prefetch" href="/assets/js/194.d83d205c.js"><link rel="prefetch" href="/assets/js/195.e53e330d.js"><link rel="prefetch" href="/assets/js/196.1fd35397.js"><link rel="prefetch" href="/assets/js/197.cb0858f8.js"><link rel="prefetch" href="/assets/js/198.651004c0.js"><link rel="prefetch" href="/assets/js/199.4a4a16ae.js"><link rel="prefetch" href="/assets/js/20.2e6fe8d4.js"><link rel="prefetch" href="/assets/js/200.0347a232.js"><link rel="prefetch" href="/assets/js/201.77c9f572.js"><link rel="prefetch" href="/assets/js/202.6f66fc82.js"><link rel="prefetch" href="/assets/js/203.c12f2fd1.js"><link rel="prefetch" href="/assets/js/204.0b74eb4e.js"><link rel="prefetch" href="/assets/js/205.82129b16.js"><link rel="prefetch" href="/assets/js/206.0240cea0.js"><link rel="prefetch" href="/assets/js/207.d2d2dd99.js"><link rel="prefetch" href="/assets/js/208.f1073a08.js"><link rel="prefetch" href="/assets/js/209.3b1e4cbe.js"><link rel="prefetch" href="/assets/js/21.179bedf0.js"><link rel="prefetch" href="/assets/js/210.b8b67413.js"><link rel="prefetch" href="/assets/js/211.455c8e40.js"><link rel="prefetch" href="/assets/js/212.8735e669.js"><link rel="prefetch" href="/assets/js/213.f77fefc5.js"><link rel="prefetch" href="/assets/js/214.97d827be.js"><link rel="prefetch" href="/assets/js/215.bc08fe35.js"><link rel="prefetch" href="/assets/js/216.fa811698.js"><link rel="prefetch" href="/assets/js/217.b965b7c6.js"><link rel="prefetch" href="/assets/js/218.6a91db8b.js"><link rel="prefetch" href="/assets/js/219.fb3d8166.js"><link rel="prefetch" href="/assets/js/22.8268ce6e.js"><link rel="prefetch" href="/assets/js/220.1577cda2.js"><link rel="prefetch" href="/assets/js/221.ceea7cea.js"><link rel="prefetch" href="/assets/js/222.3985b121.js"><link rel="prefetch" href="/assets/js/223.40f0edd0.js"><link rel="prefetch" href="/assets/js/224.bcdfffa8.js"><link rel="prefetch" href="/assets/js/225.13252b88.js"><link rel="prefetch" href="/assets/js/226.2afd6de5.js"><link rel="prefetch" href="/assets/js/227.39e5b8f1.js"><link rel="prefetch" href="/assets/js/228.f24cb5b5.js"><link rel="prefetch" href="/assets/js/229.582f76a9.js"><link rel="prefetch" href="/assets/js/23.3b76f2ef.js"><link rel="prefetch" href="/assets/js/230.50a93474.js"><link rel="prefetch" href="/assets/js/231.063e02af.js"><link rel="prefetch" href="/assets/js/232.08153e5d.js"><link rel="prefetch" href="/assets/js/233.e8a2f480.js"><link rel="prefetch" href="/assets/js/234.4e784ee0.js"><link rel="prefetch" href="/assets/js/235.fe1262b2.js"><link rel="prefetch" href="/assets/js/236.5b6a52cf.js"><link rel="prefetch" href="/assets/js/237.36fae37d.js"><link rel="prefetch" href="/assets/js/238.7369ac7a.js"><link rel="prefetch" href="/assets/js/239.7fff287f.js"><link rel="prefetch" href="/assets/js/24.7c6b119c.js"><link rel="prefetch" href="/assets/js/240.96b67d8a.js"><link rel="prefetch" href="/assets/js/241.6cca43be.js"><link rel="prefetch" href="/assets/js/242.063840f3.js"><link rel="prefetch" href="/assets/js/243.e25e2acc.js"><link rel="prefetch" href="/assets/js/244.6058b76a.js"><link rel="prefetch" href="/assets/js/245.cab0cb5f.js"><link rel="prefetch" href="/assets/js/246.38dba8a1.js"><link rel="prefetch" href="/assets/js/247.58a45597.js"><link rel="prefetch" href="/assets/js/248.5cf1ad4c.js"><link rel="prefetch" href="/assets/js/249.691356bb.js"><link rel="prefetch" href="/assets/js/25.02fab98f.js"><link rel="prefetch" href="/assets/js/250.e2c83a35.js"><link rel="prefetch" href="/assets/js/251.80aa06df.js"><link rel="prefetch" href="/assets/js/252.a3e269d1.js"><link rel="prefetch" href="/assets/js/253.d11f6725.js"><link rel="prefetch" href="/assets/js/26.76ffb425.js"><link rel="prefetch" href="/assets/js/27.ce24313c.js"><link rel="prefetch" href="/assets/js/28.d8dbc96b.js"><link rel="prefetch" href="/assets/js/29.2b3bed04.js"><link rel="prefetch" href="/assets/js/3.d6952836.js"><link rel="prefetch" href="/assets/js/30.26988c7b.js"><link rel="prefetch" href="/assets/js/31.cc5781e4.js"><link rel="prefetch" href="/assets/js/32.80d8b83b.js"><link rel="prefetch" href="/assets/js/33.d97c7068.js"><link rel="prefetch" href="/assets/js/34.962f9100.js"><link rel="prefetch" href="/assets/js/35.23d8a044.js"><link rel="prefetch" href="/assets/js/36.6d349d82.js"><link rel="prefetch" href="/assets/js/37.b08f29c8.js"><link rel="prefetch" href="/assets/js/38.8b2bd27d.js"><link rel="prefetch" href="/assets/js/39.45a0b016.js"><link rel="prefetch" href="/assets/js/4.8b22777d.js"><link rel="prefetch" href="/assets/js/40.e6f6cb43.js"><link rel="prefetch" href="/assets/js/41.c756e119.js"><link rel="prefetch" href="/assets/js/42.bbc17b0f.js"><link rel="prefetch" href="/assets/js/43.8e0ce4ca.js"><link rel="prefetch" href="/assets/js/44.b91517af.js"><link rel="prefetch" href="/assets/js/45.416dfe4d.js"><link rel="prefetch" href="/assets/js/46.c00eeb87.js"><link rel="prefetch" href="/assets/js/47.29d200b3.js"><link rel="prefetch" href="/assets/js/48.7f066ab6.js"><link rel="prefetch" href="/assets/js/49.0e010fee.js"><link rel="prefetch" href="/assets/js/5.e6781b57.js"><link rel="prefetch" href="/assets/js/50.1bb477d0.js"><link rel="prefetch" href="/assets/js/51.66468406.js"><link rel="prefetch" href="/assets/js/52.5cf7fbd0.js"><link rel="prefetch" href="/assets/js/53.d6f04354.js"><link rel="prefetch" href="/assets/js/54.59ca865c.js"><link rel="prefetch" href="/assets/js/55.fb0ad69c.js"><link rel="prefetch" href="/assets/js/56.c47a2d12.js"><link rel="prefetch" href="/assets/js/57.f5d65bb3.js"><link rel="prefetch" href="/assets/js/58.c5761ef2.js"><link rel="prefetch" href="/assets/js/59.9fe56073.js"><link rel="prefetch" href="/assets/js/6.9b07e200.js"><link rel="prefetch" href="/assets/js/60.ee1a5c93.js"><link rel="prefetch" href="/assets/js/61.ed5a91fd.js"><link rel="prefetch" href="/assets/js/62.4c69d23d.js"><link rel="prefetch" href="/assets/js/63.a396c29b.js"><link rel="prefetch" href="/assets/js/64.6f39dd9c.js"><link rel="prefetch" href="/assets/js/65.4cb24e13.js"><link rel="prefetch" href="/assets/js/66.aad4aa20.js"><link rel="prefetch" href="/assets/js/67.36e86f95.js"><link rel="prefetch" href="/assets/js/68.cbcfb2e0.js"><link rel="prefetch" href="/assets/js/69.8f5b0c08.js"><link rel="prefetch" href="/assets/js/7.4d64b8e6.js"><link rel="prefetch" href="/assets/js/70.1e7d144f.js"><link rel="prefetch" href="/assets/js/71.77fb0b43.js"><link rel="prefetch" href="/assets/js/72.bf3bb5b9.js"><link rel="prefetch" href="/assets/js/73.e059a41d.js"><link rel="prefetch" href="/assets/js/74.cae09eb3.js"><link rel="prefetch" href="/assets/js/75.f89a6d2e.js"><link rel="prefetch" href="/assets/js/76.cfb3df08.js"><link rel="prefetch" href="/assets/js/77.f4fa62e6.js"><link rel="prefetch" href="/assets/js/78.464e83f6.js"><link rel="prefetch" href="/assets/js/79.71895252.js"><link rel="prefetch" href="/assets/js/80.58d501fe.js"><link rel="prefetch" href="/assets/js/81.948adca1.js"><link rel="prefetch" href="/assets/js/82.bfd7ff16.js"><link rel="prefetch" href="/assets/js/83.3920a558.js"><link rel="prefetch" href="/assets/js/84.d5b9372a.js"><link rel="prefetch" href="/assets/js/85.3be0afac.js"><link rel="prefetch" href="/assets/js/86.29f7272d.js"><link rel="prefetch" href="/assets/js/87.93a0bc8e.js"><link rel="prefetch" href="/assets/js/88.5be81cc2.js"><link rel="prefetch" href="/assets/js/89.bc9cad5d.js"><link rel="prefetch" href="/assets/js/9.dc7a3982.js"><link rel="prefetch" href="/assets/js/90.5ba7972c.js"><link rel="prefetch" href="/assets/js/91.6ca92166.js"><link rel="prefetch" href="/assets/js/92.cb997f9f.js"><link rel="prefetch" href="/assets/js/93.941f52c6.js"><link rel="prefetch" href="/assets/js/94.c34116e0.js"><link rel="prefetch" href="/assets/js/95.0aa6895c.js"><link rel="prefetch" href="/assets/js/96.fd230ec0.js"><link rel="prefetch" href="/assets/js/97.375c63c2.js"><link rel="prefetch" href="/assets/js/98.5f4889ea.js"><link rel="prefetch" href="/assets/js/99.476bd54f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7d3fc896.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/index/logo.png" alt="Jonas Wolfxin Blog" class="logo"> <span class="site-name can-hide">Jonas Wolfxin Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home🏠</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">Navigation🧭</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front End" class="dropdown-title"><a href="/front/" class="link-title">Front End</a> <span class="title" style="display:none;">Front End</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Basics</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/css/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/javascript/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>Frame</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database" class="dropdown-title"><a href="/database/" class="link-title">Database</a> <span class="title" style="display:none;">Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/postgresql/" class="nav-link">PostgreSQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/pythonstrdy/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_basics/" class="nav-link">Python Basics</a></li><li class="dropdown-item"><!----> <a href="/python_advanced/" class="nav-link">Python Advanced</a></li><li class="dropdown-item"><!----> <a href="/python_projects/" class="nav-link">Python Projects</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络运维" class="dropdown-title"><a href="/tool/" class="link-title">网络运维</a> <span class="title" style="display:none;">网络运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>CCNA</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/91ab17/" class="nav-link">CCNA知识</a></li><li class="dropdown-subitem"><a href="/pages/55766c/" class="nav-link">CCNA题库</a></li><li class="dropdown-subitem"><a href="/pages/f61749/" class="nav-link">Cisco NetAca</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/4f0673/" class="nav-link">Ansible</a></li><li class="dropdown-item"><h4>版本管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="About" class="dropdown-title"><a href="/archives/" class="link-title">About</a> <span class="title" style="display:none;">About</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>This Blog</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">Categories</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">Tags</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">Archives</a></li></ul></li><li class="dropdown-item"><h4>About Me</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">Collection</a></li><li class="dropdown-subitem"><a href="/about/website/introduce/" class="nav-link">Introduction</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="星河万里" class="dropdown-title"><a href="/inGermany/" class="link-title">星河万里</a> <span class="title" style="display:none;">星河万里</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>德国驾照B级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8a9dd0/" class="nav-link">理论准备</a></li><li class="dropdown-subitem"><a href="/pages/b79ef5/" class="nav-link">实践准备</a></li></ul></li><li class="dropdown-item"><h4>星河万里</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bcf060/" class="nav-link">Vim操作</a></li><li class="dropdown-subitem"><a href="/pages/c11fcf/" class="nav-link">Gitemoji</a></li><li class="dropdown-subitem"><a href="/pages/055f2e/" class="nav-link">无妄经</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/message-board/" class="nav-link">MessageBoard📋</a></div> <a href="https://github.com/Jonas-Wolfxin/Jonas-Wolfxin.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202206092309359.png"> <div class="blogger-info"><h3>Jonas 林风</h3> <span>吾志所向，万夫不当；披荆斩棘，奋而继往。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home🏠</a></div><div class="nav-item"><a href="/navigation/" class="nav-link">Navigation🧭</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Front End" class="dropdown-title"><a href="/front/" class="link-title">Front End</a> <span class="title" style="display:none;">Front End</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Basics</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/css/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/javascript/" class="nav-link">JavaScript</a></li></ul></li><li class="dropdown-item"><h4>Frame</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Database" class="dropdown-title"><a href="/database/" class="link-title">Database</a> <span class="title" style="display:none;">Database</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/postgresql/" class="nav-link">PostgreSQL</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link">ElasticSearch</a></li><li class="dropdown-subitem"><a href="/mongodb/" class="nav-link">MongoDB</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/pythonstrdy/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_basics/" class="nav-link">Python Basics</a></li><li class="dropdown-item"><!----> <a href="/python_advanced/" class="nav-link">Python Advanced</a></li><li class="dropdown-item"><!----> <a href="/python_projects/" class="nav-link">Python Projects</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络运维" class="dropdown-title"><a href="/tool/" class="link-title">网络运维</a> <span class="title" style="display:none;">网络运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>CCNA</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/91ab17/" class="nav-link">CCNA知识</a></li><li class="dropdown-subitem"><a href="/pages/55766c/" class="nav-link">CCNA题库</a></li><li class="dropdown-subitem"><a href="/pages/f61749/" class="nav-link">Cisco NetAca</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/4f0673/" class="nav-link">Ansible</a></li><li class="dropdown-item"><h4>版本管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="About" class="dropdown-title"><a href="/archives/" class="link-title">About</a> <span class="title" style="display:none;">About</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>This Blog</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">Categories</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">Tags</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">Archives</a></li></ul></li><li class="dropdown-item"><h4>About Me</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">Collection</a></li><li class="dropdown-subitem"><a href="/about/website/introduce/" class="nav-link">Introduction</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="星河万里" class="dropdown-title"><a href="/inGermany/" class="link-title">星河万里</a> <span class="title" style="display:none;">星河万里</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>德国驾照B级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/8a9dd0/" class="nav-link">理论准备</a></li><li class="dropdown-subitem"><a href="/pages/b79ef5/" class="nav-link">实践准备</a></li></ul></li><li class="dropdown-item"><h4>星河万里</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bcf060/" class="nav-link">Vim操作</a></li><li class="dropdown-subitem"><a href="/pages/c11fcf/" class="nav-link">Gitemoji</a></li><li class="dropdown-subitem"><a href="/pages/055f2e/" class="nav-link">无妄经</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/message-board/" class="nav-link">MessageBoard📋</a></div> <a href="https://github.com/Jonas-Wolfxin/Jonas-Wolfxin.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>CCNA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>CCNA知识笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/1634eb/" class="sidebar-link">网络工程师的介绍</a></li><li><a href="/pages/91ab17/" class="sidebar-link">OSI Model</a></li><li><a href="/pages/68df0c/" class="sidebar-link">IP Addressing</a></li><li><a href="/pages/0cd5e5/" class="sidebar-link">TCP/IP Suite</a></li><li><a href="/pages/32e4ca/" class="sidebar-link">Comparison-TCP Vs UDP</a></li><li><a href="/pages/9876fd/" class="sidebar-link">Cisco IOS CLI</a></li><li><a href="/pages/fabc03/" class="sidebar-link">Switching_VLAN</a></li><li><a href="/pages/778234/" aria-current="page" class="active sidebar-link">Switching_STP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/778234/#comparison-of-stp-versions" class="sidebar-link">Comparison of STP versions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/778234/#ieee-standard-vs-cisco" class="sidebar-link">IEEE standard vs Cisco</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#stp-vs-rstp" class="sidebar-link">STP Vs RSTP</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#similarities-between-stp-and-rstp" class="sidebar-link">Similarities between STP and RSTP:</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#evolution-from-stp-to-rstp" class="sidebar-link">Evolution from STP to RSTP</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/778234/#stp-pvst" class="sidebar-link">STP &amp; PVST+</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/778234/#存在问题的网络拓扑设计" class="sidebar-link">存在问题的网络拓扑设计</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#单点故障的问题" class="sidebar-link">单点故障的问题</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#network-redundancy" class="sidebar-link">Network Redundancy</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#冗余拓扑的问题" class="sidebar-link">==冗余拓扑的问题==</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#spanning-tree-terms" class="sidebar-link">Spanning Tree Terms</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#bpdu" class="sidebar-link">BPDU</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#bridge-id" class="sidebar-link">Bridge ID</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#roles-of-switch-in-stp" class="sidebar-link">Roles of switch in STP</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#port-cost-port-id" class="sidebar-link">Port Cost &amp; Port ID</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#port-roles-in-stp" class="sidebar-link">Port roles in STP</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#versions-of-stp" class="sidebar-link">Versions of STP</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#stp的机制和执行过程" class="sidebar-link">STP的机制和执行过程</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#stp机制" class="sidebar-link">STP机制</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#stp执行过程" class="sidebar-link">STP执行过程</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#lab" class="sidebar-link">Lab</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#每个广播域选举一个根桥" class="sidebar-link">每个广播域选举一个根桥</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#在所有非根桥的交换机上选择出唯一的-root-port" class="sidebar-link">在所有非根桥的交换机上选择出唯一的 Root Port</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#在non-root-port的链路上选出一个-designated-port" class="sidebar-link">在Non-Root_Port的链路上选出一个 Designated Port</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#阻塞其他端口" class="sidebar-link">阻塞其他端口</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#four-port-states-of-stp" class="sidebar-link">Four Port States of STP</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#交换机的端口安全" class="sidebar-link">交换机的端口安全</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#stp-optional-features-toolkit" class="sidebar-link">STP Optional Features(Toolkit)</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#portfast" class="sidebar-link">Portfast</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#safeguard" class="sidebar-link">SafeGuard</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#root-loop-guard" class="sidebar-link">Root &amp; Loop Guard</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#uplinkfast" class="sidebar-link">UplinkFast</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#backbonefast" class="sidebar-link">BackboneFast</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#pvst-load-balancing" class="sidebar-link">PVST Load-Balancing</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#configure-stp-port-settings" class="sidebar-link">Configure STP Port Settings</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/778234/#rstp-802-1w-rapid-pvst" class="sidebar-link">RSTP(802.1W) &amp; rapid-PVST+</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/778234/#cost-2" class="sidebar-link">Cost:</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#port-states-2" class="sidebar-link">Port states:</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#port-roles-2" class="sidebar-link">Port Roles:</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#bpdus" class="sidebar-link">BPDUs</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#major-difference" class="sidebar-link">Major Difference</a></li><li class="sidebar-sub-header level4"><a href="/pages/778234/#bpdu-format" class="sidebar-link">BPDU format</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#rstp-link-types" class="sidebar-link">RSTP Link Types</a></li><li class="sidebar-sub-header level3"><a href="/pages/778234/#configuration-2" class="sidebar-link">Configuration</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/778234/#验证思科交换机的配置" class="sidebar-link">验证思科交换机的配置</a></li></ul></li><li><a href="/pages/85147b/" class="sidebar-link">Switching_EtherChannel</a></li><li><a href="/pages/087c56/" class="sidebar-link">Layer 2 Discovery Protocols</a></li><li><a href="/pages/6b8f16/" class="sidebar-link">Layer 2 Forwarding</a></li><li><a href="/pages/149f35/" class="sidebar-link">Routing_Static</a></li><li><a href="/pages/d70851/" class="sidebar-link">Dynamic Routing P1 RIP EIGRP</a></li><li><a href="/pages/c4055c/" class="sidebar-link">Dynamic Routing P2 OSPF</a></li><li><a href="/pages/32db2d/" class="sidebar-link">Layer 3 Forwarding</a></li><li><a href="/pages/fe5ceb/" class="sidebar-link">Virtual Routing and Forwarding</a></li><li><a href="/pages/bada2c/" class="sidebar-link">Layer 3 FHRPs</a></li><li><a href="/pages/81e45f/" class="sidebar-link">Security</a></li><li><a href="/pages/6bd28d/" class="sidebar-link">ACL</a></li><li><a href="/pages/7db05a/" class="sidebar-link">NAT 网络地址转换</a></li><li><a href="/pages/729891/" class="sidebar-link">LAN Architectures</a></li><li><a href="/pages/1076ba/" class="sidebar-link">WAN广域网</a></li><li><a href="/pages/441d7d/" class="sidebar-link">WLAN</a></li><li><a href="/pages/e31696/" class="sidebar-link">NTP</a></li><li><a href="/pages/c7a0a2/" class="sidebar-link">DNS</a></li><li><a href="/pages/d25cf6/" class="sidebar-link">Syslog</a></li><li><a href="/pages/c74f1d/" class="sidebar-link">Accessing the CLI of network devices</a></li><li><a href="/pages/5d3322/" class="sidebar-link">FTP TFTP</a></li><li><a href="/pages/e049f9/" class="sidebar-link">DHCP</a></li><li><a href="/pages/7ebd2e/" class="sidebar-link">SNMP</a></li><li><a href="/pages/bba118/" class="sidebar-link">Quality of service</a></li><li><a href="/pages/652496/" class="sidebar-link">Virtualization</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>CCNA题库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Cisco Networking Academy</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ansible</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>版本管理 - Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发管理 - Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>操作系统 - Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>容器部署 - Docker</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4" title="分类" data-v-06225672>网络运维</a></li><li data-v-06225672><a href="/categories/?category=CCNA" title="分类" data-v-06225672>CCNA</a></li><li data-v-06225672><a href="/categories/?category=CCNA%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B0" title="分类" data-v-06225672>CCNA知识笔记</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/Jonas-Wolfxin" target="_blank" title="作者" class="beLink" data-v-06225672>Jonas Wolfxin</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-03-25</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Switching_STP<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="stp-rstp"><a href="#stp-rstp" class="header-anchor">#</a> STP &amp; RSTP</h1> <h2 id="comparison-of-stp-versions"><a href="#comparison-of-stp-versions" class="header-anchor">#</a> Comparison of STP versions</h2> <h3 id="ieee-standard-vs-cisco"><a href="#ieee-standard-vs-cisco" class="header-anchor">#</a> IEEE standard vs Cisco</h3> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290734988.png" alt="image-20230329073416467" style="zoom:33%;"> <blockquote><ul><li><p>IEEE industry standards:</p> <ul><li><strong>STP(802.1D)</strong></li> <li><strong>RSTP(802.1W)</strong></li> <li><strong>MSTP(802.1s)</strong>(Multiple Spanning Tree Protocol):
<ul><li>it uses modified RSTP mechanics;</li> <li>the main improvement is that it can group multiple VLANs into different instances, for example if there are 10 VLANs, VLANs 1 to 5 in instance 1, and VLANs 6 to 10 in instance 2, to perform <strong>load balancing</strong>.</li> <li>Finally an industry standard version of STP that allows load balancing , and actually it's superior to Cisco’s rapid-PVST+.</li></ul></li></ul></li> <li><p>Cisco versions of <strong>Per_VLAN</strong> feature:</p> <ul><li><p><strong>PVST+</strong>: operates the same as <strong>STP(802.1D)</strong>, but with the addition of a separate instance for each VLAN.</p> <blockquote><ul><li>PVST(Per-VLAN Spanning Tree): only supported ISL trunk encapsulation(without dot1q); <strong>Deprecated!</strong></li> <li>The pvst and rapid-PVST in Cisco IOS are actually the <strong>plus</strong><code>+</code> version</li></ul></blockquote></li> <li><p><strong>Rapid PVST+</strong>: operates the same as <strong>RSTP(802.1W)</strong>, but with the addition of a separate instance for each VLAN.</p></li></ul></li></ul></blockquote> <blockquote><h5 id="why-is-mstp-superior-to-cisco-s-rapid-pvst"><a href="#why-is-mstp-superior-to-cisco-s-rapid-pvst" class="header-anchor">#</a> Why is MSTP superior to Cisco’s rapid-PVST+?</h5> <ul><li><p>If you have many VLANs, let’s say 200, in your network, configuring primary and secondary root bridges in each VLAN is a lot of work. However, with MSTP, all you have to do is assign VLANs 1 to 100 to instance 1, and VLANs 101 to 200 to instance 2, and then configure the primary and secondary root bridges for instance 1 and instance 2, so its much easier to configure and manage.</p></li> <li><p>Actually, Cisco hasn’t developed their own version of MSTP, Cisco devices simply run the industry standard 802.1s. <em>Rapid-PVST+ is the default on modern Cisco switches</em>.</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290908684.png" alt="image-20230329090851508" style="zoom:43%;"></li> <li><p>For large networks, it’s best to use MSTP, however for small to medium networks without a huge number of VLANs, Cisco’s Rapid PVST+ is what you’ll probably run on your switches.</p></li></ul></blockquote> <h3 id="stp-vs-rstp"><a href="#stp-vs-rstp" class="header-anchor">#</a> STP Vs RSTP</h3> <h4 id="similarities-between-stp-and-rstp"><a href="#similarities-between-stp-and-rstp" class="header-anchor">#</a> Similarities between STP and RSTP:</h4> <ul><li>RSTP serves the same purpose as STP, blocking specific ports to prevent Layer 2 loops.</li> <li>RSTP elects a root bridge with the same rules as STP.
<ul><li>lowest <strong>Bridge ID</strong></li></ul></li> <li>RSTP elects root ports with the same rules as STP.
<ol><li>lowest <em>Root Cost</em></li> <li>lowest <strong>neighbor Bridge ID</strong></li> <li>lowest <strong>neighbor Port ID</strong></li></ol></li> <li>RSTP elects designated ports with the same rules as STP.
<ol><li>lowest <em>Root Cost</em></li> <li>lowest <strong>Bridge ID</strong></li></ol></li></ul> <h4 id="evolution-from-stp-to-rstp"><a href="#evolution-from-stp-to-rstp" class="header-anchor">#</a> Evolution from STP to RSTP</h4> <blockquote><p>Cisco has said that RSTP isn’t a ‘revolution’ of STP, just an ‘evolution’. It made some major improvements to speed up STP, but it didn’t change it completely.</p> <ul><li>To accommodate for faster speeds, RSTP’s <strong>Cost</strong> values were expanded.</li> <li>RSTP simplifies the port states <em>from 5 states to 3 states</em>: (<strong>Discarding, Learning, Forwarding</strong>)</li> <li>Port Roles remain the <strong>almost same</strong> as STP (<strong>Root, Designated, Alternate, Backup</strong>)</li> <li>BPDUs: In RSTP, all switches originate and send their own BPDUs(with a different format with STP) from their Designated Ports.</li> <li>RSTP Link Types: <em>Edge, P2P, Shared</em></li></ul></blockquote> <h5 id="cost"><a href="#cost" class="header-anchor">#</a> Cost:</h5> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290800579.png" alt="image-20230329080003359" style="zoom:28%;"> <h5 id="port-states"><a href="#port-states" class="header-anchor">#</a> Port states:</h5> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290808370.png" alt="image-20230329080830011" style="zoom:30%;"> <blockquote><ul><li>the <strong>Blocking</strong> and <strong>Disabled</strong> port states were combined into <strong>Discarding</strong> state;</li> <li>the <strong>Listening</strong> state is simply not used.</li></ul></blockquote> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290811198.png" alt="image-20230329081136856" style="zoom:30%;"> <h5 id="port-roles"><a href="#port-roles" class="header-anchor">#</a> Port Roles:</h5> <blockquote><ul><li>The <strong>Root Port</strong> role remains <em>unchanged</em> in RSTP.</li> <li>The <strong>Designated Port</strong> role remains <em>unchanged</em> in RSTP.</li> <li>The <strong>Non-designated port</strong> role is split into two separate roles in RSTP:
<ul><li><strong>Alternate Port</strong> role</li> <li><strong>Backup Port</strong> role</li></ul></li></ul></blockquote> <hr> <h2 id="stp-pvst"><a href="#stp-pvst" class="header-anchor">#</a> STP &amp; PVST+</h2> <blockquote><ul><li><p>STP(802.1D) &amp; PVST+:</p> <ul><li><p>classic <strong>Spanning Tree Protocol</strong> is <strong>IEEE 802.1D</strong>;</p></li> <li><p>Cisco's version of STP called [<strong>PVST+ (Per-Vlan Spanning Tree plus)</strong>], which runs a separate spanning tree instance in each VLAN.</p> <ul><li>Cisco's older version of PVST+ is <strong>PVST</strong>, which doesn't support 802.1Q(only support cisco's ISL), so <strong>it's Deprecated! Forget it!</strong></li></ul></li></ul></li> <li><p>Switches from ALL vendors run STP by default;</p></li> <li><p>STP prevents Layer 2 loops by placing redundant ports in a <strong>blocking state</strong>, <em>essentially disabling the interface</em>; <em>Interfaces in a blocking state only send or receive STP messages (called BPDUs = Bridge Protocol Data Units)</em>.</p> <blockquote><p>Spanning Tree Protocol still uses the term ‘<strong>bridge</strong>’. However, when we use the term ‘bridge’, we really mean ‘<strong>switch</strong>’. Bridges are not used in modern networks.</p></blockquote></li> <li><p>These interfaces act as <strong>backups</strong> that can enter a forwarding state if an active (=currently forwarding) interface fails.</p></li> <li><p>Interfaces in a <strong>forwarding state</strong> behave normally. They send and receive all normal traffic.</p></li></ul></blockquote> <blockquote><h5 id="stp的主要功能是"><a href="#stp的主要功能是" class="header-anchor">#</a> STP的主要功能是</h5> <ul><li>Spanning tree is a Layer 2 protocol by the way, it enables redundant layer 2 networks;</li> <li>同时防止在第2层网络中因交换机之间的物理链路冗余而导致网络环路。它警惕地监视着网络以找出所有可用链路，并关闭任何冗余链路以确保不会出现环路。STP首先使用 生成树算法(STA) 创建一个拓扑数据库，然后找出并关闭冗余链路。运行STP后，数据帧就只能在STP选定的最优链路上进行转发。</li></ul></blockquote> <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207081848217.png" alt="image-20220708184828063" style="zoom:70%;"> <h3 id="存在问题的网络拓扑设计"><a href="#存在问题的网络拓扑设计" class="header-anchor">#</a> 存在问题的网络拓扑设计</h3> <h4 id="单点故障的问题"><a href="#单点故障的问题" class="header-anchor">#</a> <strong>单点故障</strong>的问题</h4> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303240251662.png" alt="image-20230324025124362" style="zoom:25%;"> <blockquote><h4 id="network-redundancy"><a href="#network-redundancy" class="header-anchor">#</a> Network Redundancy</h4> <p>to make sure that that infrastructure is resilient to failures as much as possible.</p> <ul><li><p>Redundancy is an essential part of network design;</p></li> <li><p>Modern networks are expected to run 24/7/365. Even a short downtime can be disastrous for a business;</p></li> <li><p>If one network component fails, you must ensure that other components will take over with little or no downtime;</p></li> <li><p>As much as possible, you must implement redundancy at every possible point in the network.</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303240252593.png" alt="image-20230324025212222" style="zoom:25%;"> <blockquote><p><strong>NOTE:</strong></p> <ul><li><p>Most PCs like shown in the picture only have a single Network Interface Card (NIC), so they can only be plugged into a single switch.</p></li> <li><p>However, important servers typically have multiple NICs, so they can be plugged into multiple switches for redundancy.</p></li></ul></blockquote></li></ul></blockquote> <h4 id="冗余拓扑的问题"><a href="#冗余拓扑的问题" class="header-anchor">#</a> ==冗余拓扑的问题==</h4> <blockquote><img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241312921.png" alt="image-20230324131213628" style="zoom:25%;"> <h5 id="broadcast-storm-广播风暴"><a href="#broadcast-storm-广播风暴" class="header-anchor">#</a> Broadcast Storm 广播风暴</h5> <p>The Ethernet header doesn’t have a TTL field. These broadcast frames will loop around the network indefinitely. If enough of these looped broadcasts accumulate in the network, the network will be too congested for legitimate traffic to use the network. This is called a <strong>broadcast storm</strong>.</p> <h5 id="mac-address-flapping-不稳定"><a href="#mac-address-flapping-不稳定" class="header-anchor">#</a> MAC Address Flapping(不稳定)</h5> <p>Network congestion isn’t the only problem. Each time a frame arrives on a switchport, the switch uses the source MAC address field to ‘learn’ the MAC address and update its MAC address table. When frames with the same source MAC address repeatedly arrive on different interfaces, the switch is continuously updating the interface in its MAC address table. This is known as <strong>MAC Address Flapping</strong>.</p> <p>In shorts, When a switch rapidly and continuously updates a MAC address in its MAC address table, alternating between different interfaces, this is known as [<strong>MAC Address Flapping</strong>].</p> <h5 id="多帧复制"><a href="#多帧复制" class="header-anchor">#</a> 多帧复制</h5> <p>End-hosts would receive so many copied frame</p></blockquote> <p>由此, STP协议默认是开启的, 因为一旦存在二层环路的网络运转起来，要想找出问题的根源会超级困难!</p> <h3 id="spanning-tree-terms"><a href="#spanning-tree-terms" class="header-anchor">#</a> Spanning Tree Terms</h3> <h4 id="bpdu"><a href="#bpdu" class="header-anchor">#</a> BPDU</h4> <blockquote><ul><li>Classic STP (not Cisco’s PVST+) uses a destination MAC address of <code>0180.c200.0000</code>;</li> <li>Cisco’s <strong>PVST+</strong> uses the <strong>destination MAC address</strong> of <code>0100.0ccc.cccd</code> for its BPDUs.
<ul><li><strong>PVST</strong> = Only support <strong>ISL</strong> trunk encapsulation;</li> <li><strong>PVST+</strong> = Supports 802.1Q;</li></ul></li> <li>When a switch is powered on, it assumes it is the root bridge, So all switches send BPDUs. Each switch compares the parameters in the <strong>Bridge Protocol Data Unit (BPDU)</strong> that it sends to one neighbor with the ones that it receives from other neighbors.
<ul><li>It will only give up its position if it receives a ‘superior’ BPDU (lower bridge ID).</li> <li><em>Once the topology has converged and all switches agree on the root bridge, only the root bridge sends BPDUs.</em></li> <li>Other switches in the network will forward these BPDUs only on the Designated Ports, but will not generate their own original BPDUs.</li></ul></li> <li>BPDU frame format: <a href="https://www.ii.pwr.edu.pl/~kano/course/module4/4.1.2.5/4.1.2.5.html" target="_blank" rel="noopener noreferrer">https://www.ii.pwr.edu.pl/~kano/course/module4/4.1.2.5/4.1.2.5.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304030742481.png" alt="image-20230403074208324" style="zoom:67%;"> <ul><li><p>The first three fields are the</p> <ul><li><p><strong>Protocol IDentifier</strong>, which is always 0x0000 for spanning tree;</p></li> <li><p><strong>Version</strong>: set to 0 for classic STP; set to 22 for RSTP;</p></li> <li><p><strong>BPDU type</strong> is hexadecimal 00 for what’s called a ‘<strong>configuration BPDU</strong>’.</p> <blockquote><p>There are other types of BPDUs, but we don’t need to go that in depth for the CCNA.</p></blockquote></li></ul></li> <li><p><strong>Flags</strong>: used to signal topology changes to other switches.</p></li> <li><p><strong>Root ID</strong>: Bridge ID of Root Bridge of the broadcast domain.</p></li> <li><p><strong>Root path cost</strong>: Root Cost to the <strong>Root Bridge</strong>, 0 means <strong>Root Bridge</strong> itself;</p></li> <li><p><strong>Bridge ID</strong>:</p> <p>= 4 bits <strong>Bridge Priority</strong> + 12 bits <strong>Extended System ID(VLAN ID)</strong> + 48 bits <strong>MAC Address</strong>.</p></li> <li><p><strong>Port ID</strong>: 0x8002 can be divided and translated to decimal 128 &amp; 2(128.2)</p> <ul><li>80 in hexadecimal is equivalent to 128, which is the default priority;</li> <li>02 in hexadecimal is the serial number of the port itself.</li></ul></li> <li><p><strong>Message Age</strong>: it starts at <strong>0</strong> at the root bridge and is increased by <strong>1</strong> each time it is forwarded by another switch. It is subtracted from the max age when a switch receives the BPDU, so for example if the BPDU is passed through 5 switches, when it reaches the 6th bridge it will immediately reduce its max age timer to 15, meaning each time it receives a BPDU its max age will reset to 15 instead of 20, even though the max age timer is 20.</p></li></ul> <hr> <ul><li><strong>Max Age</strong>: defines How long(20s by default) an interface will wait after ceasing(停止) to receive Hello BDPUs to change the STP topology.
<ul><li><p>If another BPDU is received before the max age timer counts down to 0, the time will reset to 20 seconds and no changes will occur.</p></li> <li><p>If another BPDU is not received, the max age timer counts down to 0 and the switch will reevaluate its STP choices, including root bridge, and local root, designated, and non-designated ports.</p></li> <li><p>If a non-designated port is selected to become a designated or root port, it will transition from the blocking state to the listening state (15 seconds), learning state (15 seconds), and then finally the forwarding state. So, it can take <strong>a total of 50 seconds</strong> for a blocking interface to transition to forwarding.</p></li></ul></li> <li><strong>Hello time</strong>: the Hello BPDUs will be sent every 2 seconds by default;</li> <li><strong>Forward delay</strong> means the time it takes to transition a port from listening to learning mode (also from learning to forwarding mode), which is set to 15 seconds by default and can be seen in the <code>show spanning-tree</code> output.</li></ul> <blockquote><p><em>The STP timers on the [<strong>Root Bridge</strong>] determine the timers used for all switches in the network!</em></p></blockquote></blockquote> <h4 id="bridge-id"><a href="#bridge-id" class="header-anchor">#</a> Bridge ID</h4> <blockquote><p>It is determined by a combination of the <strong>Bridge Priority</strong> (32768 by default on all Cisco switches) and <strong>the MAC address</strong> of each Switchport.</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241338276.png" alt="image-20230324133815007" style="zoom:29%;"> <h6 id="详解-bridge-id"><a href="#详解-bridge-id" class="header-anchor">#</a> 详解 Bridge ID</h6> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241342149.png" alt="image-20230324134238878" style="zoom:29%;"> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241345376.png" alt="image-20230324134536110" style="zoom:30%;"> <ul><li>The <strong>bridge priority</strong> + <strong>extended system ID</strong> is a single field of the bridge ID, however the extended system ID is set and cannot be changed (because it is determined by the VLAN ID.
<ul><li><strong>Therefore, the STP bridge priority can only be changed in units of 4096</strong>. The valid values you can configure are: 0, 4096, 8192, 12288, 16384, 20480, 24576, 28672, 32768, 36864, 40960, 45056, 49152, 53248, 57344, or 61440.</li> <li>The Extended System ID will then be added to this number to make the total bridge priority.</li></ul></li></ul></blockquote> <h4 id="roles-of-switch-in-stp"><a href="#roles-of-switch-in-stp" class="header-anchor">#</a> Roles of switch in STP</h4> <blockquote><ul><li><code>Root bridge</code>:
<ul><li><strong>The switch with the lowest Bridge ID becomes the root bridge.</strong></li> <li><strong>ALL ports on the root bridge are <code>Designated Port</code> put in a forwarding state, and other switches in the topology must have a path to reach the root bridge</strong>.</li> <li>All other decisions in the network, such as which port is to be blocked and which port is to be put in forwarding mode are made from the perspective of this root bridge. Once a root bridge is elected on the network, all other bridges must make a single path to this root bridge. The port with the lowest-cost path to the root bridge is called the <strong>root port</strong>.</li></ul></li> <li><code>Non-root bridges</code> These are all bridges that are not the root bridge. Non-root bridges exchange BPDUs with all bridges and update the STP topology database on all switches, preventing loops and providing a measure of defense against link failures.</li></ul></blockquote> <blockquote><h5 id="configure-the-root-bridge"><a href="#configure-the-root-bridge" class="header-anchor">#</a> Configure the Root Bridge:</h5> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>SW1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree vlan 1 ?</span>
 priority  Set the bridge priority <span class="token keyword">for</span> the spanning tree
 root      Configure switch as root
 <span class="token operator">&lt;</span>cr<span class="token operator">&gt;</span>

SW1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree vlan 1 root ?</span>
 primary    Configure this switch as primary root <span class="token keyword">for</span> this spanning tree
 secondary  Configure switch as secondary root
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>The <code>spanning-tree vlan VLAN_ID root primary</code> command sets the STP priority to [<strong>24576</strong>], or [<strong>4096 less than the current root's priority</strong>} <code>at one time</code>.</li> <li>The <code>spanning-tree vlan VLAN_ID root secondary</code> command sets the STP priority to a <em>fixed value</em> of [<strong>28672</strong>], which can let the switch with the second-lowest priority(<strong>32678 by default -&gt; <code>root primary</code>: 24576; <code>root secondary</code>: 28672</strong>), which allows the switch to be next in line to become the root bridge if the current Root Bridge fails.</li></ul></blockquote> <h4 id="port-cost-port-id"><a href="#port-cost-port-id" class="header-anchor">#</a> Port Cost &amp; Port ID</h4> <blockquote><h5 id="port-cost"><a href="#port-cost" class="header-anchor">#</a> <code>Port cost</code></h5> <ul><li>Port cost determines the best path when multiple links are used between two switches.</li> <li><strong>Root Cost</strong> = <strong>port_cost</strong> + <strong>path_cost_to_root</strong> <ul><li><strong>Port_cost</strong> is a fixed value assigned to each port on a switch, and it is based on the speed of the port.</li> <li><strong>Path_cost_to_root</strong> is the sum of the port costs on the path from the switch to the root bridge. This value is determined by the STP algorithm and can be viewed using the &quot;show spanning-tree&quot; command on a Cisco switch. <em>The cost of a link is determined by the bandwidth of the link.</em></li></ul></li></ul> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303291053426.png" alt="image-20230324141422589" style="zoom:28%;"> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303291053710.png" alt="image-20230325060559199" style="zoom:33%;"> <blockquote><p>The ports connected to <em>another switch’s Root Port</em> MUST be <strong>Designated Port</strong>. Because the <strong>Root Port is the switch’s path to the root bridge</strong>, another switch must not block it.</p></blockquote> <h5 id="port-id"><a href="#port-id" class="header-anchor">#</a> <code>Port ID</code>:</h5> <p><code>= Port Priority(default 128) + Port Number</code>. Notice the column title is <em>Prio dot number</em>, So, each port has a <strong>default priority of 128</strong>, and then a <strong>unique port number</strong>, 1 for G0/0, 2 for G0/1, etc on this switch.</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241508858.png" alt="image-20230324150853533" style="zoom:33%;"></blockquote> <h4 id="port-roles-in-stp"><a href="#port-roles-in-stp" class="header-anchor">#</a> Port roles in STP</h4> <blockquote><ul><li><p><code>Root port</code> The root port is always the <em>interface directly connected to the root bridge</em>, or <em>the lowest path cost to the root bridge</em>. <a href="#STP%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B:">Click to see the whole Selection process</a></p> <ul><li>Any Non-Root Bridge has only one Root Port.</li></ul></li> <li><p><code>Designated port</code>:</p> <ul><li><p><strong>All interfaces on the root bridge are designated ports.</strong></p></li> <li><p>A designated port is one that has been determined as <strong>having the best (lowest) cost to the root bridge via its root port</strong>.</p></li> <li><p>A stable designated port will be marked as a forwarding port.</p></li> <li><p>After STP convergence, The switches will <strong>only forward BPDUs on their DESIGNATED PORTs</strong>.</p></li></ul></li></ul> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303250107855.png" alt="image-20230325010741565" style="zoom:33%;"> <ul><li><code>Non-designated port</code> A non-designated port is one with a higher cost than the designated port. They are what’s left over after the root ports and designated ports have been determined. Non-designated ports are put in blocking mode, they are not forwarding ports.</li></ul></blockquote> <h3 id="versions-of-stp"><a href="#versions-of-stp" class="header-anchor">#</a> Versions of STP</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree ? </span>
  mode      Spanning tree operating mode  
  portfast  Spanning tree portfast options
  vlan      VLAN Switch Spanning Tree
  
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree mode ?</span>
  mst 		  Multiple spanning tree mode
  pvst		  Per-VLAN spanning tree mode
  rapid-pvst  Per-VLAN rapid spanning tree mode
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><ul><li><strong>mst</strong>: Multiple spanning tree (not for CCNA)</li> <li><strong>pvst</strong> is the classic spanning tree but with Cisco’s per-vlan addition;</li> <li><strong>rapid-pvst</strong>: is an improved version. Modern Cisco switches run <strong>rapid-PVST by default</strong>, and usually there is no reason to change it.</li></ul></blockquote> <h3 id="stp的机制和执行过程"><a href="#stp的机制和执行过程" class="header-anchor">#</a> STP的机制和执行过程</h3> <h4 id="stp机制"><a href="#stp机制" class="header-anchor">#</a> STP机制</h4> <blockquote><ul><li><p>By selecting which ports are forwarding and which ports are blocking, STP creates a single path to/from each point in the network. This prevents Layer 2 loops.</p></li> <li><p><em>STP-enabled switches send/receive Hello BPDUs out of all interfaces, the default timer is 2 seconds</em> (the switch will send a Hello BPDU out of every interface, once every 2 seconds).</p></li> <li><p>If a switch receives a Hello BPDU on an interface, it knows that interface is connected to another switch (routers, PCs, etc. do not run STP, so they do not send Hello BPDUs).</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241328145.png" alt="image-20230324132801870" style="zoom:25%;"></li> <li><p>一旦所有的交换机都同意将某台交换机选为根桥，每个网桥就必须找出属于它自己的一个并且也是唯一一个分派的根端口。任意两台交换机之间的链路必须要有一个且只能有一个指定端口，该端口位于能够提供到根桥最大带宽的链路上(lowest Root Cost)。注意，一个网桥可以通过多个其他网桥到达根桥，也就是说这一路径可能不是物理上的最短路径，但一定是最快(具有最大带宽)路径;</p></li> <li><p>Every collision domain has a single STP designated port.</p></li> <li><p>那些既不是根端口也不是指定端口的端口，也就是那些非根端口和非指定端口，全部被设置为阻塞状态，这样就避免了交换环路的形成。</p></li></ul></blockquote> <h4 id="stp执行过程"><a href="#stp执行过程" class="header-anchor">#</a> STP执行过程</h4> <blockquote><ol><li><p>All switches exchange BPDUs after power on. The switch with the <strong>lowest Bridge ID</strong> is elected as the <strong>Root Bridge</strong>. <strong>All ports on the root bridge are designated ports</strong>(forwarding state).</p></li> <li><p>Each remaining switch will select <strong>ONE</strong> of its interfaces to be its unique <strong>Root Port</strong>(also in forwarding state).</p> <blockquote><p><strong>Root Port selection:</strong></p> <ol><li><p>The interface with the lowest <strong>Root Cost</strong> will be the root port.</p></li> <li><p>if the Root Cost of several ports are equal, then the port with lowest <strong>neighbor Bridge ID</strong> will be Root Port.</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241440308.png" alt="image-20230324144054077" style="zoom:33%;"></li> <li><p>if two switches have two connections between them, so both the root cost and the neighbor bridge ID are the same, the interface connected to <strong>the interface on the neighbor switch with the lowest port ID</strong> will become the root port.</p></li></ol> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303250527243.png" alt="image-20230324154202907" style="zoom:33%;"></blockquote></li> <li><p>Each remaining collision domain will select ONE interface to be a <strong>Designated Port</strong> (forwarding state). The other port in the collision domain will be non-designated (blocking).</p> <blockquote><p><strong>Designated Port selection:</strong></p> <ol><li><em>The switch</em> with the lowest <strong>Root Cost</strong> will make its port designated.</li> <li>If the root cost is the same, <em>the switch</em> with the lowest <strong>Bridge ID</strong> will make its port designated.</li></ol></blockquote></li></ol> <h5 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h5> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241553669.png" alt="image-20230324155324280" style="zoom:33%;"> <h5 id="quiz"><a href="#quiz" class="header-anchor">#</a> Quiz</h5> <h6 id="quiz-1"><a href="#quiz-1" class="header-anchor">#</a> Quiz 1</h6> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241602980.png" alt="image-20230324160225671" style="zoom:33%;"> <h6 id="quiz-2"><a href="#quiz-2" class="header-anchor">#</a> Quiz 2</h6> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303241612303.png" alt="image-20230324161233056" style="zoom:33%;"></blockquote> <h3 id="lab"><a href="#lab" class="header-anchor">#</a> Lab</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>SW2<span class="token comment">#show spanning-tree ?</span>
  active             Report on active interfaces only
  detail             Detailed information
  inconsistentports  Show inconsistent ports
  interface          Spanning Tree interface status and configuration
  summary            Summary of port states
  vlan               VLAN Switch Spanning Trees
  <span class="token operator">&lt;</span>cr<span class="token operator">&gt;</span>

SW2<span class="token comment">#show spanning-tree </span>
VLAN0001
  Spanning tree enabled protocol ieee  <span class="token comment"># it’s Cisco’s PVST, but this means it’s in ‘classic’ mode rather than than the newer rapid spanning tree</span>
  Root ID    Priority    <span class="token number">24577</span>
             Address     00E0.F9E6.44A5
             Cost        <span class="token number">8</span>    <span class="token comment"># cost of root path</span>
             Port        <span class="token number">25</span><span class="token punctuation">(</span>GigabitEthernet0/1<span class="token punctuation">)</span>
             Hello Time  <span class="token number">2</span> sec  Max Age <span class="token number">20</span> sec  Forward Delay <span class="token number">15</span> sec

  Bridge ID  Priority    <span class="token number">28673</span>  <span class="token punctuation">(</span>priority <span class="token number">28672</span> sys-id-ext <span class="token number">1</span><span class="token punctuation">)</span>
             Address     0002.16D6.D0B8
             Hello Time  <span class="token number">2</span> sec  Max Age <span class="token number">20</span> sec  Forward Delay <span class="token number">15</span> sec
             Aging Time  <span class="token number">20</span>
        <span class="token comment"># Port path cost, which means the cost of each node-to-node Link</span>
Interface        Role Sts Cost      Prio.Nbr Type
---------------- ---- --- --------- -------- --------------------------------
Fa0/4            Desg FWD <span class="token number">19</span>        <span class="token number">128.4</span>    P2p       <span class="token comment"># Desg 为 Designed Port</span>
Fa0/1            Desg FWD <span class="token number">19</span>        <span class="token number">128.1</span>    P2p
Fa0/2            Desg FWD <span class="token number">19</span>        <span class="token number">128.2</span>    P2p       
Fa0/3            Altn BLK <span class="token number">19</span>        <span class="token number">128.3</span>    P2p       <span class="token comment"># Altn 为 Blocking State</span>
Gi0/1            Root FWD <span class="token number">4</span>         <span class="token number">128.25</span>   P2p       <span class="token comment"># Root 为 Root Port</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="每个广播域选举一个根桥"><a href="#每个广播域选举一个根桥" class="header-anchor">#</a> 每个广播域选举一个根桥</h4> <blockquote><ul><li>具有最低的Bridge ID的交换机被选为Root Bridge</li> <li><em>all the interfaces on Root Bridge</em> are <strong>Designated Port</strong>;</li></ul></blockquote> <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220622000654205.png" alt="image-20220622000654205" style="zoom:40%;"> <blockquote><ul><li><p>交换机向广播域内每隔2秒互相发出一个BPDU报文;</p></li> <li><p>BPDU报文中的 Bridge ID最小的被选为 Root Bridge;</p> <ul><li><p>Bridge ID 由 2 Bytes的Priority 和 6 Bytes的MAC地址组成; 而默认的优先级为 32678;</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch<span class="token comment"># show spanning-tree brief</span>
                                                       Hello  Max  Fwd
    Vlan                         Bridge ID              Time  Age  Dly  Protocol
    ---------------- --------------------------------- -----  ---  ---  --------
    VLAN0001         <span class="token number">32769</span> <span class="token punctuation">(</span><span class="token number">32768</span>,   <span class="token number">1</span><span class="token punctuation">)</span> aabb.cc00.2000    <span class="token number">2</span>    <span class="token number">20</span>   <span class="token number">15</span>  rstp        
    VLAN0002         <span class="token number">32770</span> <span class="token punctuation">(</span><span class="token number">32768</span>,   <span class="token number">2</span><span class="token punctuation">)</span> aabb.cc00.2000    <span class="token number">2</span>    <span class="token number">20</span>   <span class="token number">15</span>  rstp  
<span class="token comment"># 这里的 Bridge ID 实际上是由交换机和 VLAN ID 构成的生成树桥ID的信息， VLAN 1 被表示为VLAN0001，注意每个VLAN 都可以有不同的根桥。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>如果两个交换机的Priority值不加以修改, 则 MAC地址将决定 哪个交换机具有最低的Bridge ID;</p></li> <li><p>Priority的取值是分散的, 以 4096 为间隔递增:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#  在当前的交换机上, 设置在指定 VLAN 的生成树的 Priority值</span>
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree vlan 1 priority 9182</span>
% Bridge Priority must be <span class="token keyword">in</span> increments of <span class="token number">4096</span>.
% Allowed values are: 
  <span class="token number">0</span>     <span class="token number">4096</span>  <span class="token number">8192</span>  <span class="token number">12288</span> <span class="token number">16384</span> <span class="token number">20480</span> <span class="token number">24576</span> <span class="token number">28672</span>
  <span class="token number">32768</span> <span class="token number">36864</span> <span class="token number">40960</span> <span class="token number">45056</span> <span class="token number">49152</span> <span class="token number">53248</span> <span class="token number">57344</span> <span class="token number">61440</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li></ul></blockquote> <blockquote><p>也可以直接设置指定交换机为根桥:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>S1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree vlan 1 root ?</span>
   primary Configure this switch as primary root <span class="token keyword">for</span> this spanning tree
   secondary Configure switch as secondary root
S1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree vlan 1 root primary</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></blockquote> <h4 id="在所有非根桥的交换机上选择出唯一的-root-port"><a href="#在所有非根桥的交换机上选择出唯一的-root-port" class="header-anchor">#</a> 在所有非根桥的交换机上选择出唯一的 Root Port</h4> <blockquote><ul><li><p>Root Port selection:</p> <ul><li><p>到达Root Bridge的lowest root cost的交换机接口;</p></li> <li><p>若Root Cost相等, 则比较<code>上一个BPDU发送者的Bridge ID</code>;</p></li> <li><p>如果一致, 则比较<code>上一个BPDU发送者的Port ID</code>(包含了 <em>port priority</em>和 <em>物理口编号</em>)</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 交换机端口的 Port-priority值, 取值是离散的: 0, 64, 128, 192</span>
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int e0/1</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#spanning-tree vlan 1 port-priority ?</span>
  <span class="token operator">&lt;</span><span class="token number">0</span>-19<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>  port priority <span class="token keyword">in</span> increments of <span class="token number">64</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li> <li><p>Root Port的链路的另一端必定是 <strong>Designated Port</strong>;</p></li></ul></blockquote> <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220622005432148.png" alt="image-20220622005432148" style="zoom:47%;"> <h4 id="在non-root-port的链路上选出一个-designated-port"><a href="#在non-root-port的链路上选出一个-designated-port" class="header-anchor">#</a> 在Non-Root_Port的链路上选出一个 Designated Port</h4> <blockquote><ol><li><strong>The switch with the lowest Root Cost</strong> will make its port designated.</li> <li>If the root cost is the same, <strong>the switch with the lowest Bridge ID</strong> will make its port designated.</li></ol></blockquote> <h4 id="阻塞其他端口"><a href="#阻塞其他端口" class="header-anchor">#</a> 阻塞其他端口</h4> <p>Non-Designed Port为阻塞端口(Blocking state)</p> <h3 id="four-port-states-of-stp"><a href="#four-port-states-of-stp" class="header-anchor">#</a> Four Port States of STP</h3> <blockquote><h5 id="stp-convergence-收敛"><a href="#stp-convergence-收敛" class="header-anchor">#</a> STP Convergence(收敛)</h5> <ul><li><p>Convergence occurs when all ports on bridges and switches have transitioned to either forwarding or blocking states. No data will be forwarded until convergence is complete. Yes—you read that right: When STP is converging, all host data stops transmitting!</p></li> <li><p>By creating your physical switch design in a hierarchical manner, as shown in Figure, you can make your Core switch the STP root, which will then make STP convergence time nice and quick.</p></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207092051674.png" alt="image-20220709164505688"></p> <hr> <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220622021653187.png" alt="image-20220622021653187" style="zoom:50%;"> <blockquote><ul><li>A forwarding interface can move directly to a blocking state (there is no worry about creating a loop by blocking an interface).</li> <li>A blocking interface cannot move directly to forwarding state. It must go through the listening and learning states.</li></ul></blockquote> <h5 id="blocking-stable-state"><a href="#blocking-stable-state" class="header-anchor">#</a> <code>Blocking</code>: <strong>stable</strong> state</h5> <ul><li>The purpose of the blocking state is to prevent loops at Layer-2 Data Link layer;</li> <li>Only <strong>receive</strong> BPDUs, and <strong>does NOT forward</strong> regular network traffic;</li> <li>DO NOT learn MAC address from regular traffic that arrives on the interface but just DROP it;</li> <li>All ports are in <em>blocking state by default</em> when the switch is powered up;</li> <li>Non-designated ports remain stable in a Blocking state.</li></ul> <h5 id="listening-transitional-state"><a href="#listening-transitional-state" class="header-anchor">#</a> <code>Listening</code>: <strong>transitional</strong> state</h5> <ul><li>After the Blocking state, <strong>Only interfaces with the Designated or Root role</strong> enter the Listening state. (Non-designated ports always remain Blocking).</li> <li>The Listening state is <em>15 seconds long by default</em>. This is determined by the <strong>Forward delay</strong> timer.</li> <li>ONLY <strong>forwards</strong> STP BPDUs, and <strong>does NOT forward</strong> regular traffic;</li> <li><strong>DO NOT learn MAC</strong> address from regular traffic that arrives on the interface but just DROP it;</li></ul> <h5 id="learning-transitional-state"><a href="#learning-transitional-state" class="header-anchor">#</a> <code>Learning</code>: <strong>transitional</strong> state</h5> <ul><li>After the Listening state, Designated or Root ports will enter the Learning state.</li> <li>The Learning state is <strong>15 seconds long by default</strong>. This is also determined by the <strong>Forward delay</strong> timer (the same timer is used for both the Listening and Learning states)</li> <li>ONLY <strong>forwards</strong> STP BPDUs and <strong>does NOT forward</strong> regular traffic.</li> <li>However, A port in learning state populates the MAC address table but <em>still doesn’t forward data frames</em>.</li></ul> <h5 id="forwarding-stable-state"><a href="#forwarding-stable-state" class="header-anchor">#</a> <code>Forwarding</code>: <strong>stable</strong> state</h5> <ul><li>After the Learning state, <em>Root/Designated ports remain stable in a Forwarding state.</em></li> <li>A port in the Forwarding state operate as normal:</li> <li><strong>forwards</strong> BPDUs;</li> <li><strong>forwards</strong> regular network traffic;</li> <li>learns MAC addresses;</li></ul> <hr> <ul><li><strong>disabled</strong> state means the interface is shutdown, doesn't play any role in STP.</li></ul> <h5 id="summary-2"><a href="#summary-2" class="header-anchor">#</a> Summary</h5> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202306280610706.png" alt="image-20230628061031571" style="zoom:67%;"></blockquote> <h3 id="交换机的端口安全"><a href="#交换机的端口安全" class="header-anchor">#</a> 交换机的端口安全</h3> <blockquote><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch<span class="token comment">#config t</span>
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/1</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport mode access</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport port-security ?</span>
aging Port-security aging commands
mac-address Secure mac address
maximum Max secure addresses
violation Security violation mode
<span class="token operator">&lt;</span>cr<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>Since all Cisco’s latest switches ship with the ports in <strong>desirable mode</strong> <em>(the port desires to trunk if it senses another switch just connected)</em>, we must first change the port from desirable mode to <code>access mode</code> or we cannot configure port security. Once that is done, we can continue on with our port-security commands.</li> <li>You can see clearly in the preceding output that the switch port port-security command can be used with four options:</li> <li><code>switchport port-security mac-address</code>: to assign individual MAC addresses to each switch port, but if you choose to go there, you’d better have a lot of time on your hands!</li> <li>如果需要将交换机的端口设置为，每个端口只允许接入一台主机，并且当有人破坏这一规则时，端口就会关闭，那么，完成这样的配置可以使用下列命令:</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport port-security maximum 1</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport port-security violation shutdown</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>一旦这种情况发生，只能在交换机上手工使用<code>no shutdown</code>命令来恢复端口的启用。</p></blockquote> <ul><li>接入&quot;stick&quot; 端口的前两个地址被认定为静态地址，并且不管在aging命令中设置了多长时间，它们一直会是静态地址。为什么这里要将它设置为2 呢?这是因为其中一个地址将用于PC机，而另一个用于电话机。</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport port-security maximum 2</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport port-security mac-address sticky</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#switchport port-security violation shutdown</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></blockquote> <h3 id="stp-optional-features-toolkit"><a href="#stp-optional-features-toolkit" class="header-anchor">#</a> STP Optional Features(Toolkit)</h3> <h4 id="portfast"><a href="#portfast" class="header-anchor">#</a> Portfast</h4> <blockquote><p>在交换机端口上，从<code>Blocking状态</code>到<code>Forwarding状态</code>的Classic STP 拓扑的收敛时间通常需要<strong>50秒</strong>(20s的Max Age + 30s state-changing from Blocking to Forwarding(Listening -15s-&gt; Learing -15s-&gt; Forwarding))，这样在服务器或主机上就会引发超时的问题，比如，在重启交换机的时候。</p> <ul><li>针对这样的问题，可以在Access Layer交换机的<strong>Access端口(connected to End Hosts)<strong>上开启<code>Portfast</code>来</strong>禁用STP协议</strong>。 在端口上开启此功能之后,插入终端设备可以bypass <em>Listening</em>和<em>Learning</em> 阶段, 只需要 1s 左右就可以从 Blocking 直接进入 Forwarding state.</li> <li>You can still configure portfast on a trunk port, it just won’t take effect.</li> <li>However, if another switch is connected to the interface within Portfast mode of one switch, it still can cause Broadcast Storm and other problems. -&gt; <code>BPDU Guard</code></li></ul></blockquote> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 设置所有的Access接口为 Portfast</span>
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree portfast ? </span>
  bpduguard  <span class="token comment"># Enable portfast bpdu guard on this switch</span>
  default    <span class="token comment"># Enable portfast by default on all access ports</span>
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree portfast default</span>
  
<span class="token comment"># 设置指定接口为 portfast</span>
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int range fastEthernet 0/1 - 12</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#spanning-tree portfast ?</span>
    disable Disable portfast <span class="token keyword">for</span> this interface
    trunk Enable portfast on the interface even <span class="token keyword">in</span> trunk mode
    <span class="token operator">&lt;</span>cr<span class="token operator">&gt;</span>
Switch<span class="token punctuation">(</span>config-if-range<span class="token punctuation">)</span><span class="token comment">#spanning-tree portfast</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="safeguard"><a href="#safeguard" class="header-anchor">#</a> SafeGuard</h4> <p>Two kinds of SafeGuard working with Portfast</p> <h6 id="bpdu-guard"><a href="#bpdu-guard" class="header-anchor">#</a> BPDU guard</h6> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#You can also enable BPDU Guard with the following command: </span>
SW3<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree portfast ?</span>
  bpduguard  Enable portfast bpdu guard on this switch
  default    Enable portfast by default on all access ports
SW1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># spanning-tree portfast bpduguard default   </span>
<span class="token comment"># This enables BPDU Guard on all Portfast-enabled interfaces.</span>

<span class="token comment"># 在指定接口上开启 BPDU Guard</span>
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int f0/3</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#spanning-tree bpduguard ?</span>
	disable  Disable BPDU guard <span class="token keyword">for</span> this interface
	<span class="token builtin class-name">enable</span>   Enable BPDU guard <span class="token keyword">for</span> this interface
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#spanning-tree bpduguard enable</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>If an interface with BPDU Guard enabled receives a BPDU from another switch, the interface will be shut down to prevent a loop from forming. 当交换机的Portfast接口开启 BPDUguard 后, 当此接口插入交换机(接收到BPDU报文)就会变成``err-disable`状态.</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303250231151.png" alt="image-20230325023132938" style="zoom:33%;"> <h6 id="how-to-reactive-the-port-after-remove-the-connection"><a href="#how-to-reactive-the-port-after-remove-the-connection" class="header-anchor">#</a> How to reactive the port after remove the connection?</h6> <p><code>shutdown</code> the interface, and then <code>no shutdown</code>:</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303250233455.png" alt="image-20230325023316288" style="zoom:33%;"></blockquote> <h6 id="bpdu-filter"><a href="#bpdu-filter" class="header-anchor">#</a> BPDU Filter</h6> <blockquote><p>当access layer的交换机的指定接口开启 bpdufilter 之后, 如果BPDU Filter 接收到了一个BPDU ，它会立即关闭端口的PortFast，并迫使端口重新成为STP拓扑的一部分.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#spanning-tree bpdufilter ?</span>
 	disable  Disable BPDU filtering <span class="token keyword">for</span> this interface
 	<span class="token builtin class-name">enable</span>   Enable BPDU filtering <span class="token keyword">for</span> this interface
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></blockquote> <h4 id="root-loop-guard"><a href="#root-loop-guard" class="header-anchor">#</a> Root &amp; Loop Guard</h4> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303250238835.png" alt="image-20230325023832577" style="zoom:33%;"> <blockquote><ul><li><strong>Root Guard</strong>: helps maintain the spanning tree topology if someone plugs another switch into the network either with bad intent, or perhaps without knowing the impact of their action.</li> <li><strong>Loop Guard</strong>: This prevents loops that can happen if an interface fails only in one direction, causing what is called a ‘unidirectional link’ that can’t receive data, but is still able to forward it, or the opposite.</li></ul></blockquote> <hr> <blockquote><ul><li><p>UplinkFast and BackboneFast are two optional features in classic STP. They must be configured to operate on the switch (not necessary to know for CCNA).</p></li> <li><p><strong>Both features are built into RSTP</strong>, so you do not have to configure them. They operate by default.</p></li> <li><p>You do not need to have a detailed understanding of them for the CCNA. Know their names and their basic purpose (<em>to help blocking/discarding ports rapidly move to forwarding</em>).</p></li> <li><p>If you want to learn more, do a Google search for ‘spanning tree uplinkfast’ or ‘spanning tree backbonefast’.</p></li></ul></blockquote> <h4 id="uplinkfast"><a href="#uplinkfast" class="header-anchor">#</a> UplinkFast</h4> <blockquote><p>UplinkFast 是思科产品特有的特性，两个交换机之间有多条直连物理链路, 当主链路失效时, 在备份链路的阻塞端口可以立即工作, 就不必再等待通常STP收敛所需要的50秒的时间。</p> <ul><li>only configured on <em>Access layer switches</em> or <em>switches with redundant links and at least one link in blocking state</em>;</li> <li>used to determine and quickly fix link failures on the local switch</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>S2<span class="token comment">#config t</span>
S2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree uplinkfast</span>
S1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#do show spanning-tree uplinkfast</span>
UplinkFast is enabled
Station update rate <span class="token builtin class-name">set</span> to <span class="token number">150</span> packets/sec.
UplinkFast statistics
-----------------------
Number of transitions via uplinkFast <span class="token punctuation">(</span>all VLANs<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
Number of proxy multicast addresses transmitted <span class="token punctuation">(</span>all VLANs<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">8</span>
Name Interface List
-------------------- ------------------------------------
VLAN0001 Fa0/1<span class="token punctuation">(</span>fwd<span class="token punctuation">)</span>, Fa0/2
S1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></blockquote> <h4 id="backbonefast"><a href="#backbonefast" class="header-anchor">#</a> BackboneFast</h4> <blockquote><ul><li>Another Cisco-proprietary STP extension called BackboneFast
<ul><li>used for speeding up convergence when a link <em>that’s not directly connected to the switch</em> fails. If a switch running BackboneFast receives an <strong>inferior BPDU</strong> from its designated bridge, it knows that a link on that switch to the Root Bridge has failed.</li></ul></li> <li>BackboneFast should be enabled on <strong>all Catalyst switches</strong> to allow for detection of indirect link failures.</li> <li>Enabling BackboneFast is also beneficial because it starts the spanning tree reconfiguration more quickly — it can save 20 seconds on the default 50-seconds STP convergence time.</li></ul></blockquote> <h5 id="机制"><a href="#机制" class="header-anchor">#</a> 机制:</h5> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290836597.png" alt="image-20230329083602398" style="zoom:33%;"> <blockquote><ol><li>Let’s say SW2’s root port is cut off, so it stops receiving BPDUs from the Root Bridge SW1;</li> <li>SW2 will then assume it is the root bridge, so it will send it’s own BPDUs to SW3;</li> <li>However, SW3 is now receiving BPDUs from both SW1 and SW2, but SW2’s BPDUs are <strong>inferior</strong>, they have a higher bridge ID than SW3's.
<ul><li>Without this backbonefast functionality, SW3 would just ignore these BPDUs from SW2 until its non-designated port, in classic STP, finally changes to a forwarding state and forwards the superior BPDUs to SW2, which then accepts SW1 as its root bridge again.</li></ul></li> <li>However, BackboneFast allows SW3 to expire the max age timer on that interface and rapidly forward the superior BPDUs to SW2.</li></ol></blockquote> <h5 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration:</h5> <blockquote><ul><li><p>默认情况下， BackboneFast 会将默认优先级提高到49152。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>S1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree backbonefast</span>
S2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree backbonefast</span>
Core<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree backbonefast</span>
S2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#do show spanning-tree backbonefast</span>
   BackboneFast is enabled
    BackboneFast statistics
    -----------------------
    Number of transition via backboneFast <span class="token punctuation">(</span>all VLANs<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>
    Number of inferior BPDUs received <span class="token punctuation">(</span>all VLANs<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>
    Number of RLQ request PDUs received <span class="token punctuation">(</span>all VLANs<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>
    Number of RLQ response PDUs received <span class="token punctuation">(</span>all VLANs<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
    Number of RLQ request PDUs sent <span class="token punctuation">(</span>all VLANs<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
    Number of RLQ response PDUs sent <span class="token punctuation">(</span>all VLANs<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>
S2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul> <blockquote><ul><li><p>与配置UplinkFast不同，对网络中的所有交换机都进行BackboneFast配置，而不只限于接入层交换机。</p></li> <li><p>记住，BackboneFast 用来确定neighbor switch与Root Bridge的链路失效，这与UplinkFast不同，</p></li> <li><p>UplinkFast可以确定并快速修复本地交换机的链路失效。</p></li></ul></blockquote></blockquote> <h3 id="pvst-load-balancing"><a href="#pvst-load-balancing" class="header-anchor">#</a> PVST Load-Balancing</h3> <blockquote><ul><li>If you have multiple VLANs in your network, blocking the same interface in each VLAN is a waste of interface bandwidth.</li> <li>However, if you configure a different root bridge for different VLANs, different VLANs will disable different interfaces.</li></ul></blockquote> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303250320806.png" alt="image-20230325032037567" style="zoom:33%;"> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># spanning-tree vlan 10 root primary</span>
Switch1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># spanning-tree vlan 20 root secondary</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303250321987.png" alt="image-20230325032103750" style="zoom:33%;"> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># spanning-tree vlan 20 root primary</span>
Switch2<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># spanning-tree vlan 10 root secondary</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="configure-stp-port-settings"><a href="#configure-stp-port-settings" class="header-anchor">#</a> Configure STP Port Settings</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>SW1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#spanning-tree ?</span>
  bpduguard  Don<span class="token string">'t accept BPDUs on this interface
  cost       Change an interface'</span>s spanning tree port path cost
  guard      Change an interface<span class="token string">'s spanning tree guard mode
  link-type  Specify a link type for spanning tree protocol use
  portfast   Enable an interface to move directly to forwarding on link up
  vlan       VLAN Switch Spanning Tree
  
SW1(config-if)#spanning-tree vlan 1 ?
  cost           Change an interface'</span>s spanning tree port path cost
  port-priority  Change an interface<span class="token string">'s spanning tree port priority

SW1(config-if)#spanning-tree vlan 1 cost ?
  &lt;1-200000000&gt;  Change an interface'</span>s per VLAN spanning tree path cost

SW1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#spanning-tree vlan 1 port-priority ?</span>
  <span class="token operator">&lt;</span><span class="token number">0</span>-24<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>  port priority <span class="token keyword">in</span> increments of <span class="token number">16</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><hr> <h2 id="rstp-802-1w-rapid-pvst"><a href="#rstp-802-1w-rapid-pvst" class="header-anchor">#</a> RSTP(802.1W) &amp; rapid-PVST+</h2> <blockquote><ul><li><p>RSTP (Rapid Spanning Tree Protocol) <strong>802.1w</strong></p></li> <li><p>More specifically, we’ll be looking at Cisco’s version, <strong>rapid-pvst+</strong>.</p></li> <li><p>思科创建了PortFast 、UplinkFast 和BackboneFast 来&quot;修补&quot; IEEE 802.1d 标准中的漏洞和缺陷。但这些改进特性的不足之处在于，它们都是思科专用的，还需要进行额外的配置。</p></li> <li><p>但新的802.1w 标准(RSTP) 将所有这些功能都集成了，你需要做的就只是打开RSTP. 有一点很重要，即必须确保网络中所有的交换机都能正确地运行 <em>RSTP(802.1w)</em> 协议。</p></li> <li><p>Rapid STP is compatible with Classic STP. The interface(s) on the RSTP-enabled switch connected to the Classic STP-enabled switch will operate in Classic STP mode (timers, blocking — listening = learning — forwarding process, etc).</p> <blockquote><img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290926146.png" alt="image-20230329092620975" style="zoom:43%;"> <ul><li>In the network diagram, if SW4 was running classic STP,
<ul><li>SW2 and SW3 would make these interfaces run in classic STP mode;</li> <li>but their interfaces connected to SW1 would remain in rapid STP mode.</li></ul></li></ul></blockquote></li></ul></blockquote> <blockquote><h5 id="summary-3"><a href="#summary-3" class="header-anchor">#</a> Summary:</h5> <ul><li>RSTP is <strong>not a timer-based</strong> spanning tree algorithm like 802.1D. Therefore, RSTP offers an improvement over the 30 seconds or more that 802.1D takes to move a link to forwarding.</li> <li>The heart of the protocol is a new bridge-bridge handshake mechanism, which <em>allows switches to actively negotiate with other switches</em> and move ports <strong>immediately</strong> to the forwarding state if appropriate.</li> <li>Cisco has said that RSTP isn’t a ‘revolution’ of STP, just an ‘evolution’. It made some major improvements to speed up STP, but it didn’t change it completely.
<ul><li>To accommodate for faster speeds, RSTP’s <strong>Cost</strong> values were expanded.</li> <li>RSTP simplifies the port states <strong>from 5 states to 3 states</strong>😦<strong>Discarding, Learning, Forwarding</strong>)</li> <li>Port Roles remain the <strong>almost same</strong> as STP (<strong>Root, Designated, Alternate, Backup</strong>)</li> <li>BPDUs: In RSTP, all switches originate and send their own BPDUs(with a different format with STP) from their Designated Ports.</li> <li>RSTP Link Types: <em>Edge, P2P, Shared</em></li></ul></li></ul></blockquote> <h3 id="cost-2"><a href="#cost-2" class="header-anchor">#</a> Cost:</h3> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290800579.png" alt="image-20230329080003359" style="zoom:33%;"> <h3 id="port-states-2"><a href="#port-states-2" class="header-anchor">#</a> Port states:</h3> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202306280610706.png" alt="image-20230628061031571" style="zoom:65%;"> <blockquote><ul><li>the <strong>Blocking</strong> and <strong>Disabled</strong> port states were combined into <strong>Discarding</strong> state;</li> <li>the <strong>Listening</strong> state is simply not used.</li></ul></blockquote> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290811198.png" alt="image-20230329081136856" style="zoom:28%;"> <blockquote><p>However, the Discarding state is also shown as <strong>BLK</strong> (Bloking state) in Cisco IOS:</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290921315.png" alt="image-20230329092136059" style="zoom:43%;"></blockquote> <h3 id="port-roles-2"><a href="#port-roles-2" class="header-anchor">#</a> Port Roles:</h3> <blockquote><ul><li><p>The <strong>Root Port</strong> role remains <em>unchanged</em> in RSTP.</p> <ul><li><p>The port with the lowest <strong>Root Cost</strong> to the root bridge becomes the root port for the Non-Root switch.</p></li> <li><p>The <em>Root Bridge</em> is the only switch that doesn’t have a Root Port.</p></li></ul></li> <li><p>The <strong>Designated Port</strong> role remains <em>unchanged</em> in RSTP.</p> <ul><li>The port on a segment (collision domain) that sends the best BPDU is that segment’s designated port (only one per segment);</li> <li>All the ports of the root bridge are <strong>Designated Port</strong>s.</li></ul></li> <li><p>The <strong>Non-designated port</strong> role is split into two separate roles in RSTP:</p> <ul><li><p><strong>Alternate Port</strong> role:</p> <ul><li><p>is a <strong>Discarding port</strong> that <em>receives a superior BPDU from another switch</em>;</p></li> <li><p>same as what you’ve learned about <strong>Blocking</strong> ports in classic STP.</p></li> <li><p><strong>functions as a backup to the root port.</strong> If the root port fails, the switch can immediately move its best Alternate port to forwarding.</p> <blockquote><p>This immediate move to forwarding state functions like a classic STP optional feature called <strong>UplinkFast</strong>. Because it is built into RSTP, you do not need to activate UplinkFast when using RSTP/Rapid PVST+.</p></blockquote></li></ul></li> <li><p><strong>Backup Port</strong> role</p> <ul><li><p>function as a backup for its one designated port. If SW2’s designated port fails, its backup port immediately begins forwarding traffic as a designated port.</p></li> <li><p>The interface with the <em>lowest Port ID</em> will be selected as the designated port, and the other will be the backup port.</p></li> <li><p>is a discarding port that receives a superior BPDU from another interface on the same switch. This only happens when two interfaces are connected to the same collision domain, via a hub. However, I’ve already told you that hubs are not used in modern networks, so you will probably not encounter an RSTP backup port.</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290858354.png" alt="image-20230329085846156" style="zoom:33%;"> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290903261.png" alt="image-20230329090305045" style="zoom:33%;"></li></ul></li></ul></li></ul></blockquote> <h3 id="bpdus"><a href="#bpdus" class="header-anchor">#</a> BPDUs</h3> <h4 id="major-difference"><a href="#major-difference" class="header-anchor">#</a> Major Difference</h4> <blockquote><ul><li><p>In classic STP, only the root bridge originated BPDUs, and other switches just forwarded the BPDUs they received.</p></li> <li><p><strong>In Rapid-STP, ALL switches originate and send their own BPDUs from their designated ports!</strong></p></li></ul></blockquote> <h4 id="bpdu-format"><a href="#bpdu-format" class="header-anchor">#</a> BPDU format</h4> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290929858.png" alt="image-20230329092944367" style="zoom:80%;"> <blockquote><ul><li><p>classic STP has a Protocol Version Identifier of <strong>0</strong>, whereas RSTP BPDU has a protocol version of <strong>2</strong>;</p></li> <li><p>classic STP has a BPDU type of 0, whereas the rapid STP BPDU also has a BPDU type of 2;</p></li> <li><p>The classic STP BPDU uses only 2 bits of the BPDU flags, the <em>1st bit and the 8th bit</em>;  the rapid STP BPDU uses all 8 bits. These flags are used in the negotiation process that allows rapid STP to converge much faster.</p></li> <li><p>All switches running Rapid STP send <strong>their own</strong> BPDUs every hello time (<em>2 seconds</em>).</p></li> <li><p>Switches ‘age’ the BPDU information much more quickly. In classic STP, a switch waits 10 hello intervals (20 seconds). In rapid STP, a switch considers a neighbor lost if it misses 3 BPDUs (6 seconds). It will then <code>flush(delete)</code> all MAC addresses learned <em>on that interface</em>.</p> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303290953833.png" alt="image-20230329095358592" style="zoom:33%;"> <blockquote><p>If you want to go on to get your CCNP and CCIE, you’ll definitely have to study these processes more in depth.</p></blockquote></li></ul></blockquote> <h3 id="rstp-link-types"><a href="#rstp-link-types" class="header-anchor">#</a> RSTP Link Types</h3> <p>RSTP distinguishes between 3 different ‘link types’.</p> <ul><li><p><strong>Edge</strong>: a port that is connected to an end host. Moves directly to forwarding, without negotiation.(Same as Portfast in STP)</p></li> <li><p><strong>Point-to-point</strong>: a direct connection <em>operates in Full-duplex</em> between two switches.</p> <blockquote><p>You don’t need to configure the interface as point-to-point, the switch should be able to detect that it is connected directly to another switch and will operate in full-duplex as a point-to-point port. However, if you want to explicitly configure the point-to-point link type, use this command:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>SW3<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#spanning-tree link-type ?</span>
  point-to-point  Consider the interface as point-to-point
  shared          Consider the interface as shared
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></blockquote></li> <li><p><strong>Shared</strong>: a connection to a hub. Must <em>operate in half-duplex mode</em>.</p></li></ul> <h5 id="quiz-1-2"><a href="#quiz-1-2" class="header-anchor">#</a> Quiz 1:</h5> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303291018561.png" alt="image-20230329101826252" style="zoom:33%;"> <blockquote><ul><li>Although <code>edge</code> is a link type in RSTP, you don’t use the spanning-tree link-type command to configure it, and the command doesn’t even include the word <strong>edge</strong>.</li> <li>To configure an RSTP edge port, simply configure portfast on the interface with the command <code>spanning-tree portfast</code></li></ul></blockquote> <h5 id="quiz-2-2"><a href="#quiz-2-2" class="header-anchor">#</a> Quiz 2:</h5> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303291023203.png" alt="image-20230329102311880" style="zoom:37%;"> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303291022727.png" alt="image-20230329102237449" style="zoom:33%;"> <h3 id="configuration-2"><a href="#configuration-2" class="header-anchor">#</a> Configuration</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Core<span class="token comment">#config t</span>
Core<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree mode ?</span>
    mst 	Multiple spanning tree mode
    pvst 	Per-Vlan spanning tree mode
    rapid-pvst 	Per-Vlan rapid spanning tree mode
Core<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#spanning-tree mode rapid-pvst</span>
Core<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#</span>
    1d02h: %LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan1,
    changed state to down
    1d02h: %LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan1,
    changed state to up

Core<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#do show spanning-tree</span>
VLAN0001
 Spanning tree enabled protocol rstp  <span class="token comment"># rapid-pvst+</span>
 Root ID Priority <span class="token number">32769</span>
        Address 000d.29bd.4b80
        This bridge is the root
        Hello Time <span class="token number">2</span> sec Max Age <span class="token number">20</span> sec Forward Delay <span class="token number">15</span> sec
    Bridge ID Priority <span class="token number">32769</span> <span class="token punctuation">(</span>priority <span class="token number">32768</span> sys-id-ext <span class="token number">1</span><span class="token punctuation">)</span>
        Address 000d.29bd.4b80
        Hello Time <span class="token number">2</span> sec Max Age <span class="token number">20</span> sec Forward Delay <span class="token number">15</span> sec
        Aging Time <span class="token number">300</span>

    Interface  Role Sts  Cost Prio.Nbr  Type
    ---------------- ---- --- --------- -------- ------------
    Fa0/5   Desg FWD  <span class="token number">19</span>  <span class="token number">128.5</span>   P2p Peer<span class="token punctuation">(</span>STP<span class="token punctuation">)</span>
    Fa0/6   Desg FWD  <span class="token number">19</span>  <span class="token number">128.6</span>   P2p Peer<span class="token punctuation">(</span>STP<span class="token punctuation">)</span>
    Fa0/7   Desg FWD  <span class="token number">19</span>  <span class="token number">128.7</span>   P2p Peer<span class="token punctuation">(</span>STP<span class="token punctuation">)</span>
    Fa0/8   Desg FWD  <span class="token number">19</span>  <span class="token number">128.8</span>   P2p Peer<span class="token punctuation">(</span>STP<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="验证思科交换机的配置"><a href="#验证思科交换机的配置" class="header-anchor">#</a> 验证思科交换机的配置</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>show running-config   <span class="token comment"># 路由器或者交换机上都可以使用, 可以了解整个设备的运行配置</span>
show mac address-table  <span class="token comment"># 显示转发过滤表</span>
show spanning-tree  <span class="token comment"># 可以了解到根桥的MAC地址，以及每个VLAN所设置的优先级。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch<span class="token comment">#show spanning-tree ?    </span>
  WORD               bridge group list, example <span class="token number">1,3</span>-5,7,9
  active             Report on active interfaces only
  backbonefast       Show spanning tree backbonefast status
  blockedports       Show blocked ports
  bridge             Status and configuration of this bridge
  detail             Detailed information
  inconsistentports  Show inconsistent ports
  interface          Spanning Tree interface status and configuration
  mst                Multiple spanning trees
  pathcost           Show Spanning pathcost options
  root               Status and configuration of the root bridge
  summary            Summary of port states
  uplinkfast         Show spanning tree uplinkfast status
  vlan               VLAN Switch Spanning Trees
  <span class="token operator">|</span>                  Output modifiers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Switch<span class="token comment">#show spanning-tree summary </span>
    Switch is <span class="token keyword">in</span> rapid-pvst mode
    Root bridge for: VLAN0001-VLAN0005
    Extended system ID                      is enabled
    Portfast Default                        is disabled
    Portfast Edge BPDU Guard Default        is disabled
    Portfast Edge BPDU Filter Default       is disabled
    Loopguard Default                       is disabled
    PVST Simulation Default                 is enabled but inactive <span class="token keyword">in</span> rapid-pvst mode
    Bridge Assurance                        is enabled
    EtherChannel misconfig guard            is enabled
    Configured Pathcost method used is short
    UplinkFast                              is disabled
    BackboneFast                            is disabled

    Name                   Blocking Listening Learning Forwarding STP Active
    ---------------------- -------- --------- -------- ---------- ----------
    VLAN0001                     <span class="token number">0</span>         <span class="token number">0</span>        <span class="token number">0</span>          <span class="token number">4</span>          <span class="token number">4</span>
    VLAN0002                     <span class="token number">0</span>         <span class="token number">0</span>        <span class="token number">0</span>          <span class="token number">2</span>          <span class="token number">2</span>
    VLAN0003                     <span class="token number">0</span>         <span class="token number">0</span>        <span class="token number">0</span>          <span class="token number">2</span>          <span class="token number">2</span>
    VLAN0004                     <span class="token number">0</span>         <span class="token number">0</span>        <span class="token number">0</span>          <span class="token number">2</span>          <span class="token number">2</span>
    VLAN0005                     <span class="token number">0</span>         <span class="token number">0</span>        <span class="token number">0</span>          <span class="token number">2</span>          <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 设置静态的MAC地址条目</span>
S1<span class="token comment">#config t</span>
S1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#mac-address-table static aaaa.bbbb.cccc vlan 1 int fa0/5</span>
S1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#do show mac address-table</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>如果需要在局域网外部对交换机进行管理, 则应该在交换机上设置网关, 就像在主机上完成的默认网关设置一样:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#ip default-gateway 192.168.10.254</span>
Switch<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int vlan 1</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip address 192.168.10.252 255.255.255.0</span>
Switch<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#no shut</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></blockquote> <hr></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Jonas-Wolfxin/Jonas-Wolfxin.github.io/edit/main/docs/40.网络运维/05.CCNA/10.CCNA知识笔记/11.Switching_STP.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">last Updated:</span> <span class="time">2023/04/06, 17:55:06</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/fabc03/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Switching_VLAN</div></a> <a href="/pages/85147b/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Switching_EtherChannel</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/fabc03/" class="prev">Switching_VLAN</a></span> <span class="next"><a href="/pages/85147b/">Switching_EtherChannel</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/32db2d/"><div>
            Layer 3 Forwarding
            <!----></div></a> <span class="date">06-07</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/6b8f16/"><div>
            Layer 2 Forwarding
            <!----></div></a> <span class="date">06-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/fe5ceb/"><div>
            Virtual Routing and Forwarding
            <!----></div></a> <span class="date">05-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/Jonas-Wolfxin" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/Jonas-Wolfxin" title="Gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202206100005451.jpg" title="Wechat: @Jonas_Wolfxin" target="_blank" class="iconfont icon-weixin"></a><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1914303043&amp;site=qq&amp;menu=yes" title="QQ: 1914303043" target="_blank" class="iconfont icon-QQ"></a><a href="mailto:wolfxin@outlook.com" title="联系我" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>Jonas Wolfxin's Blog</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div></div><div></div><div></div><!----><!----><APlayer audio="" fixed="true" mini="true" theme="#b7daff" loop="loop" order="list" preload="auto" volume="0.7" mutex="true" lrc-type="0" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><div></div></div></div>
    <script src="/assets/js/app.d858ddbb.js" defer></script><script src="/assets/js/2.309e711a.js" defer></script><script src="/assets/js/134.3f032f05.js" defer></script><script src="/assets/js/16.acd3428d.js" defer></script><script src="/assets/js/8.5b4b6c67.js" defer></script><script src="/assets/js/10.58f97cc7.js" defer></script><script src="/assets/js/17.0b7a5267.js" defer></script>
  </body>
</html>
