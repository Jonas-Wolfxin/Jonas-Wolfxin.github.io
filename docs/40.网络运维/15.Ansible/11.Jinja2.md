---
title: Jinja2
date: 2023-03-28 03:27:23
permalink: /pages/bc0fd9/
categories:
  - 网络运维
  - Ansible
tags:
  - 
---



## Jinja2

### Jinja2 的语法格式

1. 输出变量：`{{ 变量 }},` 使用两个花括号包含变量名称，可以将变量的值插入到生成的文本中。例如，如果变量 `name` 的值为 `"Alice"`，则 `{{ name }}` 将显示为 `"Alice"`。

2. 控制结构：`{% 控制结构 %}`, 使用 `{%` 和 `%}` 标记，可以在模板中插入控制结构，例如条件语句、循环语句和错误处理。以下是一些常见的控制结构：

     - `if` 语句：

         ```jinja2
         {% if 条件 %}
           条件为真时的代码
         {% endif %}
         ```

     - `for` 循环：

         ```jinja2
         {% for 变量 in 列表 %}
           列表中的每个元素都会被遍历一次
         {% endfor %}
         ```

     - `block` 块：

         ```jinja2
         {% block 名称 %}
           块内容
         {% endblock %}
         ```

3. 注释：

```jinja2
{# 注释 #}
```

使用 `{#` 和 `#}` 标记，可以在模板中添加注释。这些注释不会显示在生成的文本中。

4. 过滤器：

```jinja2
{{ 变量|过滤器 }}
```

使用 `|` 管道符号可以将一个变量传递给一个过滤器函数，并修改它的值。例如，`{{ "hello"|upper }}` 将输出 `"HELLO"`。

这些是 Jinja2 中一些常见的语法格式，它们可以组合使用，以便在生成的文本中动态显示数据。

### 常见的数据类型

在 Jinja2 中，支持以下常见的数据类型：

1. 字符串（string）：由一系列字符组成，可以用单引号或双引号括起来。
2. 整数（integer）：表示整数值，例如 `42`。
3. 浮点数（float）：表示浮点数值，例如 `3.14`。
4. 列表（list）：由多个值组成的有序序列，可以通过索引访问列表中的元素。
5. 字典（dictionary）：由多个键值对组成的无序集合，可以通过键名访问字典中的值。
6. 元组（tuple）：类似于列表，但是一旦创建就不能修改，通常用于表示一组相关的值。
7. 布尔值（boolean）：表示真或假，只有两个可能的取值：`True` 或 `False`。

在 Jinja2 中，还支持一些其他类型的数据，例如 `None` 类型，表示空值或缺失的值。此外，Jinja2 还支持自定义的数据类型，可以通过编写自定义的 Python 类来创建。

### 常见的运算类型

> 在 Jinja2 中，可以使用以下运算符进行常见的运算：
>
>   1. 数值运算符：`+`（加）、`-`（减）、`*`（乘）、`/`（除）、`%`（求余）等。
>   2. 比较运算符：`==`（等于）、`!=`（不等于）、`>`（大于）、`<`（小于）、`>=`（大于等于）、`<=`（小于等于）等。
>   3. 逻辑运算符：`and`（逻辑与）、`or`（逻辑或）、`not`（逻辑非）等。
>   4. 字符串运算符：`~`（字符串连接）、`in`（判断是否在另一个字符串中）、`not in`（判断是否不在另一个字符串中）等。
>   5. 三目运算符：`条件为真时的值 if 条件 else 条件为假时的值`。
>   6. 过滤器：通过 `|` 管道符号将一个值传递给一个过滤器函数，并修改它的值。例如，`{{ "hello"|upper }}` 将输出 `"HELLO"`。
>
> 在 Jinja2 中，还支持使用括号来控制运算优先级，以及使用变量、函数和过滤器等高级用法进行运算。

## roles

> roles
> ansible自1.2版本引入的新特性，用于层次性、结构化地组织playbook。
> roles能够根据层次型结构自动装载变量文件、tasks以及handlers等。
> 要使用roles只需要在playbook中使用include指令即可。
> 简单来讲，roles就是通过分别将变量、文件、任务、模板及处理器放置于单独的目录中，
> 并可以便捷地include它们的一种机制。
> 角色一般用于基于主机构建服务的场景中，但也可以是用于构建守护进程等场景中
>
> 复杂场景：建议使用roles，代码复用度高
> 变更指定主机或主机组
> 如命名不规范维护和传承成本大
> 某些功能需多个Playbook，通过includes即可实现
