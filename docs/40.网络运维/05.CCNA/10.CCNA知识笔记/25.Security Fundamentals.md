---
title: Security
date: 2023-05-05 00:18:52
permalink: /pages/81e45f/
categories:
  - 网络运维
  - CCNA
  - CCNA知识笔记
tags:
  - 
---

## Security Fundamentals

>   The CCNA is not a cybersecurity certification, but it requires candidates to learn some fundamentals of network and system security necessary to work as an IT professional.

### Key Security Concepts and Terms

#### What is the purpose/goal of security in an enterprise?

The principles of the **CIA Triad** form the foundation of security:

-   **Confidentiality** 

    + Only authorized users should be able to access data. 

    + Some information/data is public and can be accessed by anyone, some is secret and should only be accessed by specific people.

* **Integrity** 

    + Data should not be tampered with (modified) by unauthorized users. 

    + Data should be correct and authentic.

* **Availability** 

    + The network/systems should be operational and accessible to authorized users. For example, staff should be able to access the internal resources they need to perform their duties, and the company’s website should be up and running and available to customers.

Attackers can threaten the confidentiality, integrity, and availability of an enterprises’ systems and information.



#### some other fundamental security concepts

>   -   A **vulnerability** is any potential weakness that can compromise the CIA of a system/info. 
>       + A potential weakness isn’t a problem on its own. 
>   -   An **exploit** is something that can potentially be used to exploit the vulnerability. 
>       + Something that can potentially be used as an exploit isn’t a problem on it’s own. 
>
>   -   A **threat** is the potential of a vulnerability to be exploited, which refers to the real possibility that a potential weakness is taken advantage of to attack a system. 
>
>
>   A hacker **exploiting** a **vulnerability** in your system is a **threat**.

-   A **mitigation technique** is something that can protect against threats.
    -   Should be implemented everywhere a vulnerability can be exploited: client devices, servers, switches, routers, firewalls, etc.
    -   In addition, mitigation techniques include things like preventing unauthorized people from getting physical access to the devices by keeping them in a secure rack behind a secure door, etc.

>   But always remember, **no system is perfectly secure**.



#### Digital certiticates

>   -   **Digital certificates** are another form of authentication used to prove the identity of the holder of the certificate.
>   -   They are mainly(but not exclusively) used for websites to verify that the website being accessed is legitimate.
>   -   Entities that want a certificate(for example a company with a website) send a CSR(Certificate Signing Request) to a CA(Certificate Authority), which will generate and sign the certificate.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305051245626.png" alt="image-20230505124544404" style="zoom:39%;" />



### Common Attacks

These are threats which can potentially exploit vulnerabilities to compromise the confidentiality, integrity, or availability(CIA) of an enterprise’s systems and information.

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305051222024.png" alt="image-20230505122236757" style="zoom:33%;" />

#### DoS (denial-of-service) attacks

>   -   DoS attacks targets the availability of a system so users can’t access it, which threatens *the availability of a system*. 
>
>   -   One common DoS attack is the **TCP SYN flood**. 
>       1.   TCP three-way handshake: SYN | SYN-ACK | ACK 
>       2.   The attacker sends **countless TCP SYN** messages to the target. 
>       3.   The target sends a SYN-ACK message in response to each SYN it receives. 
>       4.   The attacker never replies with the final ACK of the TCP three-way handshake. 
>       5.   The incomplete connections fill up the target’s TCP connection table. 
>       6.   The attacker continues sending SYN messages. 
>       7.   The target is no longer able to make legitimate TCP connections because it has reached the maximum number of TCP connections it can maintain.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305050042826.png" alt="image-20230505004229726" style="zoom:33%;" />
>
>   >   ###### By the way, why do you think I drew the SYN-ACK arrows not reaching the attacker?
>   >
>   >   It’s because the attacker likely **spoofs their IP address**, meaning they use a fake IP address, so the SYN-ACK messages don’t return back to them.

##### DDoS

>   However, a denial-of-service like that is usually not done by a single attacker. A much more powerful kind of attack is the **DDoS**.
>
>   -   In a **DDOS (Distributed Denial-Of-Service)** attack, the attacker infects many target computers with malware and uses them all to initiate a denial-of-service attack, for example a TCP SYN flood attack.
>   -   This group of infected computers is called a **botnet**.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305050047814.png" alt="image-20230505004734670" style="zoom:33%;" />

#### Spoofing attacks

>   -   To spoof an address is to use a fake source address (IP or MAC address). 
>   -   Numerous attacks involve spoofing, it’s not a single kind of attack. An example is a **DHCP exhaustion attack**, aka. **DHCP starvation attack**.
>       -   An attacker *uses spoofed MAC addresses to flood DHCP Discover messages*.
>       -   Then, the target server’s DHCP pool becomes full, resulting in a denial-of-service to other devices. They won’t be able to get an IP address.
>   
><img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305050052414.png" alt="image-20230505005230271" style="zoom:33%;" />
>   
>>   -   In the previous TCP SYN flood example, source IP addresses were spoofed too, so actually it’s also a spoofing attack.
>   >   -   And this DHCP exhaustion attack resulted in a denial-of-service, so it’s a DoS attack too.
>   >   -   As you can see, some of these attack types are connected and related, they aren’t totally separate.
>   >   -   Note that spoofing attacks don’t have to be denial-of-service attacks.

#### Reflection/amplification attacks

>   -   **involve spoofing a source IP address to cause a reflector to send lots of traffic to the target.** 
>       -   In a reflection attack, the attacker sends traffic to a **reflector**, and spoofs the source address of its packets using the **target’s IP address**.
>
>   -   The reflector (ie. a DNS server) sends the reply to the target’s IP address.
>   -   If the amount of traffic sent to the target is large enougn, this can result in a denial-of-service.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305050329625.png" alt="image-20230505032939517" style="zoom:33%;" />
>
>   -   A reflection attack becomes an **amplification attack** when the amount of traffic sent by the attacker is small, but it triggers a large amount of traffic to be sent from the reflector to the target.
>       -   For example, there are DNS and NTP vulnerabilities which can be exploited for amplification attacks
>       -   Do a google search for ‘DNS amplification attack’ or ‘NTP amplification attack’, you will find articles like these:
>           -   <https://www.cloudflare.com/learning/ddos/dns-amplification-ddos-attack/>
>           -   <https://www.cloudflare.com/learning/ddos/ntp-amplification-ddos-attack/>

#### Man-in-the-middle attacks

>   In a man-in-the-middle attack, the attacker places himself between the source and destination to **eavesdrop(窃听)** on communications, or to modify traffic before it reaches the destination.
>
>   -   A common example is **ARP spoofing**, also known as **ARP poisoning**. (So, this is yet another kind of spoofing attack.)
>    1.   A host sends an ARP request, asking for the MAC address of another device. 
>       2.   The target of the request sends an ARP reply, informing the requester of its MAC address.
>       3.   The attacker waits and sends another ARP reply after the legitimate replier. 
>       4.   If the attacker’s ARP reply arrives last, it will **overwrite** the legitimate ARP entry in PC1’s ARP table.
>       5.   In PC1’s ARP table, the entry for 10.0.0.1 will have the attacker’s MAC address.
>       6.   When PC1 tries to send traffic to SRV1, it will be forwarded to the attacker instead. 
>       7.   The attacker can inspect the messages, and then forward them on to SRV1. Or, another possibility is that the attacker can also modify the messages before forwarding them to SRV1.
>   
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305050336532.png" alt="image-20230505033631416" style="zoom:33%;" />
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305050340543.png" alt="image-20230505034026421" style="zoom:32%;" />
>
>   >   So, in this example the threat isn’t to the availability of the CIA triad, this kind of attack compromises the **confidentiality** and **integrity**(the C and I of the CIA triad) of the communications between PC1 and SRV1.

#### Reconnaissance attacks(侦察攻击)

>   -   Reconnaissance attacks aren’t attacks themselves, but they are used to gather information about a target which can be used for a future attack.
>   -   This is often publicly available information, which is why it’s not really an attack itself, the information isn’t actually confidential.
>   -   For example, you can perform an `nslookup` to learn the IP address of a site. From there, you can probe for open ports which are potential vulnerabilities.
>   -   You could also perform a **WHOIS query** to learn email addresses, phone numbers, physical addresses: <https://lookup.icann.org/en/lookup>



#### Malware

>   -   Malware (malicious software) refers to a variety of harmful programs that can infect a computer.
>   -   Note that these types of malware are defined mostly by how the malware infects a system and how it spreads, not the attacks they carry out after infecting the system.
>       -   **Viruses** infect other software (a ‘host program’). The virus spreads as the software is shared by users. Typically they corrupt or modify files on the target computer.
>       -   **Worms** do not require a host program. They are standalone malware and they are able to spread on their own, without user interaction. The spread of worms from device to device can congest the network, but the ‘payload’ of a worm(other malicious code within the worm) can cause additional harm to target devices.
>       -   **Trojan Horses** are harmful software that is disguised as legitimate software. They are spread through user interaction such as opening email attachments, or downloading a file from the Internet.
>   -   The above malware types can exploit various vulnerabilities to threaten any of the **CIA triad** of the target device.
>   -   There are many types of malware, these three are just a few large categories of malware.

#### Social engineering attacks

>   -   Social engineering attacks target the most vulnerable part of any system — people!
>
>   -   They involve psychological manipulation to make the target reveal confidential information or perform some action.
>
>   -   Here are a few common ones:
>
>       -   **Phishing** typically involves fraudulent(欺诈性的) emails that appear to come from a legitimate business (Amazon, bank, credit card company, etc) and contain links to a fraudulent website that seems legitimate. Users are told to login to the fraudulent website, providing their login credentials to the attacker.
>           -   **Spear phishing** is a type of phishing that is more targeted. Not mass emails sent out to anybody, but perhaps emails sent to employees of a specific company.
>           -   **whaling** is phishing targeted at high-profile individuals, ie. a company president.
>
>       -   **Vishing(voice phishing)** is phishing performed over the phone.
>           -   Hi, this is Jeremy from the IT department. Due to company policy we need to reset your password, could you tell me the password you’re currently using and I'll reset it for you?’
>       -   **Smishing (SMS phishing)** is phishing using SMS text messages.
>       -   **Watering hole attacks** compromise sites that the target victim frequently visits. If a malicious link is placed on a website the target trusts, they might not hesitate to click it.
>       -   **Tailgating attacks** involve entering restricted, secured areas by simply walking in behind an authorized person as they enter. Often, the target will hold the door open for the attacker to be polite, assuming the attacker is also authorized to enter.

#### Password-related attacks

>   -   Most systems use a username/password combination to authenticate users. 
>
>   -   The username is often simple/easy to guess (for example the user’s email address), and the strength and secrecy of the password is relied on to provide the necessary security. 
>
>   -   Attackers can learn a user’s passwords via multiple methods: 
>
>       + Guessing 
>       + **Dictionary attack**: A program runs through a ‘dictionary’ or list of common words/passwords to find the target’s password. 
>
>       + **Brute force attack**: A program tries every possible combination of letters, numbers, and special characters to find the target’s password. 
>
>   -   **Strong passwords should contain**: 
>
>       -   at LEAST 8 characters (preferably more). 
>       -   a mixture of UPPERCASE and lowercase letters.
>       -   a mixture of letters and numbers. 
>       -   one or more special characters (# @ ! ? etc.) 
>       -   should be changed regularly



### Passwords/Multi-Factor Authentication (MFA)

>   -   No matter how secure the password, there is still a chance it gets into the hands of an attacker. That’s why multi-factor authentication is becoming more and more wide-spread.
>   -   Multi-factor authentication involves providing *more than just a username/password* to prove your identity. 
>   -   It usually involves providing two of the following (=two-factor authentication):
>       -   **Something you know** 
>           + ausername/password combination, a PIN, etc. 
>
>       -   **Something you have** 
>           -   pressing a notification that appears on your phone, a badge that is scanned, etc.
>       -   **Something you are** 
>           + biometrics such as a face scan, palm scan, fingerprint scan, retina scan, etc.
>   -   Requiring multiple factors of authentication greatly increases the security. Even if an attacker learns the target’s password, they won’t be able to login to the target’s account.



### Authentication, Authorization, Accounting (AAA)

>   -   **AAA** (triple-A) stands for **Authentication**, **Authorization**, and **Accounting**.
>   -   It’s a framework for controlling and monitoring users of a computer system(ie. network).
>   -   **Authentication** is the process of verifying a user’s identity.
>       -   logging in = authentication
>   -   **Authorization** is the process of granting the user the appropriate access and permissions. 
>       + granting the user access to some files/services, restricting access to other files/services = authorization
>   -   **Accounting** is the process of recording the user’s activities on the system. 
>       -   logging when a user makes a change to a file = accounting
>   -   Enterprises typically use a **AAA server** to provide AAA services.
>       -   **ISE(Identity Services Engine)** is Cisco’s AAA server, for example.
>   -   AAA servers usually support the following two AAA protocols: 
>       + **RADIUS**: an open standard protocol. Uses *UDP ports 1812 and 1813*. 
>       + **TACACS+**: A Cisco propriety protocol. Uses *TCP port 49*.

#### TACACS+ Vs RADIUS

>   To provide a **centralized management system for the authentication, authorization, and accounting (AAA framework)**, Access Control Server (ACS) is used. For the communication between the client and the ACS server, two protocols are used namely **TACACS+** and RADIUS. 
>
>   ##### [TACACS+](https://www.geeksforgeeks.org/computer-network-tacacs/)
>
>   **Terminal Access Controller Access Control System (TACACS+)** is a Cisco proprietary protocol that is used for the communication of the Cisco client and Cisco ACS server. It uses TCP port number 49 which makes it reliable. 
>
>   ##### [RADIUS](https://www.geeksforgeeks.org/computer-network-radius/)
>
>   **Remote Access Dial-In User Service (RADIUS)** is an open standard protocol used for the communication between any vendor AAA client and ACS server. If one of the clients or servers is from any other vendor (other than Cisco) then we have to use RADIUS. It uses port number 1812 for authentication and authorization and 1813 for accounting.
>
>   ###### Similarities
>
>   The process is started by Network Access Device (NAD – client of TACACS+ or RADIUS). NAD contact the TACACS+ or RADIUS server and transmit the request for authentication (username and password) to the server. First, NAD obtains the username prompt and transmits the username to the server, and then again the server is contacted by NAD to obtain the password prompt and then the password is sent to the server. 
>
>   The server replies with an access-accept message if the credentials are valid otherwise send an access-reject message to the client. Further authorization and accounting are different in both protocols as authentication and authorization are combined in RADIUS. 
>
>   ###### Differences
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305051253102.png" alt="image-20220711140954901" style="zoom: 73%;" />
>
>   ###### Advantages (TACACS+ over RADIUS)
>
>
>   1.  As TACACS+ uses TCP therefore more reliable than RADIUS. 
>
>   2.  TACACS+ provides more control over the authorization of commands while in RADIUS, no external authorization of commands is supported. 
>
>   3.  All the AAA packets are encrypted in TACACS+ while only the passwords are encrypted in RADIUS i.e more secure. 
>
>   ###### Advantage (RADIUS over TACACS+)
>
>
>   1.  As it is an open standard therefore RADIUS can be used with other vendor’s devices while because TACACS+ is Cisco proprietary, it can be used with Cisco devices only. 
>
>   2.  It has more extensive accounting support than TACACS+. 



### Security Program Elements

>   -   A security program is an enterprise’s set of security policies and procedures.
>   -   **User awareness programs** are designed to make employees aware of potential security threats and risks.
>       -   For example, a company might send out false phishing emails to make employees click a link and sign in with their login credentials. 
>       -   Although the emails are harmless, employees who are tricked by the false emails will be informed that it is part of a user awareness program, and they should be more careful about phishing emails.
>   -   **User training programs** are more formal than user awareness programs
>       -   For example, dedicated(专门的) training sessions which educate users on the corporate security policies, how to create strong passwords, and how to avoid potential threats.
>   -   **Physical access control** protects equipment and data from potential attackers by only allowing authorized users into protected areas such as network closets or data center floors.
>       -   Even within the company, access to these areas should be limited to those who need access.
>       -   Multifactor locks can protect access to these restricted areas(ie. a door that requires users to swipe a badge and scan their fingerprint to enter. That’s **something you have**, a badge, and **something you are**, your fingerprint.)
>       -   

### Kali linux

>   -   Kali Linux is popular in the world of cyber security, penetration testing, and such. It comes with various pre-installed tools for digital forensics(数字取证) and penetration testing. And we will be using one called **Yersinia** for the **DHCP exhaustion attack**. 

<iframe width="940" height="515" src="https://www.youtube.com/embed/EBs47-0ZD-A" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>



## Port Security

### Intro to port security

>   Port security is a security feature of Cisco switches, which is s configured on a per-interface basis and then allows to control which source MAC address(es) are allowed to enter the switchport.

>   If an unauthorized source MAC address enters the port, an action will be taken. For example:
>
>   -   The default action is to place the interface in an ‘**err-disabled**’ state. 
>       -   (In effect, this is like *shutting down the interface*. Traffic will no longer be sent or received by that interface.)
>       -   What happens when PC1 is re-connected to the G0/1 port? The interface is still err-disabled. There are two ways to enable an interface that has been disabled by port security, which will be talked later.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305051415562.png" alt="image-20230505141508415" style="zoom:33%;" />

>   -   When you enable **port security** on an interface with the default settings(`switchport port-security`),  **ONLY one dynamically-learned MAC address** is allowed. 
>
>       - You can configure the allowed MAC address manually. 
>
>
>       - If you don’t configure it manually, the switch will allow the first source MAC address that enters the interface. 
>
>
>   -   You can change the maximum number of MAC addresses allowed.
>       -   the allowed MAC addresses can be **manually configured** or **dynamically learned**. *A combination of manually configured MAC addresses and dynamically learned addresses is also possible*.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305051438930.png" alt="image-20230505143851789" style="zoom:33%;" />

### Why use port security?

>   -   Port security allows network admins to control which devices are allowed to access the network. 
>   -   However, MAC address spoofing is a simple task. 
>       + It’s easy to configure a device to send frames with a different source MAC address. 
>
>   -   Rather than manually specifying the MAC addresses allowed on each port, port security’s ability to limit the number of MAC addresses allowed on an interface is more useful. 
>   -   Think of the DHCP starvation attack carried out in the Day-48 Lab video. 
>       + the attacker spoofed thousands of fake MAC addresses 
>
>       + the DHCP server assigned IP addresses to these fake MAC addresses, exhausting the DHCP pool 
>
>       + the switch’s MAC address table can also become full due to such an attack 
>
>
>   -   Limiting the number of MAC addresses on an interface can protect against those attacks.



### Port security configuration

#### Basic Configuration

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305052353998.png" alt="image-20230505235331665" style="zoom:35%;" />

##### Check the port security of interface

When you use just this command, port security is enabled with the default settings. Let’s check out those default settings.

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305052355621.png" alt="image-20230505235559455" style="zoom:36%;" />

>   -   First, **port security** is enabled, 
>   -   the **port status** is secure-up. Secure-up just means port security is enabled, and the interface is up. 
>   -   The default violation mode is shutdown, as I said before. If an unauthorized frame enters the interface, it will be err-disabled. 
>   -   Here are some default settings regarding the timers: 
>       -   The aging time of 0 minutes means that the addresses will never age out, there is no timer. 
>   -   Here we can see information about the MAC addresses. 
>       -   The maximum is 1, 
>       -   currently it knows 0, 
>       -   0 have been manually configured, 
>       -   and there are 0 sticky MAC addresses. 
>   -   SW1 hasn’t received any traffic on this interface yet, so the last source address is all 0s, with VLAN number 0. 
>   -   Finally, there have been no violations so this counter here is at 0.

##### Connect a PC to the switchport

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060002325.png" alt="image-20230506000205107" style="zoom:35%;" />

##### Connect another PC to the switchport

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060002343.png" alt="image-20230506000236072" style="zoom:33%;" />

#### Re-enabling an err-disabled interface

Disconnect the unauthorized device, and then either *manually re-enable the interface*, or let *errdisable recovery* do it for you automatically.

##### Method 1:

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060005452.png" alt="image-20230506000539256" style="zoom:35%;" />

##### Method 2:

>   -   There’s another way to re-enable an err-disabled interface, that is **ErrDisable recovery**. 
>   -   It causes err-disabled interfaces to be automatically re-enabled after a certain period of time. 
>   -   There are actually various reasons an interface can enter an err-disabled state. Using the command `show errdisable recovery` lists all of them:
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060014745.png" alt="image-20230506001440455" style="zoom:36%;" />
>
>   -   On the left is each err-disable reason, and on the right it will show whether or not err-disable recovery is enabled. By default, it is disabled for all reasons, so err-disabled interfaces will not be automatically recovered. The one we’re looking for is **psecure-violation**, that means port-security violation. Notice the default timer is 300 seconds. So, every 5 minutes by default, all err-disabled interfaces will re-enabled, but only if err-disable recovery has been enabled for the cause of the interface’s disablement.
>
>   ##### Enable ErrDisable recovery with a cause
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060017685.png" alt="image-20230506001736433" style="zoom:33%;" />

>   ##### What will happen if you don’t disconnect the unauthorized device? 
>
>   -   If you manually configured the secure MAC address, the interface will simply become disabled again when it receives another frame from the unauthorized device. 
>
>   -   But if you let the switch dynamically learn the previous secure MAC address, it is cleared when the interface is disabled. When the interface is re-enabled, the unauthorized device’s MAC address might become the new secure MAC address on the interface, which is obviously not a good situation. 
>   -   So, remember to disconnect the unauthorized device.



#### Three violation modes

>   There are three different violation modes that determine what the switch will do if an unauthorized frame enters an interface configured with port security.
>
>   ```sh
>   SW1(config)#int f0/1
>   SW1(config-if)#switchport ?
>     access         Set access mode characteristics of the interface
>     mode           Set trunking mode of the interface
>     nonegotiate    Device will not engage in negotiation protocol on this
>                    interface
>     port-security  Security related command
>     priority       Set appliance 802.1p priority
>     protected      Configure an interface to be a protected port
>     trunk          Set trunking characteristics of the interface
>     voice          Voice appliance attributes
>   SW1(config-if)#switchport port-security ?
>     aging        Port-security aging commands
>     mac-address  Secure mac address
>     maximum      Max secure addresses
>     violation    Security violation mode
>     <cr>
>   SW1(config-if)#switchport port-security violation ?
>     protect   Security violation protect mode
>     restrict  Security violation restrict mode
>     shutdown  Security violation shutdown mode
>   ```
>
>   
>
>   -   **Shutdown** (default mode, just showed above)
>
>       -   Effectively shuts down the port by placing it in an **err-disabled state**. 
>       -   Generates (Only) one **Syslog and/or SNMP message** when the interface is disabled. 
>           -   However, after the interface is down it won’t continue generating messages even if the unauthorized device continues trying to send traffic.
>       -   The violation counter is set to 1 when the interface is disabled. 
>
>   -   **Restrict** mode
>
>       -   The switch **discards** traffic from unauthorized MAC addresses. 
>       -   The interface is *NOT disabled*. 
>
>       + Generates a Syslog and/or SNMP message *each time an unauthorized MAC is detected*.
>       + The violation counter is incremented by 1 for each unauthorized frame.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060042113.png" alt="image-20230506004252825" style="zoom:38%;" />
>
>   -   **Protect** mode
>       -   The switch **discards** traffic from unauthorized MAC addresses. 
>       -   The interface is *NOT disabled*. 
>       -   It does **NOT generate** Syslog/SNMP messages for unauthorized traffic. 
>       -   It does **NOT increment** the violation counter.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060043011.png" alt="image-20230506004341774" style="zoom:39%;" />

#### Secure MAC address aging

>   -   MAC addresses dynamically learned or statically configured on a port-security enabled port are called **secure MAC addresses**.
>   -   **By default, secure MAC addresses will not age out.** There is no timer, they are permanent unless you manually delete the learned MAC address or the port is disabled and then re-enabled. That’s what the **aging time of 0 minutes** means.
>       -   However, this timer can be configured with the command `switchport port-security aging timeMinutes`;
>   -   If you do configure an aging time, the default aging type is **absolute**.
>       -   **Absolute aging** means that, after the secure MAC address is learned, the aging timer starts and the MAC address is removed after the timer expires, even if the switch continues receiving frames from that source MAC address. However, after the MAC address ages out, it can then immediately be re-learned if another frame with that source MAC is received.
>       -   The other aging type is **inactivity**. After the MAC address is learned the aging timer starts, but it is reset every time a frame from that source MAC address is received. So, if the switch keeps receiving frames from that MAC address, it will never be aged out.
>       -   Aging type is configured with `switchport port-security aging type {absolute | inactivity}`
>   -   **By default, only dynamically-learned secure MAC addresses will age out.** 
>       -   If you configure a static Secure MAC with `switchport port-security mac-address MAC_Address`, it won’t age out. The command will remain in the running-config and the MAC will remain in the MAC address table. 
>       -   But with the command `switchport port-security aging static`, you can make the switch age out static secure MAC addresses. The command will be removed from the running-config and the address will be removed from the MAC address table if it ages out.

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060118791.png" alt="image-20230506011812592" style="zoom:39%;" />

##### `show port-security`

It displays which interfaces have port security enabled, the max and current number of secure addresses on those interfaces, their security violation count, and their security action.

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060119856.png" alt="image-20230506011942685" style="zoom:38%;" />

#### Sticky secure MAC address

>   -   Sticky MAC addresses are basically a way of configuring static secure MAC addresses, without actually having to manually configure them
>   -   ‘Sticky’ secure MAC address learning can be enabled with the following command: 
>
>   ```sh
>   SW1(config-if)# switchport port-security mac-address sticky
>   ```
>
>   -   When enabled, dynamically-learned secure MAC addresses will be added to the running-config like this: `switchport port-security mac-address sticky mac-address`; 
>   -   The ‘sticky’ secure MAC addresses will never age out, even if you enable static secure MAC address aging.
>       -   You need to save the running-config to the startup-config to make them truly permanent (or else they will not be kept if the switch restarts)
>   -   When you issue the `switchport port-security mac-address sticky` command, all current dynamically-learned secure MAC addresses will be converted to sticky secure MAC addresses.
>   -   If you issue the `no switchport port-security mac-address sticky` command, all current sticky secure MAC addresses will be converted to regular dynamically-learned secure MAC addresses.

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060131489.png" alt="image-20230506013152259" style="zoom:36%;" />

#### MAC Address Table

>   Secure MAC addresses will be added to the MAC address table like any other MAC address. 
>   + regular **dynamically-learned secure MAC addresses** will have a type of **DYNAMIC**;
>   + **Sticky and Static secure MAC addresses** will have a type of **STATIC**;
>   + You can view all secure MAC addresess with `show mac address-table secure`;
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060138427.png" alt="image-20230506013814304" style="zoom:38%;" />

#### Command Review

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060139829.png" alt="image-20230506013903565" style="zoom:36%;" />

### Quiz

##### Quiz 1

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060144782.png" alt="image-20230506014416552" style="zoom:33%;" />

<details><summary>Answer:</summary>
    <strong>c) 3</strong>
    <p>According to the output 4 total MAC addresses have been learned on the interface. 1 was configured, that’s not dynamic. There are 3 sticky MAC addresses, what about them? Although sticky MAC addresses are inserted into the running config like a static MAC address, and their type in the MAC address table is STATIC, they are actually dynamically learned.
    </p>
</details>

##### Quiz 2

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060154211.png" alt="image-20230506015418013" style="zoom:33%;" />

<details>
    <summary>Answer:</summary>
    <strong>a,b</strong>
    <p>C, unplugging the unauthorized device, is incorrect because that alone will not re-enable the interface. Note that, you should unplug the unauthorized device before the steps in A or B, but disconnecting the device itself won’t re-enable the interface.
    </p>
</details>

##### Quiz 3

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060157673.png" alt="image-20230506015728437" style="zoom:33%;" />

<details>
    <summary>Answer:</summary>
    <strong>a</strong>
    <p>The administrative mode of G0/1 is static access, so port security can be enabled. However, if it was the default administrative mode of dynamic auto, the command would be rejected. Port security can be configured on access ports or trunk ports, but they must be statically configured with SWITCHPORT MODE ACCESS or SWITCHPORT MODE TRUNK.
    </p>
</details>

##### Quiz 4

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305060200051.png" alt="image-20230506015959838" style="zoom:39%;" />

<details>
    <summary>Answer:</summary>
    <strong>C,E</strong>
    <p>When you enable port security on an interface with the default settings(`switchport port-security`),  ONLY one dynamically-learned MAC address is allowed.         
    </p>
</details>



## DHCP snooping

>   DHCP snooping is a security feature available on Cisco switches which helps to protect against attacks which take advantage of DHCP.

### What is DHCP Snooping?

>   -   **DHCP snooping**(侦听) is a security feature of switches that is used to filter inbound DHCP messages received on *untrusted ports*.
>   -   Note that DHCP snooping only filters DHCP messages. Any other non-DHCP messages aren’t affected.
>   -   All ports are untrusted by default. 
>       -   Usually, *uplink ports are configured as trusted ports*, and *downlink ports remain untrusted*.
>       -   DHCP snooping won’t inspect DHCP messages on trusted ports, the switch will simply forward them as normal.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140009481.png" alt="image-20230514000906311" style="zoom:33%;" />

>   ##### How does it work?
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140136577.png" alt="image-20230514013620362" style="zoom:33%;" />
>
>   1.   PC1 sends a DHCP message, for example a DISCOVER message.
>   2.   SW1 receives the message on an untrusted port, so it inspects the message to see if it’s ok. It determines that the message is fine, so it forwards it as normal.
>   3.   Then SW2 receives it, again on an untrusted interface. It checks the message and determines that it’s okay, so it forwards it to R1.
>   4.   R1 then sends the reply, and it goes straight back to PC1 without being inspected by SW2 or SW1. It’s because they received it on their trusted ports, so they assume the message is okay.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140137425.png" alt="image-20230514013741266" style="zoom:32%;" />
>
>   1.   This time PC2 sends a DHCP message. 
>   2.   SW1 receives it on an untrusted port, so it inspects the message. 
>   3.   However, this time it determines that the message is not OK, so it discards the message.



### What attacks does it prevent?

#### DHCP Starvation Attack

>   -   An example of a DHCP-based attack is a **DHCP Starvation Attack**,aka. **DHCP Exhaustion attack**.
>   -   In this attack, an attacker *uses spoofed MAC addresses to flood DHCP Discover messages*.
>   -   The target server’s DHCP pool becomes full, resulting in a **DoS(denial-of-service)** to other devices. They won’t be able to get an IP address from the server.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140147175.png" alt="image-20230514014704991" style="zoom:33%;" />
>
>   -   DHCP actually uses a field in the DHCP message, written as **CHADDR**, which stands for **Client Hardware Address**, to indicate the MAC address of the client. 
>
>   >   ###### Why is this field needed, when the server could just look at the source MAC address of the frame?
>   >
>   >   -   Well, in a network like this where the DHCP server is in the local network, that would work fine.
>   >   -   But if the DHCP server is in a remote network and the DHCP messages are forwarded by a DHCP relay agent, when the server receives the frames from the client, the source MAC address of the frame will *not be the client’s MAC address* instead of the *MAC address of DHCP relay agent*.

#### DHCP Poisoning (Man-in-the-Middle)

>   -   Similar to **ARP poisoning**, **DHCP poisoning** can be used to perform a man-in-the-middle attack.
>   -   A spurious(虚假的) DHCP server(, that just mean an illegitimate(非法的) DHCP server) replies to clients’ DHCP Discover messages and assigns them IP addresses. But it makes the clients use the spurious DHCP server’s IP address as the default gateway.
>   -   So, in the network below the attacker is running DHCP server software, it is the spurious DHCP server. R1 is the legitimate DHCP server, and also the default gateway. 
>       -   Both of these DHCP servers will respond to clients’ Discover messages, but clients usually accept the **first** Offer message they receive. 
>       -   Now, in a situation like this it’s hard to know which Offer message will reach the clients first, the attacker’s Offer or R1’s Offer.
>       -   But, if the legitimate DHCP server is actually in a remote network and R1 is just acting as a DHCP relay agent, then it’s almost guaranteed that the attacker’s Offer will reach the clients first, because it’s in the local network.
>       -   **This will cause the client to send traffic to the attacker instead of the legitimate default gateway.** The attacker can then examine and/or modify the traffic before forwarding it to the legitimate default gateway.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140159140.png" alt="image-20230514015948966" style="zoom:33%;" />
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140200746.png" alt="image-20230514020022562" style="zoom:33%;" />
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140200358.png" alt="image-20230514020059193" style="zoom:33%;" />
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140201942.png" alt="image-20230514020147762" style="zoom:33%;" />





### DHCP Messages

>   -   When DHCP Snooping filters messages, it differentiates between *DHCP Server messages* and *DHCP Client messages*. 
>       -   If a DHCP message is received on a **trusted** port, forward it as normal without inspection.
>       -   **DHCP server messages received on an untrusted port** will always be discarded with no further checks.
>       -   **DHCP client messages received on an untrusted port** will be inspected, and then the switch will decide to forward or discard the frame.
>   -   here are messages sent by DHCP servers:
>       -   Offer
>       -   ACK (OFFER and ACK you already know, they are used in the standard DHCP D-O-R-A exchange.)
>       -   NAK = (new one) Opposite of ACK, used to decline a client's REQUEST
>   -   here are messages sent by DHCP clients:
>       -   DISCOVER
>       -   REQUEST  (both already know, they are used in the standard DHCP D-O-R-A exchange.)
>       -   RELEASE = Used to tell the server that the client no longer needs its IP address
>       -   DECLINE = Used to decline the IP address offered by a DHCP server

### DHCP Snooping Operations

>   -   If a DHCP message is received on a **trusted** port, forward it as normal without inspection. 
>   -   If a DHCP message is received on an **untrusted** port, inspect it and act as follows:
>
>       -   **If it’s a DHCP server message, discard it.** So, any OFFER, ACK, or NAK messages that are received on an untrusted port will simply be discarded.
>       -   If it is a **DHCP Client message**, perform the following checks:
>           -   For **DISCOVER/REQUEST** messages: Check if the **frame’s source MAC address** and **the DHCP message’s CHADDR fields** match: Match = forward, mismatch = discard
>               -   *This can protect against attacks when an attacker spoofs the client hardware address field of the DHCP message.*
>               -   *However it’s not perfect, because the attacker could just spoof the frame’s source MAC address too.* 
>           -   For **RELEASE/DECLINE** messages: Check if the **packet’s source IP address** and the **receiving interface** match **the entry in the DHCP Snooping Binding Table**. Match = forward, mismatch = discard
>               -   *This prevents attackers from sending these messages on behalf of other devices in the  network, causing the DHCP server to believe that they don’t need their IP addresses anymore.* 
>
>   >   When DHCP snooping is enabled, the switch will create a new entry in the **DHCP snooping binding table** when a client successfully leases an IP address from a DHCP server.



### Configuration

#### Basic Configuration

>   -   Firstly enable DHCP snooping globally with `ip dhcp snooping`, 
>   -   and then enable it on each VLAN necessary, with `ip dhcp snooping vlan VLAN_ID`;
>   -   `no ip dhcp snooping information option` It’s not always necessary, but depending on the network design you might need it.
>   -   Finally, by default all ports will be untrusted, so you have to manually configure the G0/0 interface as a trusted port. 
>       -   G0/0 on both switches is *connected to*/*pointing toward* R1, which is the DHCP server in this network, so I trusted it.
>   -   Check the DHCP snooping binding table with the command `show ip dhcp snooping binding`. This table logs their **MAC addresses**, **IP addresses**, lease times, **VLAN numbers**, and **interface IDs**.

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140243375.png" alt="image-20230514024323977" style="zoom:37%;" />

>   ##### `no ip dhcp snooping information option`
>
>   -   **Option 82**, also known as the **DHCP relay agent information option**, is one of many DHCP options.
>   -   It provides additional information about which DHCP relay agent received the client's message, on which interface, in which VLAN, etc.
>   -   **DHCP relay agents** can add **Option 82** to messages they forward to the remote DHCP server.
>   -   *With DHCP snooping enabled, by default Cisco switches will add Option 82 to DHCP messages they receive from clients, even if the switch isn’t acting as a DHCP relay agent.* **This can cause problems**: 
>
>   ###### here’s one example: 
>
>   -   **By default, Cisco switches will drop DHCP messages with Option 82 that are received on an untrusted port.**
>   -   So, **the default settings work well if the switch is a layer 3 switch acting as a DHCP relay agent**, but in a network like this one it won’t work.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140304589.png" alt="image-20230514030417365" style="zoom:33%;" />
>
>   ###### another example;
>
>   configure the command `no ip dhcp snooping information option` only on SW1, but not yet on SW2:
>
>   1.   PC1 sends a DISCOVER message, and SW1 forwards it to SW2. This time SW1 doesn’t add Option 82.
>   2.   SW2 will add Option 82 and forward it to R1.
>   3.   R1 to drop it. Basically, the logs means that R1 dropped the message because it had option 82, but it wasn’t sent by a relay agent. That’s what ‘inconsistent relay information’ in the log message means. **If a DHCP message wasn’t sent by a relay agent, it shouldn’t have option 82.**
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140312079.png" alt="image-20230514031212875" style="zoom:37%;" />
>
>   ###### Correct configuration:
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140317989.png" alt="image-20230514031720805" style="zoom:37%;" />

#### DHCP Snooping Rate -Limiting

>   -   Another function of DHCP snooping, that is rate-limiting. DHCP snooping can limit the rate at which DHCP messages are allowed to enter an interface, which can be **very useful to protect against DHCP Exhaustion attacks**.
>       -   Remember: **Attackers can spoof both the frame’s source MAC address and the DHCP message’s client hardware address field to bypass the DHCP snooping filtering of DISCOVER and REQUEST messages.**
>       -   But, with rate limiting we can prevent them from exhausting the DHCP server with tons of illegitimate DHCP DISCOVER messages. If the attacker tries to flood the server with DISCOVER messages, the interface will just be disabled.
>   -   If the rate of DHCP messages crosses the configured limit, the interface is **err-disabled**. 
>       -   Like with **Port Security**, the interface can be manually re-enabled, or automatically re-enabled with errdisable recovery.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140250071.png" alt="image-20230514025027779" style="zoom:37%;" />
>
>   -   `ip dhcp snooping limit rate 1`: This limits DHCP messages to 1 per second. 
>       -   If the interface receives more than 1 DHCP message per second, it will be disabled.
>       -   If you set the limit to 1 DHCP message per second, your switch interfaces will definitely get disabled even by legitimate DHCP exchanges.
>       -   But, I set it to 1 so I could easily make SW1’s G0/1 become disabled. These log messages show that G0/1 received more DHCP messages than it’s allowed to, so it was err-disabled.

>   ##### Here’s the command to enable errdisable recovery for DHCP rate limiting.
>
>   ```sh
>   SW1(config)#errdisable recovery cause dhcp-rate-limit
>   ```
>
>   
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140251762.png" alt="image-20230514025145555" style="zoom:37%;" />

#### Command Review

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305140318368.png" alt="image-20230514031838176" style="zoom:37%;" />

---

## Dynamic ARP Inspection

>   Dynamic ARP inspection is a security feature of switches which inspects ARP messages in a similar manner to how DHCP snooping inspects DHCP messages.

>   ##### ARP Review:
>
>   -   ARP is used to learn the MAC address of another device with a known IP address.
>   -   Typically it’s a two message exchange, consisting of 
>       -   ARP request (Broadcast frame: broadcast MAC address of all Fs.)
>       -   ARP reply (Unicast frame)
>   -   Gratuitous ARP allows other devices on the local network to learn the MAC address of the sending device without having to send ARP requests.

### What is Dynamic ARP Inspection?

>   -   DAI is a security feature of switches that is used to *filter ARP messages received on untrusted ports*.
>   -   DAI only filters ARP messages. Non-ARP messages aren’t affected.
>   -   Just like DHCP snooping, all ports are untrusted by default.
>       -   Typically, all ports connected to other network devices, for example switches or routers, should be configured as **trusted**, 
>       -   while interfaces connected to end hosts should remain **untrusted**.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141043725.png" alt="image-20230514104300565" style="zoom:33%;" />

### How does it work? 

Here’s how DAI works, and you’ll see it’s basically the same as DHCP snooping.

##### Demo 1

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141046085.png" alt="image-20230514104625909" style="zoom:33%;" />

1.   PC1 sends an ARP request.
2.   Because it arrives on an untrusted port, SW1 uses DAI to inspect it. It determines the message is OK, so it forwards it to SW2.
3.   In this case SW2 doesn’t inspect it, because it receives the message on a trusted interface, so it forwards it to R1, which sends the reply.
4.   This message isn’t inspected by SW2 or SW1, because they receive it on trusted interfaces.

##### Demo 2

This time PC2 sends an ARP message, but SW1 inspects it and decides to discard the message because it violates the rules of DAI. (I’ll explain exactly how DAI determines if a message is okay or not later.)

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141048055.png" alt="image-20230514104824870" style="zoom:33%;" />

### What&How attacks does it prevent?

#### ARP Poisoning (Man-in-the-Middle)

>   -   Similar to DHCP poisoning, ARP poisoning involves an attacker manipulating targets’ ARP tables so traffic is sent to the attacker.
>   -   To do this, the attacker can send **gratuitous ARP messages** using another device’s IP address.
>       -   Another option is to send replies to the targets’ legitimate ARP request messages, but I’ll use gratuitous ARP for this demonstration. 
>   -   Other devices will receive the gratuitous ARP and update their ARP tables, causing them to send traffic to the attacker instead of the legitimate destination.

>   For example, the attacker PC2 sends a **gratuitous ARP** message using the IP address of the default gateway, R1. 
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141053023.png" alt="image-20230514105332847" style="zoom:33%;" />
>
>   -   It is flooded through the network, and all devices receive it. So, they update their ARP tables to map **PC2’s MAC address** to the IP address 192.168.1.1.
>
>   -   By the way, R1 doesn’t update its ARP table, because 192.168.1.1 is its own IP address.
>
>   Now, if PC1 wants to send this packet to an external network, it is sent to PC2 first. 
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141055798.png" alt="image-20230514105516612" style="zoom:33%;" />
>
>   -   PC2 can save a copy of the message for future inspection and then forward it to the legitimate default gateway, R1.
>   -   It’s possible that PC2 could also manipulate the information in the packet.

#### Dynamic ARP Inspection Operations

>   -   DAI inspects the **sender MAC and sender IP fields of ARP messages received on untrusted ports** and *checks that there is a matching entry in the DHCP snooping binding table*.
>       -   If there is a matching entry, the ARP message is forwarded normally.
>       -   If there isn’t a matching entry, the ARP message is discarded.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141059271.png" alt="image-20230514105959046" style="zoom:38%;" />
>
>   -   Note that this check only occurs on untrusted ports, DAI doesn’t inspect messages received on trusted ports. They are forwarded as normal.
>   -   However, just like in DHCP snooping all ports are untrusted by default, so you have to manually specify which ports are trusted.
>   -   So, DAI operations are usually reliant on DHCP snooping, but actually there is another option: **ARP ACLs** can be manually configured to map IP addresses and MAC addresses for DAI to check.
>       -   Useful for hosts that don’t use DHCP.
>   -   In addition to the sender MAC and sender IP fields, DAI can be configured to perform more in-depth checks, but these are optional.
>   -   Like DHCP snooping, DAI also supports **rate-limiting** to prevent attackers from overwhelming the switch with ARP messages.
>       -   Since DHCP snooping and DAI both require work from the switch’s CPU,
>       -   Even if the attacker’s messages are blocked, they can overload the switch CPU with ARP messages.



### DAI configuration

#### Basic Configuration

>   DHCP Snooping must be enabled previously with the four commands.
>
>   ```sh
>   SW(config)#ip dhcp snooping 
>   SW(config)#ip dhcp snooping vlan 1
>   SW(config)#no ip dhcp snooping information option
>   SW(config-if)#ip dhcp snooping trust  # trust Uplink interfaces connected to/pointing towards the DHCP Server
>   ```
>
>   1.   First, use `ip arp inspection vlan VLAN_ID` to enable DAI on a VLAN.
>        -   If there are multiple VLANs, you should enable DAI for each VLAN.
>   2.   Then I configured SW2’s G0/0 and G0/1 interfaces as trusted ports with the command `ip arp inspection trust`

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141111091.png" alt="image-20230514111102803" style="zoom:35%;" />

##### Check the DAI configuration on interfaces

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141113248.png" alt="image-20230514111332938" style="zoom:39%;" />

#### DAI Rate-limiting

Configure DAI Rate-limiting on the Access interfaces of the switch:

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141116254.png" alt="image-20230514111612851" style="zoom:38%;" />

#### DAI Optional Checks

>   -   By default, DAI checks the sender MAC and IP addresses, to see if there is a matching entry in the DHCP snooping binding table or not.
>   -   However, additional checks can be performed by configuring the `ip arp inspection validate ?` on the switch:
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141122907.png" alt="image-20230514112247524" style="zoom:35%;" />
>
>   -   To enable more than one validation methods, the 3 checks should be integrated to a single command. Otherwise the last command will overwrite the previous one.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141134908.png" alt="image-20230514113454653" style="zoom:35%;" />

>   To clarify those, here is that ARP reply message I showed earlier.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141127658.png" alt="image-20230514112709364" style="zoom:35%;" />
>
>   -   In this case, the source and destination in the Ethernet header match the sender and target MAC addresses in the ARP message, so the message is valid for the `dest-mac` and `source-mac` checks.
>   -   The **sender and target IP addresses** in the ARP message are also valid, so it passes the `ip` check too. 
>   -   Note that these checks are done in addition to the standard DAI check, which looks at the **sender MAC and IP addresses and compares them to the DHCP snooping binding table**. So, if these checks are configured an ARP message must pass all of the checks to be considered valid.

#### ARP ACLs

>   SRV1 has a static IP address, 192.168.1.100, so it doesn’t have an entry in SW2’s DHCP snooping binding table.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141139632.png" alt="image-20230514113949268" style="zoom:35%;" />
>
>   -   So, what will happen when SRV1 tries to send an ARP request? It will be dropped, with an error message like this. It says 1 invalid ARP request on G0/2 in VLAN1. That’s because SRV1 doesn’t have an entry in SW2’s DHCP snooping binding table.
>   -   So, to fix this let’s configure an ARP ACL on the switch and enable it on the specified VLAN to permit SRV1.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141140356.png" alt="image-20230514114022142" style="zoom:35%;" />

##### Check the DAI configuration

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141144049.png" alt="image-20230514114453698" style="zoom:35%;" />

#### Command Review

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202305141145667.png" alt="image-20230514114532415" style="zoom:34%;" />
