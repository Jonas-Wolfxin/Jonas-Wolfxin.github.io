---
title: Dynamic Routing P2 OSPF
date: 2023-04-01 07:08:26
permalink: /pages/c4055c/
categories:
  - 网络运维
  - CCNA
  - CCNA知识笔记
tags:
  - 
---


---

> Here are the numeric units and their values expressed in 10 to the power format:
>
>   1. Kilo (K): 10^3
>   2. Mega (M): 10^6
>   3. Giga (G): 10^9
>   4. Tera (T): 10^12
>   5. Peta (P): 10^15
>   6. Exa (E): 10^18
>   7. Zetta (Z): 10^21
>   8. Yotta (Y): 10^24

---

## OSPF Intro

> - **Open Shortest Path First**(开放式最短路径优先）, industry standard, 是用于IP网络的[链路状态路由协议](https://baike.baidu.com/item/链路状态路由协议/1219386)。
>
>   - 适用于[IPv4](https://baike.baidu.com/item/IPv4/422599)的OSPFv2协议定义于RFC2328，
>
>   - 适用于[IPv6](https://baike.baidu.com/item/IPv6/172297)的OSPFv3定义于RFC5340。
>
> - Three versions:
>
>   - OSPFv1 (1989): OLD, not in use anymore
>   - OSPFv2 (1998): Used for IPv4
>   - OSPFv3 (2008): Used for IPv6 (*can also be used for IPv4, but usually v2 is used*)
>
> - Routers store information about the network in **LSAs**(Link State Advertisements), which are organized in a structure called the **LSDB**(Link State Database).
>
> - Routers will **flood** LSAs until all routers in the **OSPF area** develop the same map of the network (LSDB).
>
>   - In the case of OSPF, it means router send the LSAs to all of their OSPF neighbors.
>   - OSPF ‘areas’ are a unique aspect of OSPF. More details later.
>
> - 是广泛使用的一种动态路由协议，它属于链路状态路由协议，具有路由变化收敛速度快、无路由环路、支持变长子网掩码（VLSM）和汇总等优点。在网络中使用[OSPF协议](https://baike.baidu.com/item/OSPF协议/421662)后，大部分路由将由OSPF协议自行计算和生成，无须网络管理员人工配置，当网络拓扑发生变化时，协议可以自动计算、更正路由，极大地方便了网络管理。。
>
> - OSPF协议可以让每个路由器负责发现、维护与邻居的关系，并将已知的邻居列表和链路状态更新LSU(Link State Update)报文描述，通过可靠的泛洪与自治系统AS(Autonomous System)内的其他路由器周期性交互，学习到整个自治系统的[网络拓扑结构](https://baike.baidu.com/item/网络拓扑结构/4136060); 并通过自治系统边界的路由器注入其他AS的路由信息，从而得到整个Internet的路由信息。每隔一个特定时间或当链路状态发生变化时，重新生成LSA，路由器通过泛洪机制将新LSA通告出去，以便实现路由的实时更新。
>
> - 功能和特点:
>
>   - 该协议使用 **Shortest Path First**(最短路径优先)算法(aka. **Dijkstra Algorithm**)。
>
>     - 首先OSPF要构建一个最短路径树, 然后使用最佳路径的计算结果来组建路由选择表;
>     - OSPF 的会聚也很快，虽然它可能没有EIGRP快，并且它也支持对相同目标的等价多路径路由。
>
>   - 使用AS自治系统并支持自治系统内进行层次区域划分;
>
>       >   将OSPF创建为层次结构的原因如下:
>       >
>       >   - 减少路由选择的开销;
>       >   - 加速会聚;
>       >   - 将网络的不稳定性限制在单一的网络区域内。
>
>   - 最小化的路由选择的更新流量;
>
>   - 支持VLSM和CIDR;
>
> - AD: 110
>
> - OSPF在单一AS内通过 SPF算法 计算到达目的地的最短路径, 路由器使用最短路径树来将OSPF路由插入到路由表中
>
>   - 链路(Link): 路由器的接口
>
>   - 状态(State): 描述接口及其与邻居路由器之间的关系
>
>   - Cost: 每个路由器都把自己的接口当做根, 去构造一棵树(这棵树中只包含了路由器所在区域内的网络), 并且给与累计成本来计算到达目的地的最短路径
>
>
> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303300419655.png" alt="image-20220620191328842" style="zoom:39%;" />



### LSA & Areas

#### LSA Flooding

> - this network of four routers is running OSPF. All of these routers are OSPF neighbors, they have the same link state database and the network is stable.
> - **LSDB is identical for all routers in the OSPF area. Each of these routers has a complete map of the network.**
> - Each individual LSA has an aging timer, which is **30 minutes** by default.

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010118059.png" alt="image-20230401011832637" style="zoom:33%;" />

#### Process of sharing LSAs and determing the best route

> In OSPF, there are **three main steps** in the process of sharing LSAs and determining the best route to each destination in the network:
>
>   1. *Become neighbors* with other routers connected to the same segment;
>   2. *Exchange LSAs* with neighbor routers;
>   3. Each router independently *calculates its best routes to each destination, and inserts them into the routing table*.

#### OSPF Areas

> - OSPF uses **Areas** to divide up the network.
> - Small networks can be single-area without any negative effects on network performance;
> - In larger networks, however, *a single-area design* can have some **negative** effects:
>   - SPF algorithm takes more time to calculate routes in a large network;
>   - SPF algorithm requires exponentially(指数级) more processing power on each router to make calculations.
>   - Larger LSDB takes up more memory on the routers;
>   - Any small change in the network causes every router to flood LSAS and run the SPF algorithm again;
> - By dividing a large OSPF network into several smaller areas, you can avoid the above negative effects.

##### Example of a larger network

>##### possible one large, single-area network
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010134524.png" alt="image-20230401013403209" style="zoom: 25%;" />
>
> - All interfaces on all routers are assigned to **Area 0**, also known as the **Backbone Area**.
>
>##### Possibly divided into separate Areas
>
> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010138019.png" alt="image-20230401013807700" style="zoom:25%;" />

##### Terms of OSPF Areas

> - `Area`: a set of routers and links that share the same *LSDB(link state database)*.
> - `Backbone Area` (which is **Area 0**) is a special area, that **all other areas must connect to**.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010144115.png" alt="image-20230401014458823" style="zoom:28%;" />
>
> - Routers *with all interfaces in the same OSPF area* are called ``**Internal Routers**’.
>
> - Routers *with interfaces in multiple areas* are called ‘**Area Border Routers(ABR)**’, because they are the border between different OSPF areas.
>   - ABRs maintain a separate LSDB for each area they are connected to.
>   - It is recommend that you connect an ABR to a *maximum of 2 areas*. Connecting an ABR to 3+ areas can **overburden** the router.
> - Routers **connected to the Backbone Area(area 0)**, which means *at least one of the interfaces on the routers must be configured in Backbone Area*,  are called **Backbone Routers**.
>   - (The *ABRs in this diagram* are also Backbone Routers, *on top of* being an ABR.;
>   - Of course, the *Internal Routers in Area 0* are Backbone Routers.)
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010151952.png" alt="image-20230401015137621" style="zoom:30%;" />
>
> - An **Intra-area Route** is a route to a destination inside the same OSPF area.
> - An **Inter-area Route** is a route to a destination in a different OSPF area.
> - OSPF运行在某个自治系统内部，但是通过路由器也可以将多个自治系统连接起来或者连接到Internet, 这种路由器被称为[**ASBR(Autonomous System Boundary Router)**](# 查看指令)。An [...] is an OSPF router that connects the OSPF network to an external network.
>
> ![image-20230401035254819](https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010352961.png)

##### Reqiurements of OSPF Areas

> - **OSPF areas should be contiguous**. It means that each individual area should be connected, not divided up.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010216273.png" alt="image-20230401021658953" style="zoom:25%;" />
>
> - All OSPF areas must have *at least one ABR* connected to the backbone area.
> - OSPF interfaces in the same subnet must be **configured in the same area**.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010224810.png" alt="image-20230401022410495" style="zoom:33%;" />

### OSPF Metric

> - OSPF’s metric is called **Cost**, which is *automatically calculated based on the bandwidth (speed) of the interface*.
> - It is calculated by dividing a **Reference Bandwidth(100 Mbps by default)** by the **interface’s bandwidth**. Therefore Fast-Ethernet, Gigabit-Ethernet, 10Gig-Ethernet, etc. are equal and all have a **cost of 1 by default**. `(This could lead to efficiency problems in Load-Balancing!)`
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010625327.png" alt="image-20230401062532122" style="zoom:33%;" />
>

#### Change the Reference-Bandwidth on routers

> - You can (**and should!**) change the reference bandwidth *greater than the fastest links in your network* (to allow for future upgrades) with this command:
> 
>  ```sh
>   R1(config-router)# auto-cost reference-bandwidth Megabits-Per-Second
>  ```
>

#### Change the Cost of an Interface

> - The Cost of each interface can be manually configured via the command `ip ospf cost 数值`;
>
> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010651277.png" alt="image-20230401065135083" style="zoom:43%;" />
>
> - The Cost of each interface can be shown via `show ip ospf interface Interface`.
>
> <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010716820.png" alt="image-20230401071657667" style="zoom:30%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010644899.png" alt="image-20230401064432529" style="zoom:33%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010650281.png" alt="image-20230401065042783" style="zoom:33%;" />

#### change Bandwidth of an interface: But not recommended

>- One more option to change the OSPF cost of an interface is to **change the bandwidth of the interface** with the `bandwidth` command.
>- The formula to calculate OSPF cost is `reference bandwidth / interface bandwidth`;
> - **However, the bandwidth value is used in other calculations, it is not recommended to change this value to alter the interface’s OSPF cost.**

>###### Bandwidth Vs Speed on an interface
>
> - Although the bandwidth matches the interface speed by default, changing the interface bandwidth doesn’t actually change the speed at which the interface operates.
> - The bandwidth is just a value that is used to calculate OSPF cost, EIGRP metric, etc.
> - To change the speed at which the interface operates, use the `speed`command.

#### summary

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010714835.png" alt="image-20230401071439608" style="zoom:30%;" />

### OSPF Neighbors

>   -   *Making sure that routers successfully become OSPF neighbors is the main task in configuring and troubleshooting OSPF.* 
>   -   **Once routers become neighbors**, they automatically do the work of sharing network information, calculating routes, etc. 
>   -   When OSPF is activated on an interface, the router starts sending **OSPF hello messages** out of the interface at regular intervals (determined by the hello timer). These are used to introduce the router to potential OSPF neighbors. 
>   -   The default hello timer is **10 seconds** on an Ethernet connection.
>   -   **Hello messages** are multicast to **224.0.0.5** (multicast address for all OSPF routers);
>   -   **Messages to the OSPF DR/BDR** are multicast using address [**224.0.0.6**].
>   -   OSPF messages are encapsulated in an IP header, with **a value of 89 in the Protocol** field.



#### Seven states of OSPF

>   ###### Down state
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010919960.png" alt="image-20230401091934817" style="zoom: 33%;" />
>
>   -   OSPF is activated on R1’s GO/O interface. 
>   -   It sends an OSPF hello message to `224.0.0.5`.
>   -   It doesn’t know about any OSPF neighbors yet, so the current neighbor state is Down.
>
>   ###### Init State
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010920145.png" alt="image-20230401092057003" style="zoom:33%;" />
>
>   -   When R2 receives the Hello packet, it will add an entry for R1 to its OSPF neighbor table. 
>   -   In R2’s neighbor table, the relationship with R1 is now in the Init state. 
>   -   `Init state = Hello packet received, but own router ID is not in the Hello packet.`
>
>   ###### Two-way State
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010924340.png" alt="image-20230401092411165" style="zoom:33%;" />
>
>   -   R2 will send a Hello packet containing the Router_ID of both routers. R1 will insert R2 into its OSPF neighbor table within the 2-way state.
>   -   R1 will send another Hello message, this time containing R2’s RID. Now both routers are in the 2-way state.
>   -   `The 2-way state means the router has received a Hello packet with its own RID in it.`
>   -   **If both routers reach the 2-way state, it means that all of the conditions have been met for them to become OSPF neighbors.** They are now ready to share LSAs to build a common LSDB.
>   -   In some network types, a **DR (Designated Router)** and **BDR (Backup Designated Router)** will be elected at this point.
>
>   ###### EXstart state
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010933865.png" alt="image-20230401093349722" style="zoom:33%;" />
>
>   -   After the 2-way state, the two routers will now prepare to exchange information about their LSDB.
>
>   -   Before that, they have to choose which one will start the exchange. (Master/Slave router)
>
>       This **Master/Slave relationship** is only needed for this **initial exchange of LSDB** information.
>
>   -   The router with the **higher Router_ID** will become the Master and initiate the exchange. The router with the lower Router_ID will become the Slave.
>
>   -   To decide the Master and Slave, they need to exchange *DBD (Database Description)* packets.
>
>   ###### Exchange state
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010936086.png" alt="image-20230401093614904" style="zoom:33%;" />
>
>   -   In the Exchange state they exchanged DBD packets, so they know which LSAs their neighbors are holding. In the Exchange state, the routers exchange DBDs which contain a list of the LSAs in their LSDB. These DBDs do not include detailed information about the LSAs, just basic information telling their neighbor what LSAs they have.
>   -   The routers compare the information in the DBD they received to the information in their own LSDB to determine which LSAs they must receive from their neighbor.
>
>   
>
>   ###### Loading state
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010940695.png" alt="image-20230401094047514" style="zoom:33%;" />
>
>   -   routers send **LSR** messages to request LSAs they don’t have from their neighbor.
>   -   Then the LSAs are sent in **LSU**(Link State Update) messages.
>   -   Finally, The routers send **LSAck** messages to acknowledge that they received the LSAs. Now the loading state is complete, and the routers have the same LSDB.
>
>   ###### Full state
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010945993.png" alt="image-20230401094552848" style="zoom:33%;" />
>
>   -   In the Full state, the routers have a **full OSPF adjacency** and **identical LSDBs**.
>   -   They continue to send and listen for **Hello packets**(once every 10 seconds by default) to maintain the **neighbor adjacency**. To maintain the adjacency, another timer called the ‘Dead’ timer is used.
>   -   Every time a Hello packet is received, the **‘Dead’ timer (40 seconds by default)** is reset. However, if the Dead timer counts down to 0 and no Hello message is received, the neighbor is removed.
>   -   If the neighbors remain up, the routers will continue to share LSAs as the network changes to make sure each router has a complete and accurate map of the network.

##### Another Notation: Eight States of OSPF neighbors

>   In OSPF (Open Shortest Path First), neighbor states are used to track the progress of forming and maintaining neighbor relationships between OSPF routers. There are several neighbor states that OSPF routers can go through as they establish and maintain neighbor relationships. These states are:
>
>   1.  **Down**: In this state, the router has not yet established any communication with its neighbor.
>   2.  **Attempt**: In this state, the router is attempting to establish a neighbor relationship with the neighbor by sending hello packets.
>   3.  **Init**: In this state, the router has received a hello packet from its neighbor, but it has not yet received confirmation of the hello packet.
>   4.  **2-Way**: In this state, the router has received confirmation of the hello packet from its neighbor, and it has also sent a hello packet to the neighbor.
>   5.  **Exstart**: In this state, the router has initiated the process of exchanging database information with its neighbor.
>   6.  **Exchange**: In this state, the router is actively exchanging database information with its neighbor.
>   7.  **Loading**: In this state, the router is receiving the database information from its neighbor.
>   8.  **Full**: In this state, the router has successfully established a neighbor relationship with its neighbor, and it has received a complete copy of the neighbor's link-state database.
>
>   Once the neighbor relationship is established and both routers reach the Full state, they can exchange routing information and update their routing tables based on the topology of the network.

#### Process of OSPF relationship establishment

>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010955409.png" alt="image-20230401095545125" style="zoom:33%;" />
>
>   The three main steps in the process of sharing LSAs and determining the best routes to each destination are 
>
>   1.   **Become neighbors** with other routers connected to the same segment;
>   2.   **Exchange LSAs** with neighbor routers;
>   3.   **Calculate the best routes** to each destination, and insert them into the routing table.



#### OSPF的报文类型

><img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011000054.png" alt="image-20230401100054804" style="zoom:33%;" />

#### Full-Adjacency Relationship Requirements

<img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220620202409172.png" alt="image-20220620202409172" style="zoom: 33%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303300419982.png" alt="image-20220620211633205" style="zoom:43%;" />

> ##### OSPF Neighbor/Adjacency Requirements:
>
>   1. `Area-ID` must match; 
>
>   2. One of the interfaces of the **routers** must be in the same subnet(Area);
>
>   3. **OSPF process must not be shutdown**;
>
>      <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304020313739.png" alt="image-20230402031311582" style="zoom:47%;" />
>
>   4. **OSPF Router_IDs** must be unique;(*Routers with matching OSPF router IDs can't become neighbors*)
>
>   5. **Hello and Dead timers** must match;
>
>      >   - Hello间隔用于设定发送两个Hello 数据包之间的移计数。
>      >   - 而dead间隔是指路由器发出的Hello 数据包没有被邻居看到，因而宣称此OSPF 路由器右机所经过的秒数。
>      >   - OSPF 要求，两个邻居间设置的这些时间间隔必须是完全相同的。如果这些间隔中的任何一个不相同，则此网络分段上的路由器将不能成为邻居。可以使用show ip ospf interface 命令来查看这些定时器。
>
>   6. `Authentication password` must match;
>
>      <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304020319565.png" alt="image-20230402031914435" style="zoom:45%;" />
>
>   7. **Stub Area Flag** must match;
>
>   8. **IP MTU settings** must match(The default is usually 1500 bytes);
>
>      >   Even if the settings don’t match, the neighbors can become OSPF neighbors, but OSPF won’t function properly.
>      >
>      >   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304020323285.png" alt="image-20230402032356106" style="zoom:45%;" />
>
>   9. The OSPF network type must match.
>
>      >   If two routers have an OSPF network type mismatch, they will form an OSPF adjacency but won't [**learn OSPF routes**].
>      >
>      >   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304020326891.png" alt="image-20230402032613680" style="zoom:43%;" />
>      >
>      >   R2’s loopback address should be in R1’s, but not.
>      >
>      >   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304020327992.png" alt="image-20230402032716728" style="zoom:35%;" />



#### OSPF的三张表

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303300419017.png" alt="image-20220620202258962" style="zoom: 33%;" />

```sh
show ip ospf neighbor
show ip ospf topology
show ip route
```



### OSPF Network Types

>   The OSPF ‘**network type**’ refers to **the type of connection between OSPF neighbors** (Ethernet, etc). 
>
>   There are three main OSPF network types: 
>
>   -   **Broadcast**: enabled by default on **Ethernet** and *FDDI (Fiber Distributed Data Interfaces)* interfaces;
>   -   **Point-to-point**: enabled by default on *PPP* (Point-to-Point Protocol) and *HDLC* (High-Level Data Link Control) interfaces;
>   -   **Non-broadcast**: enabled by default on *Frame Relay* and *X.25* interfaces; We won’t cover this network type, but with the ‘Non-broadcast’ network type you must manually configure neighbors.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011500167.png" alt="image-20230401150045936" style="zoom:30%;" />

#### OSPF Broadcast Network

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011256077.png" alt="image-20230401125645934" style="zoom: 50%;" />

>   -   In the network diagram above, these are all Ethernet connections, remember ‘G’ means ‘Gigabit Ethernet’.
>   -   **Broadcast Network** is enabled on *Ethernet* and *FDDI interfaces* by default.
>   -   Routers dynamically discover neighbors by **sending/listening for OSPF Hello messages** using the **multicast address 224.0.0.5**.

##### DR/BDR

>   -   只有在**Broadcast Network**和**Non-Broadcast**多路访问网络(如以太网和帧中继)的网络分段上才会进行DR和BDR的选举。oint-to-Point Network，例如串行WAN连接，不会进行DR/BDR的选举。
>   -   **A DR(Designated Router) and BDR(Backup Designated Router) must be elected on each subnet.** However, in cases like the G1/0 interface of R1, R3, R4, and R5 where there are no OSPF neighbors, there is just a DR, no BDR.
>   -   Routers which aren’t the DR or BDR for the subnet become a ‘**DROther**’.



>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011424507.png" alt="image-20230401142457246" style="zoom:33%;" />
>
>   ###### DR/BDR 对减少 the Cost of OSPF Routing的作用机制:
>
>   -   **Connections between two DROthers stop at 2-way state.**
>   -   **Routers will only continue on to exchange LSAs and form a full OSPF adjacency with the DR and BDR. **
>   -   **And DROthers will form a FULL adjacency only with the DR/BDR.**

> ###### ==OSPF中 DR 和 BDR的选举规则==:
>
>   1. 首先会比较同一网段内各个接口的Priority值(0~255, **默认是1**): **数值越大越优**;
>
>      - if you set the OSPF interface priority to 0, the router **CANNOT** be the DR/BDR for the subnet, no matter what.
>      - 优先级查看: `how ip ospf interface`;
>      - 优先级修改: `R2(config-if)#ip ospf priority ?`
>
>   2. Priority数值相等时, 进行 Router-ID 的比较: **数值越大越优**;
>
>      - 默认情况下 the Highest IP address on the interfaces, 将在路由器启动时成为该路由器的Router_ID。
>
>      - 可以配置Loopback address来修改RID(在决定Router_ID的时候, loopback地址的优先级比物理地址更高);
>
>      - 也可以使用命令`router-id`实现对Router_ID的强制修改:
>
>          ```sh
>          R3#sh ip ospf
>           Routing Process "ospf 1" with ID 10.1.12.1
>          R3#config t
>          R3(config)#router ospf 1
>          R3(config-router)#router-id 172.31.1.4
>          R3#Reload or use "clear ip ospf process" command, for this to take effect
>                                              
>          R3(config-router)#do clear ip ospf process
>          Reset ALL OSPF processes? [no]: yes
>              20:16:35: %OSPF-5-ADJCHG: Process 1, Nbr 10.1.5.1 on FastEthernet0/0
>              from FULL to DOWN, Neighbor Down: Adjacency forced to reset
>              20:16:35: %OSPF-5-ADJCHG: Process 1, Nbr 10.1.5.1 on FastEthernet0/0
>              from FULL to DOWN, Neighbor Down: Interface down or detached
>          R3(config-router)#do sh ip ospf
>              Routing Process "ospf 1" with ID 172.31.1.4
>          ```
>
> ###### DR/BDR的`Non-preemptive`:
>
> Once the DR/BDR are selected they will keep their role until **OSPF is reset**, **the interface fails/is shut down**, etc. OSPF选举过程结束后加入的路由器, 或者对现有路由器的OSPF interface Priority和Router_ID进行了修改, 即使拥有更高的 Priority和 Router-ID, 但只要现有的DR不挂掉或者OSPF process没有被重启, DR就不会被新的路由器所抢占;

##### Lab

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011350524.png" alt="image-20230401135022358" style="zoom:43%;" />

```sh
# change the OSPF interface priority of the router
R2(config)#int f1/0
R2(config-if)#ip ospf ?
  <1-65535>           Process ID
  authentication      Enable authentication
  authentication-key  Authentication password (key)
  cost                Interface cost
  dead-interval       Interval after which a neighbor is declared dead
  hello-interval      Time between HELLO packets
  message-digest-key  Message digest authentication password (key)
  network             Network type
  priority            Router priority
R2(config-if)#ip ospf priority ?
  <0-255>  Priority
R2(config-if)#ip ospf priority 255
```



>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011351933.png" alt="image-20230401135102759" style="zoom:39%;" />
>
>   -   That’s strange. R2’s state is still DROTHER, even though it has the highest priority. 
>   -   Why?  **It’s because the DR/BDR election is ‘non-preemptive’.** 
>   -   So, although this is a bad idea to do in a live network, I reset the OSPF process on R5 and let’s see what happens.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011353790.png" alt="image-20230401135340545" style="zoom:50%;" />
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011400091.png" alt="image-20230401140019927" style="zoom:50%;" />
>
>   -   After I reset the OSPF process on R5, you can see that all of its neighbors went DOWN. Then R2 and R4 returned to the FULL state, but not R3. There’s an important reason!
>
>   -   Then I used the `show ip ospf neighbor` command to view the neighbor state of R5’s neighbors. Look here, there are two important points about OSPF we can learn by analyzing this section.:
>
>       -   R4 became the DR, not R2. R2 became the BDR;
>
>           -> **when the DR goes down, the BDR(R4) becomes the new DR. Then an election is held for the next BDR. R2 has the highest priority, 255, so it became the BDR.**
>
>       -   R3 is a **DROther**, and is stable in the 2-way state.
>
>           -> **DROthers(R3 and R5 in this subnet) will only move to the FULL state with the DR and BDR of the subnet. Its neighbor state with other DROthers(R3 <-> R5) will be 2-way.**
>
>   >   **Conclusion:** 
>   >
>   >   -   In the Broadcast Network type, routers will only form a full OSPF adjacency with the DR and BDR of the segment.
>   >   -   Therefore, routers only exchange LSAs with the DR and BDR.
>   >   -   Remember that, in the 2-way state, routers haven’t shared LSAs with each other yet. All routers will still have the same LSDB, but this reduces the amount of LSAs flooding the network.

###### 假设反例说明

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011412882.png" alt="image-20230401141244692" style="zoom: 25%;" />

>   If 6 routers are connected to the same segment and they all share LSAs with each other, it will end up like this. A whole lot of LSAs flooding and congesting the network. How about if we use a DR and BDR?
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011414253.png" alt="image-20230401141401083" style="zoom:25%;" />
>
>   -   If routers only exchange LSAs with the DR and BDR, as you can see the number of LSAs flooding around the network is reduced. 
>   -   By the way, when routers need to send messages to the DR and BDR they use multicast address `224.0.0.6`. This is different than the OSPF ‘all routers’ multicast address of 224.0.0.5.

#### Point-to-Point Network

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011435507.png" alt="image-20230401143542358" style="zoom:43%;" />

>   -   The Point-to-Point Network type is **enabled on serial interfaces using the PPP or HDLC encapsulations** by default. (PPP and HDLC are both Layer 2 encapsulations, similar to Ethernet, except they are used on serial connections between 2 routers.)
>   -   Same as the Broadcast network type, routers **dynamically discover neighbors by sending/listening for OSPF Hello messages using multicast address 224.0.0.5**.
>   -   The two routers will form a Full adjacency with each other, **without the need to elect a DR and BDR**.

##### Serial interfaces:

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011441630.png" alt="image-20230401144106193" style="zoom:33%;" />

###### Configuration of serial connections

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011444019.png" alt="image-20230401144429673" style="zoom:38%;" />

**The encapsulation type in Point-to-Point Network is HDLC by default:**

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011445712.png" alt="image-20230401144524419" style="zoom:38%;" />

**Change encapsulation type of Serial Connection to ppp :**

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011446704.png" alt="image-20230401144659513" style="zoom:38%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011451282.png" alt="image-20230401145158035" style="zoom:33%;" />

**Check the DCE/DTE status:**

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011454601.png" alt="image-20230401145417356" style="zoom:38%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011456614.png" alt="image-20230401145613408" style="zoom: 29%;" />

#### Configure the OSPF Network Type

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011459385.png" alt="image-20230401145945040" style="zoom:33%;" />

### OSPF LSA Types

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304020332893.png" alt="image-20230402033218712" style="zoom:50%;" />

>   -   OSPF LSDB is made up of LSAs.
>   -   All routers in the same OSPF area share the same LSDB.
>
>   <img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304020343850.png" alt="image-20230402034333629" style="zoom:38%;" />
>
>   -   There are 11 types of LSA, but there are only 3 you should know for the CCNA:
>       -   **Type 1 LSA, the router LSA;**
>           -   Every router (running OSPF) generates this type of LSA;
>           -   identifies the router using its **Router ID**;
>           -   lists networks attached to the router’s OSPF-activated interfaces.
>       -   **Type 2 LSA, the ‘network LSA’;**
>           -   generated by the **DR** of each ‘**multi-access**’ network.(An example of a multi-access network is an Ethernet network using the broadcast network type.)
>           -   lists the routers which are attached to the multi-access network.
>       -   **Type 5 LSA, the ‘AS external LSA’**
>           -   generated by ASBRs to describe routes to destinations outside of the autonomous system, the OSPF domain.

### Configuration

#### Basic Configuration

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303300419637.png" alt="image-20220621085920432" style="zoom:40%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303300419406.png" alt="image-20220621085951700" style="zoom:40%;" />

> 在CCNA阶段, 只需掌握基本的Single-Area的OSPF配置即可

```sh
R1(config)#router ospf Process_ID   
# 各路由器的OSPF Process_ID 是彼此互不相关的(取值介于1~65535), 仅便于维护和区别同一路由器的Process_ID

R1(config-router)#network 每个接口的网段地址 Wildcard_Mask area Area_ID  
# <0-4294967295> OSPF area (decimal value)
R1(config-router)#network 0.0.0.0 255.255.255.255 area Area_ID  
# small trick, only used in experimental environment


R1(config-router)#passive-interface default
R1(config-router)#no passive-interface Specific_Interface # 在连接其他OSPF路由器的端口上开启OSPF路由信息转发


# router-id的手动配置
R1(config-router)#router-id A.B.C.D   # 手动配置后, 需要reload或者执行`clear ip ospf process`来令其生效,But this is a bad idea in a real network, and the router will lose all of its OSPF routes for a short time and won’t be able to forward traffic to those destinations.
```

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010231723.png" alt="image-20230401023138381" style="zoom:33%;" />

> - **Process_ID is totally unrelated to the Area.** A router can run **multiple** OSPF processes at once, and the **Process_ID** is used in the router to identify each of them. Typically you’ll just use a single OSPF process in CCNA.
>
>   - The OSPF process ID is locally significant. **Routers with different Process_IDs can become OSPF neighbors.**
>
> - Router ID in OSPF order of priority(exactly the same way as in EIGRP):
>       1) Manual configuration
>       2) Highest IP address on a loopback interface
>       3) Highest IP address on a physical interface
>
> - The **OSPF `network` command** requires you to specify the area.
>
>   - For the CCNA, you only need to configure single-area(Area 0) in OSPF. (It’s actually possible to use any area number, but it’s considered best practice to use area 0.)
>
>       >   The `network` command **functions just like in RIP and EIGRP, simply used to tell the router which interfaces to activate OSPF on.**
>       >
>       >   1. look for any interfaces with an IP address contained in the range specified in the `network`command;
>       >   2. activate OSPF on the interface in the specified area;
>       >   3. the router will then try to become OSPF neighbors with other OSPF-activated neighbor routers.
>
> - The command `passive-interface`:
>
>   - make the router to stop sending OSPF ‘**Hello**’ messages out of the interface.
>   - However, the router will **continue to send LSAs** informing its neighbors about the subnet configured on the interface.
>   - You should always use this command on interfaces *which don’t have any OSPF neighbors*.

>##### Wildcard Mask
>
>- 配置OSPF可以有许多种不同的方式，但最简单和最容易的做法就是使用**通配符掩码**`0.0.0.0`;
>
>- 取值与子网掩码相反, `通配符掩码 = 255 - 子网掩码`;
>
>- 引例:
>    - 网络和通配符掩码1.1.1.1 0.0.0.0 的组合将只指定使用1.1.1.1精确配置的接口，而不包含其他的地址; 如果想在指定接口上简单明确地激活OSPF，这种方式确实很有用;
>    - 如果你要匹配网络中的某个范围，如网络和通配符掩码1.1.0.0 0.0.255.255 的组合将指定一个范围1.1.0.0 - 1.1.255.255。
>
>- 示例:
>
>
>>   下面的路由器使用了4个不同的接口与4个子网相连接:
>>
>>   `192.168.10.64/28` ;
>>
>>   `192.168.10.80/28` ;
>>
>>   `192.168.10.96/28` ;
>>
>>   `192.168.10.8/30` 。
>
>>   - 所有的接口都需要配置在Area 0中。在我看来，最简单的聚合配置方式是:
>
>>   ```sh
>>   Test#config t
>>   Test(config)#router ospf 1
>>   Test(config-router)#network 192.168.10.0 0.0.0.255 area 0
>>   ```
>
>>   - 遗憾的是, 这样简易的配置方式并没有包含在CCNA的目标中!既然这样，我们需要通过使用子网号和通配符，为每个接口创建一个单独的网络声明:
>
>>   ```sh
>>   Test#conf t
>>   Test(config)#router ospf 1
>>   Test(config-router)#network 192.168.10.64 0.0.0.15 area 0
>>   Test(config-router)#network 192.168.10.80 0.0.0.15 area 0
>>   Test(config-router)#network 192.168.10.96 0.0.0.15 area 0
>>   Test(config-router)#network 192.168.10.8 0.0.0.3 area 0
>>   ```
>
>>   - 在此使用0.0.0.0 通配符来精确地指定接口的IP地址也是可以的, 但是CCNA 的目标不仅仅是要掌握那些最容易操作的部分

##### Advertise a Default Route into OSPF

```sh
Router(config-router)# default-infomation originate
```

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010328735.png" alt="image-20230401032821293" style="zoom:33%;" />

###### 查看OSPF协议状态信息

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010340944.png" alt="image-20230401034046575" style="zoom:53%;" />

#### More configuration

```sh
# Activate OSPF directly on an interface
R1(config-if)# ip ospf Process_ID area Area_ID   

# Configure all interfaces as passive interfaces by default: 
R1(config-router)# passive-interface default

R1(config-router)# no passive-interface s0/0/0
```

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011009882.png" alt="image-20230401100948464" style="zoom:33%;" />

###### 查看OSPF状态信息

>   **Note:** The ‘routing for networks’ section is empty, and instead the interfaces you activated OSPF on are displayed here

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011011469.png" alt="image-20230401101106281" style="zoom:43%;" />

---

#### Configuration of P2P serial connection

```sh
R1(config)#int s0/0/0
R1(config-if)#ip address 192.168.12.1 255.255.255.252
R1(config-if)#ip ospf network ?
  broadcast       Specify OSPF broadcast multi-access network
  point-to-point  Specify OSPF point-to-point network
  
R1(config-if)#ip ospf network point-to-point 

R1(config-if)#do show controllers s0/0/0
Interface Serial0/0/0
Hardware is PowerQUICC MPC860
DCE V.35, clock rate 200000    # you can know this router is DCE
[More]

R1(config-if)#clock rate ?
Speed (bits per second)
1200, 2400, 4800, 9600, 19200, 38400, 56000, 64000, 72000, 125000, 128000, 148000, 250000, 500000, 800000, 1000000, 1300000, 2000000, 4000000        
<300-4000000>  Choose clockrate from list above

R1(config-if)#clock rate 128000
R1(config-if)#no shutdown 
```

```sh
R2(config)#int s0/0/0
R2(config-if)#ip address 192.168.12.2 255.255.255.252
R1(config-if)#ip ospf network point-to-point 
R1(config-if)#no shutdown 
```



### OSPF的相关命令

#### 查看命令

```sh
sh run int e0/0

R1#show ip ospf ?
  <1-65535>       Process ID number
  border-routers  Border and Boundary Router Information
  database        Database summary
  interface       Interface information
  neighbor        Neighbor list
  virtual-links   Virtual link information
  <cr>
  
#show ip ospf neighbor   # 查看OSPF邻居表
#show ip ospf interface brief
#show ip ospf route

#clear ip route *   # 清空路由表(也包括静态路由)
```

- `show ip ospf` 用于显示运行在该路由器上的-个或全部OSPF进程的OSPF信息。这些信息包含路由器ID 、区域信息、SPF 统计和LSA 定时器信息。

    ```sh
    Corp#sh ip ospf
        Routing Process "ospf 132" with ID 10. 1. 5.1
        Supports only single TOS(TOSO) routes
        Supports opaque LSA
        SPF schedule delay 5 secs , Hold time between two SPFs 10 secs
        Minimum LSA interval 5 secs. Minimum LSA arrival 1 secs
        Number of external LSA O. Checksum Sum OxOOOOOO
        Number of opaque AS LSA O. Checksum Sum OxOOOOOO
        Number咱of OCbitless external and opaque AS LSA U 仆
        Number of OoNotAge external and opaque AS LSA 0
        Number of areas in this router is 1. 1 normal 0 stub 0 nssa
        External flood list length 0
            Area BACKBONE(O)
                Number of interfaces in this area is 5
                Area has no authentication
                SPF algorithm executed 5 times
                Area ranges are
                Number咱of LSA 5. Checksum Sum Ox0283f4
                Number of opaque link LSA O. Checksum Sum OxOOOOOO
                Number of OCbitless LSA 0
                Number of indication LSA 0
                Number of OoNotAge LSA 0
                Flood list length 0
    ```
    
- `show ip ospf database` 命令将给出在互联网络中路由器的编号(AS)，及相邻路由器的ID(也就是前面提到过的拓扑数据库); 与`show ip eigrp topology`命令不同，这个命令只显示OSPF路由器，而不是AS中的全部链路

    ```sh
    Corp#sh ip ospf database
          OSPF Router with ID (10.1.5.1) (Process ID 132)
          Router Link States (Area 0)
        Link ID   ADV Router   Age  Seq# Checksum  Link count
        192.168.20.1 192.168.20.1  1585  0x80000006 0x00ae08 6
        192.168.40.1 192.168.40.1  1005  0x80000005 0x0069c7 4
        10.1.5.1  10.1.5.1   688  0x80000009 0x008108 8
        172.16.10.1 172.16.10.1  688  0x80000004 0x0021a6 2
        
          Net Link States (Area 0)
        Link ID  ADV Router  Age  Seq# Checksum
        10.1.5.1  10.1.5.1  688  0x80000001 0x00c977
    ```

    `show ip ospf interface` 给出了所有与接口相关的OSPF信息

    ```sh
    Corp#sh ip ospf int f0/0
        FastEthernet0/0 is up, line protocol is up
        Internet address is 10.1.5.1/24, Area 0
        Process ID 132, Router ID 10.1.5.1, Network Type BROADCAST, Cost: 1
        Transmit Delay is 1 sec, State DR, Priority 1
        Designated Router (ID) 10.1.5.1, Interface address 10.1.5.1
        Backup Designated Router (ID) 172.16.10.1, Interface address 10.1.5.2
        Timer intervals configured, Hello 10, Dead 40, Wait 40, Retransmit 5
        Hello due in 00:00:04
        Index 5/5, flood queue length 0
        Next 0x0(0)/0x0(0)
        Last flood scan length is 1, maximum is 1
        Last flood scan time is 0 msec, maximum is 0 msec
        Neighbor Count is 1, Adjacent neighbor count is 1
        Adjacent with neighbor 172.16.10.1 (Backup Designated Router)
        Suppress hello for 0 neighbor(s)
    ```

    >   The following information is displayed by this command:
    >
    > - Interface IP address
    > - Area assignment
    > - Process ID
    > - Router ID
    > - Network type
    > - Cost
    > - Priority
    > - DR/BDR election information (if applicable)
    > - Hello and Dead timer intervals
    > - Adjacent neighbor information

- `show ip ospf neighbor` 命令汇总了OSPF中关于邻居和邻接状态的信息

    ```sh
    Corp#sh ip ospf neighbor
    Neighbor ID Pri State Dead Time Address Interface
    172.16.10.1 1 FULL/DR 00:00:39 10.1.5.2 FastEthernet0/0
    192.168.20.1 0 FULL/ - 00:00:38 10.1.2.2 Serial0/0/0
    192.168.20.1 0 FULL/ - 00:00:38 10.1.3.2 Serial0/0/1
    192.168.40.1 0 FULL/ - 00:00:36 10.1.4.2 Serial0/1/0
    ```

    > - 在R3和Corp 路由器间有一个Ethernet Link(广播多路访问)，因此这里会由一个选举过程来决定谁是指定路由器(DR) 以及谁是备份指定路由器(BDR)。
    > - 点到点链路(使用了串口Serial Port)上不会进行DR/BDR的选举，并且它们显示为 FULL/_

- `show ip protocols` 不论在路由器上运行OSPF 、EIGRP 、IGRP 、RIP 、BGP ， IS-IS ，或者其他能配置在路由器上的路由选择协议，此命令都非常有用。它提供了一个关于所有当前运行协议的真实操作情况的概述.



#### 调试命令

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303300419665.png" alt="image-20220708133242604" style="zoom:80%;" />

### 配置OSPF汇总路由

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202303300419731.png" alt="image-20220708144521221" style="zoom:70%;" />

> 要汇总区域1到主干区域。中，在OSPF进程ID下使用下列命令。下面是核心(主干)路由器的一个完整OSPF配置:
>
>   ```sh
>   Core(config)#router ospf 1
>   Core(config-router)#network 192.168.10.64 0.0.0.3 area 1
>   Core(config-router)#network 192.168.10.68 0.0.0.3 area 1
>   Core(config-router)#network 10.10.10.0 0.0.0.255 area 0
>   Core(config-router)#area 1 range 192.168.10.64 255.255.255.224
>   ```
>
>

### OSPF terms 自查表

> - `Link` A link is a network or router interface assigned to any given network. When an interface is added to the OSPF process, it’s considered by OSPF to be a link. This link, or interface, will have state information associated with it (up or down) as well as one or more IP addresses.
>
> - `OSPF Areas` An OSPF area is a grouping of contiguous networks and routers. All routers in the same area share a common Area ID. Because a router can be a member of more than one area at a time, the Area ID is associated with specific interfaces on the router. This would allow some interfaces to belong to area 1 while the remaining interfaces can belong to area 0. All of the routers within the same area have the same topology table. When configuring OSPF, you’ve got to remember that there must be an area 0 and that this is typically considered the backbone area. Areas also play a role in establishing a hierarchical network organization—something that really enhances the scalability of OSPF!
>
> - `Router ID` The Router ID (RID) is an IP address used to identify the router. Cisco chooses the Router ID by using the highest IP address of all configured loopback interfaces. If no loopback interfaces are configured with addresses, OSPF will choose the highest IP address of all active physical interfaces.
>
> 
>
> - `Neighbor` Neighbors are two or more routers that have an interface on a single-Area network, such as two routers connected on a point-to-point serial link.
>
> - `Adjacency` An adjacency is a relationship between two OSPF routers that permits the direct exchange of route updates. OSPF is really picky about sharing routing information—unlike EIGRP, which directly shares routes with all of its neighbors. Instead, OSPF directly shares routes only with neighbors that have also established adjacencies. And not all neighbors will become adjacent—this depends upon both the type of network and the configuration of the routers.
>
> - `Hello protocol` The OSPF Hello protocol provides dynamic neighbor discovery and maintains neighbor relationships. Hello packets and Link State Advertisements (LSAs) build and maintain the topological database. Hello packets are addressed to multicast address **224.0.0.5**.
>
> - `Neighborship database` The neighborship database is a list of all OSPF routers for which Hello packets have been seen. A variety of details, including the Router ID and state, are maintained on each router in the neighborship database.
>
> - `Topological database` The topological database contains information from all of the Link State Advertisement packets that have been received for an area. The router uses the information from the topology database as input into the Dijkstra algorithm that computes the shortest path to every network.
>
> - `LSA(Link State Advertisement)` A LSA is an OSPF data packet containing link-state and routing information that’s shared among OSPF routers. There are different types of LSA packets, and I’ll go into these shortly. An OSPF router will exchange LSA packets only with routers to which it has established adjacencies. ==LSA packets are used to update and maintain the topological database.==
>
> ##### DR/BDR
>
> - `Designated Router` A designated router (DR) is elected whenever OSPF routers are connected to the same multi-access network. Cisco likes to call these “broadcast” networks, but really, they are networks that have multiple recipients(接收者). Try not to confuse multi-access with multipoint, which can be easy to do sometimes.
> - `Backup Designated Router` A backup designated router (BDR) is a *hot standby* for the DR on multi-access links (remember that Cisco sometimes likes to call these “broadcast” networks). The BDR receives all routing updates from OSPF adjacent routers but doesn’t flood LSA updates.
>
> ##### Network types in OSPF
>
> - `Broadcast (multi-access)` Broadcast (multi-access) networks such as Ethernet allow multiple devices to connect to (or access) the same network as well as provide a broadcast ability in which a single packet is delivered to all nodes on the network. In OSPF, a DR and a BDR must be elected for each broadcast multi-access network.
>
> - `Non-broadcast` multi-access Non-broadcast multi-access (NBMA) networks are types such as Frame Relay, X.25, and Asynchronous Transfer Mode (ATM). These networks **allow for multi-access but have no broadcast ability like Ethernet**. So, NBMA networks require special OSPF configuration to function properly and neighbor relationships must be defined.
>
>   -   DR and BDR are elected on **Broadcast** and **NMBA(Non-Broadcast Multi-Access)** networks. Elections are covered in detail later in this chapter.
>
> - `Point-to-point` Point-to-point refers to a type of network topology consisting of a *direct connection between two routers that provides a single communication path*. The point-to-point connection can be physical, as in a serial cable directly connecting two routers, or it can be logical, as in two routers that are thousands of miles apart yet connected by a circuit in a Frame Relay network. In either case, ==this type of configuration eliminates the need for DRs or BDRs but neighbors are discovered automatically.==
>
> - `Point-to-multipoint` Point-to-multipoint refers to a type of network topology consisting of **a series of connections between a single interface on one router and multiple destination routers**. All of the interfaces on all of the routers sharing the point-to-multipoint connection belong to the same network. As with ==point-to-point, DRs or BDRs are not needed.==

### Quiz

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010403276.png" alt="image-20230401040322940" style="zoom:33%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010404624.png" alt="image-20230401040422340" style="zoom:33%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010408757.png" alt="image-20230401040834534" style="zoom:33%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010409885.png" alt="image-20230401040911586" style="zoom:33%;" />

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304010411243.png" alt="image-20230401041109054" style="zoom:60%;" />

![image-20230401102157149](https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304011021309.png)

<img src="https://cdn.jsdelivr.net/gh/Jonas-Wolfxin/MyPicgo/img/202304020434136.png" alt="image-20230402043432801" style="zoom:33%;" />
