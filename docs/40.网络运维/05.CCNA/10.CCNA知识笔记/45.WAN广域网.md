---
title: WAN广域网
date: 2022-07-13 12:26:14
permalink: /pages/1076ba/
categories:
  - 网络运维
  - CCNA
  - CCNA知识笔记
tags:
  - 
---




视频链接: https://www.bilibili.com/video/BV1qb411k783?p=2&share_source=copy_web



## WAN 基础

### WAN terms

>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121134418.png" alt="image-20220712113428307" style="zoom:77%;" />
>
>   -   **用户室内设备(Customer Premises Equipment, CPE)**: 这种设备通常归用户所有(但并非总是如此)，位于用户室内。
>   -   **分界点(Demarcation point)** 分界点明确地指出了服务提供商职责的终点和用户职责的起点。它通常是电信重内的一台设备，归电信公司所有并由其安装。从该设备到CPE 的电缆连接通常由用户负责管理，一般是到CSU/DSU 或ISDN接口的连接。
>   -   本地环路: 本地环路将分界点连接到最近的交换局(中心局)。
>   -   **中心局(CO)**: 将客户的网络连接到提供商的交换网络。需要知道的是，中心局有时也被称为出现点( Point of Presence , POP)。
>   -   **长途通信网(toll network)** 这是WAN提供商网络中的中继线，包含大量归ISP所有的交换机和设备。

### WAN Connection Bandwidth

>   -   **Digital Signal 0 (DS0)**: This is the basic digital signaling rate of **64Kbps**, equivalent to one channel. Europe uses the E0 and Japan uses the J0 to reference the same channel speed. Typically used in a T-carrier transmission, this is the generic term used by several multiplexed digital carrier systems. This is the smallest capacity digital circuit. 1 DS0 = 1 voice/data line.
>   -   **T1** Also referred to as a **DS1**, this contains 24 DS0 circuits bundled together with a total bandwidth of **1.544 Mbps**.
>   -   **E1** European equivalent of the T1. Contains 30 DS0 circuits bundled together with a bandwidth of *2.048Mbps*.
>   -   **T3** Referred to as a DS3, this has 28 DS1s bundled together, or 672 DS0s, with a bandwidth of *44.736 Mbps*.
>   -   **OC-3** Optical Carrier (OC) 3, uses fiber, is made up of three DS3s bundled together, and contains 2,016 DS0s with a total bandwidth of *155.52 Mbps*.
>   -   **OC-12** Optical Carrier 12 is make up of four OC-3s bundled together and contains 8,064 DS0s with a total bandwidth of *622.08 Mbps*.
>   -   **OC-48** Optical Carrier 48 is made up of four OC12s bundled together and contains 32,256 DS0s with a total bandwidth of *2488.32 Mbps*.

### WAN Connection Types

>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121143908.png" alt="image-20220712114313750" style="zoom:67%;" />
>
>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627203026563.png" alt="image-20220627203026563" style="zoom:50%;" />
>
>   -   ==Leased lines (dedicated)==: usually referred to as a **point-to-point** or **dedicated connection**. 专用线是预先建立好的WAN通信路径，它始于CPE ，穿越DCE交换机，终止于远程场点的CPE; CPE让DTE网络能够随时通信，无需在传输数据前经历麻烦的建立过程。如果资金充足，这是不错的选择，因为它使用同步串行线路，速度可高达45Mbps的。在专用线上，经常使用**HDLC和PPP**封装，后面将详细介绍这些封装。
>
>       <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627202437654.png" alt="image-20220627202437654" style="zoom:60%;" />
>
>   -   ==Circuit switching==: When you hear the term circuit switching, think phone call. The big advantage is cost— *most POTS and ISDN dial-up connections are flat rate.* No data can transfer before an end-to-end connection is established. Circuit switching uses **dial-up modems** or **ISDN** and is used for low-bandwidth data transfers. 
>
>       Okay—I know what you’re thinking: “Modems? Did he say modems? Aren’t those only in museums by now?” After all, with all the wireless technologies available, who would use a modem these days? Well, some people do have ISDN and it is still viable (and I do suppose someone does use a modem now and then), but circuit switching can be used in some of the newer WAN technologies as well.
>
>       <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627202758448.png" alt="image-20220627202758448" style="zoom:50%;" />
>
>   -   ==Packet switching==: This is a WAN switching method that allows you to share bandwidth with other companies to save money. Packet switching can be thought of as a network that’s designed to look like a leased line yet charges you more like circuit switching. But less cost isn’t always better—there’s definitely a downside: If you need to transfer data constantly, just forget about this option. Instead, get yourself a leased line. Packet switching will only really work for you if your data transfers are the bursty type — not continuous. **Frame Relay and X.25** are packet switching technologies with speeds that can range from **56Kbps up to T3(45Mbps)**.
>
>       <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627202720631.png" alt="image-20220627202720631" style="zoom:50%;" />
>
>       >   **MultiProtocol Label Switching (MPLS)** uses a combination of both **circuit switching** and **packet switching**, but it’s not within the scope of this book’s topics. Even so, after you pass your CCNA exam, it would be well worth your time to look into MPLS, so I’ll talk about MPLS briefly in a minute.

### WAN Support

>   Basically, Cisco just **supports HDLC, PPP, and Frame Relay on its serial interfaces**, and you can see this with the `encapsulation ?` command from any serial interface (your output may vary depending on the IOS version you are running):
>
>   ```sh
>   Corp#config t
>   Corp(config)#int s0/0/0
>   Corp(config-if)#encapsulation ?
>      atm-dxi ATM-DXI encapsulation
>      frame-relay Frame Relay networks
>      hdlc Serial HDLC synchronous
>      lapb LAPB (X.25 Level 2)
>      ppp Point-to-Point protocol
>      smds Switched Megabit Data Service (SMDS)
>      x25 X.25
>   ```
>
>   >   Understand that if I had other types of interfaces on my router, I would have other encapsulation options, and remember you **can’t configure an Ethernet encapsulation on a serial interface**. 串行连接用得越来越少了，因为相对于到ISP的快速以太
>   >   网连接，其可扩展性不佳，且成本效率不高。

## prominently known WAN protocols

>   Next, I’m going to define the most prominently known WAN protocols used today: Frame Relay, ISDN, LAPB, LAPD, HDLC, PPP, PPPoE, Cable, DSL, MPLS, and ATM.

### Frame Relay

>   -   A **packet-switched technology** that *made its debut in the early 1990s*, 
>   -   Frame Relay is a *high-performance Data Link and Physical layer specification*. It’s pretty much a successor to X.25, except that much of the technology in X.25 used to compensate for physical errors (noisy lines) has been eliminated. 
>   -   An upside to Frame Relay is that it can be **more cost effective** than *point-to-point links*, plus it typically runs at speeds of 64Kbps up to 45Mbps (T3). 
>   -   Another Frame Relay benefit is that it provides **features for dynamic bandwidth allocation** and **congestion control**.



#### 简介

>   -   默认情况下，帧中继是一种非广播多路访问(NBMA)网络，这意味着它不会通过网络发送任何广播，如RIP更新。
>   -   帧中继是从X.25演变而来的，它几乎继承了X.25中与当今可靠和相对"干净"的通信网络相关的所有功能，但删除了不再需要的纠错功能。与前面讨论HDLC和PPP协议时介绍的简单专用线网络相比，它要复杂得多。专用线网络易于理解，但帧中继却没有那么容易。帧中继复杂多变得多，这就是在网络示意图中经常用"云"表示它的原因所在。稍后还会介绍这个，现在先从概念上简要地介绍帧中继，并指出它与简单的专用线技术有何不同。



>   首先需要指出的是，帧中继是一种分组交换技术。根据已学到的知识，这意味着:
>
>   -   不能使用命令encapsulation hdlc 或encapsulation ppp 来配置它;
>   -   帧中继的工作原理不同于点到点线路(虽然可使其看起来像点到点线路);
>   -   帧中继通常比专用线更便宜，但需要为此付出一些代价。
>
>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121618345.png" alt="image-20220712161833193" style="zoom:80%;" />
>
>   >   例如，如果要从公司总部连接7个新增的远程场点，但路由器只有一个空闲的串行端口，则可使用帧中继来救场!当然，应该指出的是，这也会导致单点故障，不太好。但帧中继是用来节省费用的，而不是用来提高网络弹性的。

##### Committed Information Rate (CIR)

>   -   帧中继将一个分组交换网络同时提供给众多客户使用; 帧中继为每位用户供应专用宽带的一部分，还在电信网络有空闲资源时允许用户超过分配给他的保证带宽。因此，一般说来，帧中继提供商允许客户购买的带宽低于其实际使用的带宽。
>
>   -   帧中继有两种带宽方面的规格:
>
>       -   **Access rate**   The maximum speed at which the Frame Relay interface can transmit.
>       -   **CIR** The maximum bandwidth of data guaranteed to be delivered. In reality, it’s the average amount that the service provider will allow you to transmit.
>
>       >   在两个值相等时，帧中继连接几乎与专用线相同。但可将它们设置为不同的值，下面是一个例子:
>       >   假设你购买的接入速率和CIR 分别是T1 ( 1.544 Mbit/s )和256 Kbit/s。这将保证数据流传输速度不低于256 Kbit/s。超过的部分称为"突发量"，它是超过保证速率256 Kbit/s 的部分，最高可达T1(如果
>       >   合同是这样规定的); If your combined committed burst (the basis for your CIR) and excess burst sizes, known as the **MBR** or maximum burst rate when combined, exceed the **access rate**, you can pretty much say goodbye to your additional traffic. It will most likely be dropped, although this really depends on the subscription level of a particular service provider.

##### Frame Relay Encapsulation Types

>   前面说过， HDLC和PPP不能用于帧中继。配置帧中继时，需要指定一种帧中继封装，如下面的输出所示。不同于HDLC和PPP，帧中继有两种封装类型: **Cisco** 和**IETF**(因特网工程任务小组):
>
>   ```sh
>   RouterA(config)#int s0
>   RouterA(config-if)#encapsulation frame-relay ?
>      ietf Use RFC1490 encapsulation
>      <cr>
>   ```
>
>   >   除非于工指定ietf，否则默认封装为Cisco，这也是连接思科设备时使用的封装类型。如果需要使用帧中继连接思科设备和非思科设备，应选择使用封装类型IETF。

##### Virtual Circuits

>帧中继使用虚电路，而不像专用线那样使用实际电路。这些虚电路将与提供商"云"相连的数以千计的设备连接在一起。在任何两台DTE 设备之间，帧中继都会提供一条虚电路，让它们之间看起来像是有一条实际电路，但实际上，它们的帧被发送到一个共享的大型基础设施。在云内部发生的情况非常复杂，但这种复杂性不会呈现在你面前，因为使用虚电路。
>
>there are two types of virtual circuits:
>
>-   Permanent virtual circuits (PVCs): 这里的"永久"意味着电信公司在其设备中创建映射，只要支付费用，它们就一直存在。
>-   switched virtual circuits

##### Data Link Connection Identifiers (DLCIs)

>   DLCI 标识本地路由器和帧中继交换机之间的逻辑电路;
>
>   **Frame Relay PVCs** are identified to DTE end devices by **Data Link Connection Identifiers (DLCIs)**. A Frame Relay service provider typically assigns DLCI values, which are used on Frame Relay interfaces to distinguish between different virtual circuits. Because many virtual circuits can be terminated on one multipoint Frame Relay interface, many DLCIs are often affiliated with it.

>   Let me explain—suppose you have a *central HQ with three branch offices*. If you were to *connect each branch office to HQ using a T1*, you would need **three serial interfaces on your router at HQ**, one for each T1. Simple, right? 
>
>   -   Well, suppose you use Frame Relay PVCs instead. You could *have a T1 at each branch connected to a service provider and only a single T1 at HQ*. 
>   -   There would be three PVCs on the single T1 at HQ, one going to each branch. And even though there’s only a single interface and a single CSU/DSU, the three PVCs function as three separate circuits.
>   -   Remember what I said about saving money? How much for two additional T1 interfaces and a pair of CSU/DSUs?  Answer: A lot!

>   ###### IARP: 用于将DLCI映射到IP地址
>
>   Okay, before we go on, I want to define **Inverse ARP (IARP)** and discuss how it’s used with DLCIs in a Frame Relay network. 
>
>   -   Yes, it is somewhat similar to ARP in the fact that **it maps a DLCI to an IP address **— kind of like ARP does with MAC addresses to IP addresses. And even though you can’t configure IARP, you can disable it. It runs on a Frame Relay router and maps the DLCI to an IP address for Frame Relay so it knows how to get to the IP address at the other end of the PVC. 
>
>   -   You can see IP-to-DLCI mappings with the `show frame-relay map` command.
>   -   But if you have a non-Cisco router living in your network and it doesn’t support IARP, then you’re stuck with having to **statically** provide IP-to-DLCI mappings with the `frame-relay map` command—something I’ll demonstrate in a bit.

>   ​	DLCI 只在本地有意义; 要让DLCI有全局意义，整个网络都必须使用本地管理接口(LMI) 扩展。这就是通常只有私有网络使用全局DLCI的原因所在。用于标识PVC的DLCI号通常是由提供商分配的，其最小值为16.
>
>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121709060.png" alt="image-20220712170859898" style="zoom:80%;" />
>
>   然而， DLCI并非必须要有全局意义才能在通过网络传输帧的过程中发挥作用。下面来解释这一点: 
>
>   -   RouterA 要将帧发送给RouterB 时， RouterA 查看IARP映射或手工配置的映射，以获悉要前往的IP地址对应的DLCI。
>   -   获悉DLCI后，它将FR报头的DLCI字段设置为该值，并将帧发送出去。
>   -   提供商的入口交换机收到这个帧后，查看DLCI-物理接口关联表，以获悉一个新的"只有本地意义"(从当前交换机到下一跳交换机)的DLCI，以便将其用于报头:它还获悉了出站物理端口。
>   -   这个过程不断重复，直到到达RouterB。因此，基本上可以说， RouterA 使用的DLCI标识了前往RouterB的整条虚电路一一虽然每对设备之间的DLCI可能完全不同。这里的要点是， RouterA 并不知道这类差别，因此DLCI 只有本地意义。需要指出的是， DLCI 实际上被电信公司用于"寻找"PVC的另一端。



##### Local Management Interface (LMI)

>   **Local Management Interface (LMI)** is a signaling standard used between **your router** and **the first Frame Relay switch** it’s connected to. It *allows for passing information about the operation and status of the virtual circuit between the provider’s network and the DTE (your router)*. It communicates information about the following
>
>   -   **Keepalives** These verify that data is flowing.
>   -   **Multicasting** This is an optional extension of the LMI specification that allows, for example, the efficient distribution of *routing information* and *ARP requests* over a Frame Relay network. Multicasting uses the reserved DLCIs from 1019 through 1022.
>   -   **Global addressing** This provides global significance to DLCIs, allowing the Frame Relay cloud to work exactly like a LAN. This has never been run in a production network to this day.
>   -   **Status of virtual circuits** This provides DLCI status. The status inquiries and messages are used as keepalives when there is no regular LMI traffic to send.



>   LMI 消息格式有3 种: Cisco 、ANSI 和Q.933A. 从IOS 11.2 版起， LMI类型是自动检测的。这让接口能够确定交换机支持的LMI类型。
>
>   ```sh
>   RouterA(config-if)#frame-relay lmi-type ?
>      CISCO
>      ansi
>      q933a
>   ```

>   路由器通过使用帧中继封装的接口，从服务提供商的帧中继交换机那里收到LMI信息后，将虚电路的状态(PVC STATUS)更新为下述3 种状态之一:
>
>   -   **Active state** *Everything is up*, and routers can exchange information.
>   -   **Inactive state** The router’s interface is up and working with a connection to the switching office, but *the remote router isn’t up*.
>   -   **Deleted state** *No LMI information is being received* on the interface from the switch, which could be due to a mapping problem or a line failure.



##### Frame Relay Congestion Control

>   how the Frame Relay switch notifies the DTE of congestion problems, Here are the three congestion bits and their meanings:
>
>   -   ==Discard Eligibility (DE)==: 传输分组超过PVC的CIR时，如果提供商的网络正处于拥塞状态，超出CIR 的分组都可丢弃。因此，对于超额分组，将在帧中继报头中使用可丢弃(DE)位进行标识。如果提供商的网络发生拥塞，帧中继交换机将丢弃设置DE位(0)的分组。
>   -   ==Forward Explicit Congestion Notification (FECN)==: When the Frame Relay network recognizes **congestion in the cloud**, the switch will **set the FECN bit to 1 in a Frame Relay packet header**. *This will indicate to the destination DTE that the path the frame just traversed is congested.*
>   -   ==Backward Explicit Congestion Notification (BECN)==: When the switch detects **congestion in the Frame Relay network**, *it’ll set the BECN bit in a Frame Relay frame that’s destined for the source router*. **This notifies the source router that congestion is ahead**. But Cisco routers won’t take action on this congestion information unless you tell them to.

>   假设所有用户都抱怨到公司总部的帧中继连接的速度超级慢。你极其怀疑该链路的负载过重，因此使用命令`show frame-relay pvc`显示帧中继拥塞控制信息:
>
>   ```sh
>   RouterA#sh frame-relay pvc
>      PVC Statistics for interface Serial0/0 (Frame Relay DTE)
>          Active Inactive Deleted Static
>          Local 1 0 0 0
>          Switched 0 0 0 0
>          Unused 0 0 0 0
>      DLCI = 100, DLCI USAGE = LOCAL, PVC STATUS = ACTIVE, INTERFACE = Serial0/0
>          input pkts 1300 output pkts 1270 in bytes 21212000
>          out bytes 21802000 dropped pkts 4 in pkts dropped 147
>          out pkts dropped 0   out bytes dropped 0     in FECN pkts 147
>          in BECN pkts 192    out FECN pkts 147
>          out BECN pkts 259 in DE pkts 0 out DE pkts 214
>          out bcast pkts 0 out bcast bytes 0
>          pvc create time 00:00:06, last time pvc status changed 00:00:06
>      Pod1R1#
>   ```
>
>   >   What you want to look for in this output is the **in BECN pkts 192** output because this is what’s telling the local router that traffic sent to the corporate site is experiencing congestion. BECN means that the path that a frame took to “return” to you is congested.

#### 帧中继的实现

##### 单接口

>   首先介绍一种最简单的配置情形两台路由器通过一条PVC相连。
>
>   ```sh
>   RouterA#config t
>   Enter configuration commands, one per line. End with CNTL/Z.
>   RouterA(config)#int s0/0
>   RouterA(config-if)#encapsulation frame-relay
>   
>   RouterA(config-if)#ip address 172.16.20.1 255.255.255.0
>   
>   RouterA(config-if)#frame-relay lmi-type ansi
>   
>   RouterA(config-if)#frame-relay interface-dlci 101
>   RouterA(config-if)#^Z
>   RouterA#
>   ```
>
>   -   第一步是将封装指定为帧中继。由于没有指定封装类型(Cisco 或IETF)，因此将使用默认封装类型Cisco。如果另一台路由器不是思科路由器，则必须将封装类型指定为IETF。
>   -   接下来，给接口分配了一个IP地址，并根据电信提供商的要求将LMI类型指定为ANSI(默认为Cisco)。
>   -   最后，添加了DLCI101 (同样，这也是由ISP 提供的)，它表示我们要使用的PVC。这里假定该物理接口上只有一条PVC。
>
>   就这么简单!如果两端都配置正确，虚电路就建立起来了。



##### 子接口

>   -   可在同一个串行接口配置多条虚电路，并将每条虚电路都视为独立的, 为此，可创建子接口。可将子接口视为IOS 软件定义的逻辑接口。多个子接口将共享一个硬件接口，但它们就像是独立的物理接口一样，这被称为**多路复用**。
>
>   -   要让帧中继网络中的路由器免受水平分割问题的困扰(即不允许某些路由选择更新通过)，**只需为每条PVC配置一个子接口，并给子接口配置一个唯一的DLCI和IP地址**:
>
>       ```sh
>       RouterA(config)#int s0
>       RouterA(config-if)#encapsulation frame-relay
>       RouterA(config-if)#int s0.?
>       	<0-4294967295> Serial interface number
>       RouterA(config-if)#int s0.16 ?
>           multipoint Treat as a multipoint link
>           point-to-point Treat as a point-to-point link
>       RouterA(config-if)#int s0.16 point-to-point
>       RouterA(config-subif)#
>       ```
>
>       >   -   如果要配置子接口，千万不要给物理接口配置IP地址。
>       >   -   子接口分以下两种: 
>       >       -   **点到点子接口**  使用单条虚电路将两台路由器连接起来时使用这种子接口。每个点到点子接口都位于不同的子网中。*点到点子接口还解决了水平分割问题。*
>       >       -   **多点子接口**  当虚电路组成星形，且连接到帧中继网络云的所有路由器串行接口都位于一个子网内时，在中央路由器上使用这种模式，而分支路由器使用物理接口(总是点到点的)或点到点子接口模式。
>
>       下面介绍使用多个子接口的生产路由器的一种配置，如下面的输出所示。注意到子接口号与DLCI号相同，这并非必须的，但对管理接口大有帮助:
>
>       ```sh
>       interface Serial0
>       no ip address (notice there is no IP address on the physical interface!)
>       no ip directed-broadcast
>       encapsulation frame-relay
>       !
>       interface Serial0.102 point-to-point
>       ip address 10.1.12.1 255.255.255.0
>       no ip directed-broadcast
>       frame-relay interface-dlci 102
>       !
>       interface Serial0.103 point-to-point
>       ip address 10.1.13.1 255.255.255.0
>       no ip directed-broadcast
>       frame-relay interface-dlci 103
>       !
>       interface Serial0.104 point-to-point
>       ip address 10.1.14.1 255.255.255.0
>       no ip directed-broadcast
>       frame-relay interface-dlci 104
>       !
>       interface Serial0.105 point-to-point
>       ip address 10.1.15.1 255.255.255.0
>       no ip directed-broadcast
>       frame-relay interface-dlci 105
>       !
>       ```
>
>       >   注意到这里没有指定L阳类型。这意味着该路由器要么使用默认类型Cisco，要么自动检测LMI类型(如果它运行的是思科IOS 11.2 或更高的版本)。还需指出的是，每个子接口都对应一个DLCI，且位于不同的子网中。

#### 帧中继的验证

```sh
Router#show frame-relay lmi  # 显示本地路由器和帧中继交换机之间交换的LMI 数据流统计信息
Router#show frame-relay pvc  # 列出所有配置的PVC 和DLCI 号，它指出了每条PVC的状态和数据流统计信息，还指出了路由器在每条PVC 上收发的BECN 、FECN 和DE 分组的数量。
Router#show frame-relay map  # 显示网络层IP地址到DLCI的映射

show interface  # 它显示封装以及有关第2层和第3层的信息，还显示线路、协议、DLCI 和LMI信息

Router#debug frame-re1ay lmi  # 实现实时输出, 可判断路由器和交换机是否在交换正确的L勤恒信息，从而验证帧中继连接和排除其故障。
```



### ISDN

>   **Integrated Services Digital Network(ISDN)** is a set of digital services that *transmit voice and data over existing phone lines*. 
>
>   -   ISDN offers a **cost-effective** solution for remote users who need a higher-speed connection than **analog POTS dial-up links** can give them, 
>   -   and it’s also a good choice to use as a *backup link for other types of links*, such as Frame Relay or T1 connections.

### LAPB

>   -   **LAPB Link Access Procedure, Balanced (LAPB)** was created to be a **connection-oriented** protocol at the Data Link layer for **use with X.25**, but it can also be used as a simple data link transport. 
>   -   A not-so-good characteristic of LAPB is that it tends to create a tremendous amount of **overhead** due to its strict time-out and windowing techniques.

### LAPD

>   Link Access Procedure, D-Channel (LAPD) is **used with ISDN** at the Data Link layer (layer 2) as a protocol for the **D (signaling) channel**. 
>
>   -   LAPD was derived from the Link Access Procedure, Balanced (LAPB) protocol and is designed primarily to satisfy the signaling requirements of ISDN basic access.

### HDLC

>   **High-Level Data-Link Control (HDLC, 高级数据链路控制协议)** was derived from Synchronous Data Link Control (SDLC), which was created by IBM as a Data Link connection protocol. 
>
>   -   HDLC works at the Data Link layer and creates *very little overhead compared to LAPB*.
>
>   -   Generic HDLC wasn’t intended to encapsulate multiple Network layer protocols across the same link — the HDLC header doesn’t contain any identification about the type of protocol being carried inside the HDLC encapsulation. Because of this, *each vendor that uses HDLC has its own way of identifying the Network layer protocol, meaning each vendor’s HDLC is proprietary with regard to its specific equipment.*
>
>   -   是一种面向比特的数据链路层协议。它指定了一种通过串行数据链路传输数据的封装方法，该封装具备帧的特征，并使用校验和。
>
>       >   -   在面向字节的协议中，控制信息是根据字节生成的;
>       >   -   而面向比特的协议使用比特来表示控制信息。
>       >
>       >   一些常见的面向比特的协议包括SDLC和HDLC，而TCP和IP是面向字节的协议。
>
>   -   HDLC是一种用于专用线和ISDN拨号连接的点到点协议，没有提供身份验证功能。
>
>   -   思科路由器对同步串行链路默认使用HDLC封装。而思科的HDLC实现是专用的(cHDLC)，不能与其他厂商的HDLC实现通信。**请不要因此指责思科, 每家厂商的HDLC实现都是专用的。**
>
>       <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121439258.png" alt="image-20220712143930078" style="zoom:80%;" />

>   假设你只有一台思科路由器，且需要将其连接到一台非思科路由器，该怎么办呢?不能使用默认的HDLC串行封装，因为不可行。相反，需要使用诸如PPP 等封装，以ISO标准方式标识上层协议。有关PPP标准及其起源的更详细信息，请参阅RFC 1661 。
>
>   下面更详细地讨论PPP以及如何使用PPP封装将路由器连接起来.

### PPP 

>   **Point-to-Point Protocol (PPP)** is a industry-standard protocol. 
>
>   -   Because all multi-protocol versions of HDLC are proprietary,  PPP can be used to create **point-to-point links between different vendors’ equipment**. 
>
>   -   It uses a *Network Control Protocol field* in the **Data Link header** to identify *the Network layer protocol being carried* and **allows authentication** and **multilink connections** to be run over asynchronous and synchronous links.
>
>   -   它是一种数据链路层协议，可用于异步串行(拨号dial-up)介质和同步串行(ISDN) 介质。
>
>   -   它使用链路控制协议(LCP)来建立和维护数据链路连接。借助网络控制协议(NCP)，可在同一条点到点连接上使用多种网络层协议(被路由的协议)。
>
>   -   思科串行链路默认使用串行封装HDLC，且效果很好。为何要使用PPP呢? PPP用于通过数据链路层点到点链路传输第3层分组，且不是专用的。因此，除非网络中的所有路由器都是思科路由器，否则就需在串行接口上使用PPP. 
>
>   -   PPP可封装多种第3层协议分组，并提供身份验证、动态编址、回拨等功能，是替代HDLC的最佳封装解决方案。
>
>       <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627203043971.png" alt="image-20220627203043971" style="zoom:43%;" />



>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121518142.png" alt="image-20220712151832940" style="zoom:67%;" />
>
>   PPP 包含4个主要组成部分:
>
>   -   EIA/TIA-232-C、V.24 、V.35 和ISDN 串行通信的物理层国际标准。
>   -   HDLC 一种封装数据报以便通过串行链路进行传输的方法。
>   -   LCP 一种建立、配置、维护和拆除点到点连接的方法。
>   -   NCP 一种通过PPP链路传输不同网络层协议分组的方法。用于标识和封装网络层协议，允许通过同一条PPP 链路传输多种网络层协议分组。为支持多种网络层协议，开发了针对不同网络层协议的NCP, 包括IPCP(因特网协议控制协议)和IPXCP(网间分组交换控制协议)。



#### 链路控制协议(LCP) 配置选项

>   链路控制协议(LCP) 提供了以下众多PPP封装选项:
>
>   -   **Authentication** This option tells the calling side of the link to send information that can identify the user. The two methods are PAP and CHAP.
>
>   -   **Compression** This is used to increase the throughput of PPP connections by compressing the data or payload prior to transmission. PPP decompresses the data frame on the receiving end.
>
>   -   **Error detection** PPP uses **Quality** and **Magic Number** options to ensure a **reliable, loop-free** data link.
>
>   -   **Multilink** Starting with IOS version 11.1, multilink is supported on PPP links with Cisco routers. This option makes several separate physical paths appear to be one logical path at layer 3. For example, two T1s running multilink PPP would show up as a single 3Mbps path to a layer 3 routing protocol.
>
>   -   **PPP callback** PPP can be configured to call back after successful authentication. PPP callback can be a good thing for you because you can keep track of usage based upon access charges for accounting records and a bunch of other reasons. With callback enabled, a calling router (client) will contact a remote router (server) and authenticate as I described earlier. (Know that both routers have to be configured for the callback feature for this to work.) Once authentication is completed, the remote router will terminate the connection and then re-initiate a connection to the calling router from the remote router.
>
>       >   If you have Microsoft devices in your PPP callback, be aware that Microsoft uses a proprietary callback known as **Microsoft Callback Control Protocol (CBCP)**, which is supported in IOS release 11.3(2)T and later.

#### PPP Session Establishment

>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121528228.png" alt="image-20220712152820027" style="zoom:67%;" />
>
>   When PPP connections are started, the links go through three phases of session establishment:
>
>   1.   Link-establishment phase: 每台PPP 设备都发送LCP 分组，以配置和测试链路。这些分组包含一个名为配置选项( Configuration Option )的字段，让设备能够协商数据长度、压缩方法和身份验证方法。如果没有配置选项，则使用默认配置。
>   2.   Authentication phase: 必要时，可使用CHAP或PAP来验证身份。身份验证是在读取网络层协议信息前进行的，在此期间还可能确定链路质量。
>   3.   Network layer protocol phase: PPP使用网络控制协议(NCP)，以封装多种网络层协议分组并通过同一条PPP数据链路发送它们。每种网络层协议(如IP、IPX、AppleTalk，它们是被路由的协议) 都建立一个到NCP的服务。

#### PPP Authentication Methods

>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627203456207.png" alt="image-20220627203456207" style="zoom:45%;" />
>

---

There are two methods of authentication that can be used with PPP links:

---

##### Password Authentication Protocol (PAP): 

在这两种方法中，PAP的安全性要差些。PAP以明文方式发送密码，且只在建立链路时进行身份验证。建立PPP链路时，远程节点向始发路由器发送用户名和密码，直到身份验证得到确认。这不是特别安全!

>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627203513359.png" alt="image-20220627203513359" style="zoom:45%;" />
>
>   

###### pap认证方式

专线使用了 Serial 接口, 没有 MAC 地址, 直接连接目的端

```shell
R1#show interfaces serial 1/0
Serial1/0 is up, line protocol is up 
  Hardware is M4T
  Internet address will be negotiated using DHCP
  MTU 1500 bytes, BW 1544 Kbit/sec, DLY 20000 usec, 
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation HDLC, crc 16, loopback not set        #  思科设备上的 HDLC 协议进行了专有化改造
  Keepalive set (10 sec)
  Restart-Delay is 0 secs

R1(config)#int s1/0
R1(config-if)#encapsulation ?
  atm-dxi         ATM-DXI encapsulation
  bstun           Block Serial tunneling (BSTUN)
  frame-relay     Frame Relay networks
  hdlc            Serial HDLC synchronous
  lapb            LAPB (X.25 Level 2)
  ppp             Point-to-Point protocol
  sdlc            SDLC
  sdlc-primary    SDLC (primary)
  sdlc-secondary  SDLC (secondary)
  smds            Switched Megabit Data Service (SMDS)
  stun            Serial tunneling (STUN)
  x25             X.25

R1(config-if)#encapsulation ppp
R1(config-if)#ip address 12.1.1.1 255.255.255.0
R1(config-if)#no shutdown 

R1(config)#do ping 12.1.1.2
```

###### 单向设置Authentication:

R1端:

```shell
R1(config)#username CCNA password ?
  0     Specifies an UNENCRYPTED password will follow
  7     Specifies a HIDDEN password will follow
  LINE  The UNENCRYPTED (cleartext) user password
R1(config)#username CCNA password SPOTO
R1(config)#int s1/0   
R1(config-if)#ppp authentication ?
  chap        Challenge Handshake Authentication Protocol (CHAP)
  eap         Extensible Authentication Protocol (EAP)
  ms-chap     Microsoft Challenge Handshake Authentication Protocol (MS-CHAP)
  ms-chap-v2  Microsoft CHAP Version 2 (MS-CHAP-V2)
  pap         Password Authentication Protocol (PAP)

R1(config-if)#ppp authentication pap 
R1(config-if)#
*Jun 28 17:27:29.989: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial1/0, changed state to down
```

```

R2 端:

```shell
R2(config)#int s1/0
R2(config-if)#ppp pap sent-username CCNA password SPOTO

R2#sh running-config interface s1/0
Building configuration...

Current configuration : 174 bytes
!
interface Serial1/0
 ip address 12.1.1.2 255.255.255.0
 encapsulation ppp
 ppp authentication pap
 ppp pap sent-username CCNA password 0 SPOTO
 serial restart-delay 0
```

###### 双向设置Authentication:

R2 端:

```sh
R2(config)#username CCNP password SPO
R2(config)#int s1/0 
R2(config-if)#ppp authentication ?
  chap        Challenge Handshake Authentication Protocol (CHAP)
  eap         Extensible Authentication Protocol (EAP)
  ms-chap     Microsoft Challenge Handshake Authentication Protocol (MS-CHAP)
  ms-chap-v2  Microsoft CHAP Version 2 (MS-CHAP-V2)
  pap         Password Authentication Protocol (PAP)

R2(config-if)#ppp authentication pap
R2(config-if)#
*Jun 28 17:34:31.690: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial1/0, changed state to down
```

R1 端:

```shell
R2(config)#int s1/0
R2(config-if)#ppp pap sent-username CCNP password SPO
R1(config-if)#
*Jun 28 17:37:17.582: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial1/0, changed state to up
```



##### Challenge Handshake Authentication Protocol(CHAP): 

CHAP 在建立链路时进行身份验证，并定期检查链路，确保路由器始终与同一台主机通信。

>   After PPP finishes its initial link-establishment phase, the local router sends a challenge request to the remote device. The remote device sends a value calculated using **a one-way hash function called MD5**. The local router checks this hash value to make sure it matches. If the values don’t match, the link is immediately terminated.
>
>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627203541057.png" alt="image-20220627203541057" style="zoom:45%;" />
>
>   ##### chap认证方式
>
>   ###### 单向配置
>
>   R1 端:
>
>   ```shell
>R1(config)#username CCNA password SPOTO
>   R1(config)#int s1/0
>           R1(config-if)#encapsulation ppp
>   
>   R1(config-if)#ppp authentication chap
>   ```
>   
>   R2 端:
>   
>   ```shell
>   R2(config-if)#ppp chap hostname CCNA
>   R2(config-if)#ppp chap password SPOTO
>   
>           R2(config-if)#
>   *Jun 28 17:50:19.378: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial1/0, changed state to up
>   
>   ```
>   
>   ###### 双向配置
>   
>   R2 端:
>   
>   ````shell
>   R2(config)#username CCNP password SPO
>   R2(config)#int s1/0
>   R2(config-if)#encapsulation ppp 
>   R2(config-if)#ppp authentication chap
>   
>           R2(config)#do sh run int s1/0
>       Building configuration...
>   
>       Current configuration : 181 bytes
>               !
>       interface Serial1/0
>        ip address 12.1.1.2 255.255.255.0
>                encapsulation ppp
>        ppp authentication chap
>                ppp chap hostname CCNA
>        ppp chap password 0 SPOTO
>                serial restart-delay 0
>       end
>   ````
>   
>   R1 端:
>   
>   ```shell
>   R1(config)#int s1/0
>   R1(config-if)#ppp chap hostname CCNP
>   R1(config-if)#ppp chap password SPO
>   
>   R1(config-if)#do sh run int s1/0
>       Building configuration...
>   
>               Current configuration : 154 bytes
>       !
>       interface Serial1/0
>        ip address 12.1.1.1 255.255.255.0
>     encapsulation ppp
>     ppp chap hostname CCNP
>        ppp chap password 0 SPO
>                serial restart-delay 0
>       end
>           ```
>   
>   

#### Configuring PPP on Cisco Routers

```sh
Router#config t
Enter configuration commands, one per line. End with CNTL/Z.
Router(config)#int s0/0
Router(config-if)#encapsulation ppp
Router#
```

#### Configuring PPP Authentication

```sh
Router#config t
Enter configuration commands, one per line. End with CNTL/Z.
Router(config)#hostname RouterA
RouterA(config)#username RouterB password cisco # 指定远程路由器连接到本地路由器时使用的用户名和密码
```

>   -   使用命令username时，别忘了用户名是要连接到本地路由器的远程路由器的主机名，它是区分大小写的。
>   -   另外，两台路由器的密码必须相同。这种密码是以明文方式存储的，可使用命令show run查看;
>   -   也可对密码进行加密，为此可使用命令``service password-encryption`。
>   -   对于要连接的每个远程系统，都必须为其配置用户名和密码; 而在远程路由器上，也必须以类似的方式配置用户名和密码。

```sh
RouterA#config t
Enter configuration commands, one per line. End with CNTL/Z.
RouterA(config)#int s0
RouterA(config-if)#ppp authentication chap pap
RouterA(config-if)#^Z
RouterA#
```

>   如果同时指定了两种方法，则在链路协商期间，只使用第一种方法 一一 第二种方法为备用方法，仅在第一种方法失效时才会使用。



#### 验证PPP封装

![image-20220712155742232](https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121557436.png)

>   You can start verifying the configuration with the show interface command:
>
>   ```sh
>   Pod1R1#sh int s0/0
>      Serial0/0 is up, line protocol is up  # 可知接口serial0/0 处于up/up 状态
>      Hardware is PowerQUICC Serial
>      Internet address is 10.0.1.1/24
>      MTU 1500 bytes, BW 1544 Kbit, DLY 20000 usec,
>      reliability 239/255, txload 1/255, rxload 1/255
>      Encapsulation PPP   # 指出封装为PPP
>      loopback not set
>      Keepalive set (10 sec)
>      LCP Open    # 指出LCP处于打开(open) 状态，这表明会话已建立且一切正常
>      Open: IPCP, CDPCP   # 指出 NCP在侦听协议IP和CDP。
>      [output cut]
>   ```

##### 存在异常的情况示例2:

![image-20220712160058457](https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121600598.png)

>   username 和 password都是区别大小写的, 此处密码不一致. 来查看一下接口信息:
>
>   ```sh
>   Pod1R1#5h int 50/0
>      SerialO/O is Up , line protocol is down
>      Hardware is PowerQUICC Serial
>      Inter啕net address is 10.0.1.1/24
>      MTU 1500 bytes , BW 1544 Kbit , DLY 20000 usec ,
>      reliability 243/255 , txload 1/255 , rxload 1/255
>      Encapsulation PPP , loopback not set
>      Keepalive set (10 sec)
>      LCP Closed     # LCP 处于关闭状态，因为没有通过身份验证
>      Closed: IPCP, CDPCP
>   ```

##### 调试PPP Authentication:

>   -   要实时显示网络中两台路由器之间的CHAP身份验证过程，可使用命令`debug ppp authentication`;
>
>   -   使用身份验证方法CHAP时， PPP进行3次握手;如果用户名和密码配置得不正确，将无法通过身份验证，导致链路处于down状态。

##### 存在异常的情况示例2: WAN 封装不一致

![image-20220712160648916](https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121606057.png)

````sh
Pod1R1#sh int s0/0
    Serial0/0 is up, line protocol is down
    Hardware is PowerQUICC Serial
    Internet address is 10.0.1.1/24
    MTU 1500 bytes, BW 1544 Kbit, DLY 20000 usec,
    reliability 254/255, txload 1/255, rxload 1/255
    Encapsulation PPP, loopback not set
    Keepalive set (10 sec)
    LCP REQsent
    Closed: IPCP, CDPCP
````

>   LCP 发送请求，但没有收到任何响应，因为路由器Pod1 R2使用的封装是HDLC; 请牢记，不能在链路一端使用PPP，而在另一端使用HDLC 一一 它们合不来!

##### 存在异常的情况示例3: IP 地址不匹配

>   ![image-20220712160954149](https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121609283.png)
>
>   ```sh
>   Pod1R1#sh int s0/0
>   Serial0/0 is up, line protocol is up
>   Hardware is PowerQUICC Serial
>   Internet address is 10.0.1.1/24
>   MTU 1500 bytes, BW 1544 Kbit, DLY 20000 usec,
>   reliability 255/255, txload 1/255, rxload 1/255
>   Encapsulation PPP, loopback not set
>   Keepalive set (10 sec)
>   LCP Open
>   Open: IPCP, CDPCP
>   ```
>
>   两台路由器连接到的子网不同， Pod1 R1 的地址为10.0.1.1/24 ，而Pod R2的地址为10.2.1.2/24.
>
>   -   鉴于第1层(物理层)和第2层(数据链路层)都处于up状态，要解决问题，必须查看并验证直接相连的邻居的IP 地址。
>   -   要发现并修复这种问题，可在每台路由器上执行命令`show running-config` 或`show
>       interfaces`，也可执行第7章介绍的命令`show cdp neighbors detail`. 



### PPPoE

>   **Point-to-Point Protocol over Ethernet** encapsulates PPP frames in Ethernet frames and is usually used in conjunction with xDSL services. 
>
>   -   It gives you a lot of the familiar PPP features like authentication, encryption, and compression, but there’s a downside—it has a lower maximum transmission unit (MTU) than standard Ethernet does, and if your firewall isn’t solidly(扎实地) configured, this little attribute can really give you some grief(悲痛)!
>   -   Still somewhat popular in the United States, PPPoE’s main feature is that it adds a direct connection to Ethernet interfaces while providing DSL support as well. It’s often used by many hosts on a shared Ethernet interface for opening PPP sessions to various destinations via at least one bridging modem.
>   -   这是一种隧道协议，可封装运行在ppp之上的IP和其他协议，具有ppp链路的特性，因此可用于连接其他以太网设备，并发起建立点到点连接，以传输IP分组。

>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121347176.png" alt="image-20220712134728033" style="zoom:70%;" />
>
>   -   图16-6 说明了PPPoE典型用途:用于ADSL。正如你看到的，图中建立了一个从PC到路由器的ppp会话，而PC 的IP地址是由路由器通过IPCP分配的。
>   -   PPPoE is used to equip custom PPP-based software with the ability to deal with a connection that’s not using a serial line and to be at home in a packet-oriented network environment like Ethernet. 
>   -   It also allows for a custom connection with login and password for Internet connection accounting. 
>   -   Another factor is that the opposite side of the link’s IP address is only given to it and is available only for the specific period that the PPPoE connection is open, so reusing IP addresses dynamically is permitted.
>   -   PPPoE has a *discovery stage* and a *PPP session stage* (see RFC 2516) that works like this: First, a host begins a PPPoE session, during which it has to execute a discovery process so it can determine the best server to meet the needs of the client machine’s request.  After that, it has to discover the Ethernet MAC address of the peer device and create a PPPoE session ID. So even though PPP **delimits** a peer-to-peer relationship, the discovery part is **innately**(先天性地) a client - server relationship.
>   -   以下配置了解即可:
>
>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220628202544095.png" alt="image-20220628202544095" style="zoom: 50%;" />
>
>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220628203053147.png" alt="image-20220628203053147" style="zoom: 50%;" />
>
>   

### Cable

>   In a modern hybrid fiber-coaxial HFC network, typically 500 to 2,000 active data subscribers are connected to a certain cable network segment, all sharing the upstream and downstream bandwidth. **HFC** is a telecommunications industry term for a network that **incorporates both optical fiber and coaxial cable** to create a broadband network. 
>
>   -   The actual bandwidth for Internet service over a cable TV (CATV) line can be up to about 27Mbps on the download path to the subscriber, with about 2.5Mbps of bandwidth on the upload path. Typically users get an access speed from 256Kbps to 6Mbps. 

<img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121325100.png" alt="image-20220712132505945" style="zoom:80%;" />

### DSL

>   **Digital subscriber line**: 是传统电话公司使用的一种技术，通过普通的**铜质双绞电话线**提供高级服务(高速数据，有时还有视频)。
>
>   -   其数据传输容量通常低于HFC网络，而数据传输速度还受电话线的长度和质量的影响。
>
>   -   DSL不是完全的端到端解决方案，而与拨号、有线电视和无线一样，是一种物理层传输技术。
>
>   -   DSL连接用于本地电话网络的最后一公里，即本地环路。这种连接是在一对DSL调制解调器之间建立的，这两个DSL调制解调器分别位于铜质电话线的两端，而铜质电话线位于**用户室内设备(CPE)**和数**字用户线接人多路复用器(DSLAM)**之间。DSLAM 是一种位于提供商中心局(CO)的设备，负责聚集来自多个DSL用户的连接。
>
>   -   要使用DSL，需要有`电话线`、`DSL调制解调器(通常由购买的服务提供)`、`以太网网卡(或有以太网连接的路由器)`以及当地的服务提供商。
>
>   -   根据上行速度和下行速度是否相同， DSL分为两类:
>
>       -   **Symmetrical DSL**: 上行速度和下行速度相同，即对称;
>       -   **Asymmetrical DSL**: 下行速度比上行速度总是更高。
>
>   -   术语xDSL是众多DSL形式的统称，这包括非对称DSL(ADSL)、高速DSL(HDSL)、速率自适应DSL(RADSL)、对称DSL(SDSL)、ISDN DSL(IDSL) 和超高速DSL(VDSL)。
>
>   -   DSL flavors that don’t use the voice frequencies band, like ADSL and VDSL, allow DSL lines to carry both data and voice signalssimultaneously. Others, like SDSL and IDSL, that occupy the complete frequency range, can carry only data. And by the way, **the data service that the DSL connection gives you is always on**.
>
>   -   The speed that DSL service can offer depends on how far you are from the central office (CO)—the closer the better. In fact, you can blaze at rates up to around 6.1Mbps if you’re physically close enough!
>
>       <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121335321.png" alt="image-20220712133540147" style="zoom:80%;" />

#### ASDL

>   -   ADSL 可同时传输语音和数据，但其下行带宽比上行带宽高: ADSL 的下行速度为256 Kbi的-8 Mbi饨，但上行速度最多只有1.5 Mbit/s 左右。
>   -   **Plain old telephone service (POTS)** provides a channel for analog voice transmission and can transmit without a problem with ADSL over the same twisted-pair telephone line. Actually, depending on the type of ADSL, not just two, but three information channels commonly utilize the same wiring at the same time. This is why people can use a phone line and an ADSL connection at the same time and not affect either service.
>   -   **ATM** is the Data Link layer protocol typically used over the DSL layer 1 connection *from the CPE* and is terminated at what’s known as the *DSLAM* — *an ATM switch that contains DSL interface cards, or ATU-Cs*. After ADSL connections meet their end at the DSLAM, it switches the data over an ATM network to something called an **aggregation router** — a layer 3 device where the subscriber’s IP connection then expires.

>   要通过ATM和DSL连接传输IP分组. 必须对其进行封装。根据用户的接口类型和服务提供商的交换机，共有3种封装方法:
>
>   -   PPPoE
>   -   RFC1483 Routing: RFC1483 describes two different methods for carrying connectionless network traffic over an ATM network: **routed protocols** and **bridged protocols**.
>   -   PPPoA: **Point-to-Point Protocol (PPP) over ATM** is used to encapsulate PPP frames in ATM AAL5 (ATM Adaptation Layer 5). It is typically used with cable modems, DSL, and ADSL services and offers the usual PPP features of authentication, encryption, and compression, and it actually has less overhead in comparison to PPPoE.

#### Cisco Long Range Ethernet (LRE)

>   The **Cisco Long Range Ethernet** solution employs something called **VDSL (very-high-data-rate digital subscriber line)** technology to significantly expand Ethernet service capacity. And LRE can achieve these impressive results: speeds from 5 to 15Mbps (full duplex) at distances up to 5,000 feet traveling over existing twisted-pair wiring!
>   So basically, Cisco LRE technology can give us broadband service on *POTS, digital telephone, and ISDN traffic lines, and it also can operate in modes that are compatible with ADSL technologies.* This flexibility is important because it makes it possible for service providers to make LRE available in structures and/or buildings that have broadband services already in place but need it enhanced—very cool indeed.



### MPLS

>   **MultiProtocol Label Switching (MPLS)** is a data-carrying mechanism that *emulates some properties of a circuit-switched network over a packet-switched network*. 
>
>   -   MPLS is a switching mechanism that imposes labels (numbers) to packets and then uses those labels to forward packets. The labels are assigned on the edge of the MPLS network, and forwarding inside the MPLS network is done solely based on labels.
>   -   Labels usually correspond to a path to layer 3 destination addresses (equal to IP destination-based routing). 
>   -   MPLS was designed to support forwarding of protocols other than TCP/IP. Because of this, label switching within the network is performed the same regardless of the layer 3 protocol. 
>   -   In larger networks, the result of MPLS labeling is that only the edge routers perform a routing lookup. All the core routers forward packets based on the labels, which makes forwarding the packets through the service provider network faster. (Most companies are replacing their Frame Relay networks with MPLS service today.)

### ATM

>   **Asynchronous Transfer Mode (ATM)** was created for time-sensitive traffic, providing simultaneous transmission of voice, video, and data.
>
>   -   ATM uses cells that are a fixed 53 bytes long instead of packets. It also can use isochronous(异步的) clocking (external clocking) to help the data move faster. Typically(通常情况下), if you are running Frame Relay today, you will be running Frame Relay over ATM.

### DWDM

>   **Dense Wavelength Division Multiplexing** is optical technology used to increase bandwidth using fiber backbones. 
>
>   -   DWDM works by combining and transmitting multiple signals simultaneously at different wavelengths on the same fiber link, creating a type of multilink with the signals running down the fiber. In theory, a 1.5Gbs link could have the capacity of 10Mbps. 
>   -   An advantage of DWDM is that it is both protocol and bit-rate independent and can run with IP over ATM, SONET, and even Ethernet.

## Cabling the Serial Wide Area Network

>   **Cisco serial connections** support almost any type of WAN service. Your typical WAN connection is a **dedicated leased line** using **HDLC, PPP, and Frame Relay** with speeds that can kick it up to 45Mbps (T3).



### Serial Transmission

>   -   HDLC 、PPP 和Frame Relay可使用相同的物理层规范，我将介绍各种类型的连接，然后全面介绍CCNA考试涉及的WAN协议。
>
>   -   WAN serial connectors use serial transmission, something that takes place 1 bit at a time over a single channel.
>
>   -   Older Cisco routers have used a proprietary 60-pin serial connector that you have to get from Cisco or a provider of Cisco equipment. Cisco also has a **new, smaller proprietary serial connection** that’s about one-tenth the size of the 60-pin basic serial cable called the **smart-serial**. You have to make sure you have the right type of interface in your router before using this cable connector.
>
>   -   The type of connector you have on the other end of the cable depends on your service provider and their particular end-device requirements.
>
>       There are several different types of ends you’ll run into:
>
>       -   EIA/TIA-232
>       -   EIA/TIA-449
>       -   V.35 (used to connect to a CSU/DSU)
>       -   EIA-530
>
>       >   Make sure you’re clear on these things: 
>       >
>       >   -   **Serial links** are described in **frequency** or cycles per second (hertz). 
>       >   -   The amount of data that can be carried within these frequencies is called **bandwidth**. Bandwidth is the amount of data in bits per second that the serial channel can carry.

### ==Data Terminal Equipment== & ==Data Communications Equipment==

>   <img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207121430941.png" alt="image-20220712143036705" style="zoom:80%;" />
>
>   -   WAN旨在通过DCE网络将两个DTE网络连接起来。DCE网络由如下部分组成:两端的CSU/DSU以及它们之间的提供商电缆和交换机，其中的DCE设备(CSU/DSU)向连接到DTE的接口(路由器的串行连接)提供时钟。
>
>       >   如果组建的是非生产网络，使用WAN交叉电缆，且没有CSU/DSU，在这种情况下，必须在电缆的DCE端使用命的``clock rate`以提供时钟，这在第6章介绍过。
>
>   -   默认情况下，路由器接口通常是==data terminal equipment(DTE)==，可连接到==data communication equipment(DCE)==，如**channel service unit/data service unit(CSU/DSU)**。而CSU/DSU连接到分界点demarcation location 一一 服务提供商职责终止处。在大多数情况下，分界点demarc 是一个位于电信室的插座，装有RJ-45(8针模块)母接头。
>
>   -   诸如EIA/TIA-232, V.35, X.21 和HSSI(高速串行接口)等术语描述的是DTE(路由器)和DCE设备(CSU/DSU) 之间的物理层。



# WAN广域网技术

<img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627201627190.png" alt="image-20220627201627190" style="zoom:87%;" />

## 广域网的链路类型:

### 专线: 运营商提供的服务, 如 T1, T3等

-   专有的逻辑连接, 一直在线, 安全、高传输质量
-   支持多种物理介质与物理接口标准
-   稳定可靠， 配置维护简单
-   适合长时间的业务流量需求； 价格相对较高





### VPN: MPLS VPN, MSTP VPN, 

<img src="https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220627202841709.png" alt="image-20220627202841709" style="zoom:67%;" />



## VPN(Virtual Private Networks)

>   ==虚拟专网(VPN) 让你能够利用因特网组建专用网络，通过隧道安全地传输非TCP/IP协议的分组。==
>
>   -   VPN 让远程用户和远程网络能够使用公共介质(如因特网)连接到公司网络，而无需使用昂贵的永久性连接。
>   -   Types of VPNs are named based upon the role they play in a business. There are three different categories of VPNs:
>       -   **Remote access VPNs**: 远程接入VPN让远程用户(如远程办公人员)能够随时随地地安全访问公司网络。
>       -   **Site-to-site VPNs**: Site-to-site VPNs, or **intranet VPN**s, allow a company to connect its remote sites to the corporate backbone securely over a public medium like the Internet instead of requiring more expensive WAN connections like Frame Relay.
>       -   **Extranet VPNs** Extranet VPNs allow an organization’s suppliers, partners, and customers to be connected to the corporate network in a limited way for business-to-business (B2B) communications.

>   鉴于VPN安全且价格低廉，你可能很想知道如何组建VPN。组建VPN的方法有多种:
>
>   -   第一种是使用==IPSec==. 它在IP网络的端点之间提供身份验证和加密服务;
>
>   -   第二种是使用隧道胁议，在端点之间建立隧道。隧道将一种协议或数据封装在另一种协议中! 
>
>       Four of the most common tunneling protocols in use:
>
>       -   **Layer 2 Forwarding (L2F)**: 是一种思科专用的隧道协议，它是思科为支持虚拟专用拨号网络(VPDN) 而开发的第一种隧道协议。VPDN 允许设备通过拨号连接安全地访问公司网络。L2F 已被L2TP 取代，而L2TP向后与L2F兼容。
>       -   **Point-to-Point Tunneling Protocol (PPTP)**: was created by Microsoft to allow the secure transfer of data from remote networks to the corporate network.
>       -   **Layer 2 Tunneling Protocol (L2TP)**: was created by Cisco and Microsoft to replace L2F and PPTP. L2TP merged the capabilities of both L2F and PPTP into one tunneling protocol.
>       -   **Generic Routing Encapsulation (GRE)**: 也是一种思科专用的隧道协议。它建立虚拟点到点链路，允许在IP隧道中封装各种协议分组。



### IPsec

>   -   IPSec是一个行业标准框架，包含用于通过IP网络安全地传输数据的协议和算法，它运行在OSI模型的第3层(网络层)。
>   -   IPSec不能用于加密非IP数据流。这意味着如果需要对非IP数据流进行加密，必须创建一个GRE隧道，并使用IPSec对该隧道进行加密!

#### IPSec Transforms

>   take a second to define the security protocols and briefly introduce the supporting encryption and hashing algorithms that IPSec relies upon.

##### 安全协议

>   IPSec 使用的两种主要的安全协议:
>
>   -   验证头(Authentication Header, AH): 
>
>       The AH protocol provides authentication for **the data** and **the IP header** of a packet using **a one-way hash for packet authentication**. It works like this: The sender generates a one-way hash; then the receiver generates the same one-way hash. If the packet has changed in any way, it won’t be authenticated and will be dropped. **So basically, IPSec relies upon AH to guarantee authenticity**. AH checks the entire packet, but it doesn’t offer any encryption services.
>       This is unlike ESP, which only provides an integrity check on the data of a packet.
>
>   -   封装安全有效负载(Encapsulating Security Payload, ESP):
>
>       ESP will provide confidentiality, data origin authentication, connectionless integrity, anti-replay service, and limited traffic-flow confidentiality by defeating traffic flow analysis — which is almost as good! Anyway, there are four components of ESP:
>
>       -   Confidentiality: 保密性是通过使用DES或3DES等对称加密算法提供的。保密性的设置可独立于其
>           他服务，但VPN两端的保密性设置必须相同。
>       -   Data origin authentication and connectionless integrity: 数据来源验证和无连接完整性是与保密性协同工作的服务。
>       -   Anti-replay service: 当启用了数据来源验证时，才能使用反重播服务。反重播服务依赖于接收方，
>           即仅当接收方检查序列号时，这种服务才能发挥作用。重播攻击指的是黑客制作通过了验证的分组副本，然后将其传输给目的地。当这个经过验证的四分组的副本到达目的地后，可中断服务以及导致其他糟糕的后果. The Sequence Number field is designed to foil this type of attack.
>       -   Traffic flow: 为提供数据传输流程保密性，必须选择隧道模式。在大量数据流聚集的安全网关实现这种功能的效果最佳，这样可对试图攻击网络的人隐藏数据传输流程。

##### Encryption:

>   VPN 使用公共网络基础设施组建私有网络，然而，为提供保密性和安全，需要将IPSec用于VPN。
>
>   IPSec使用各种类型的协议进行加密。当今使用的加密算法类型如下:
>
>   -   **Symmetric encryption** This encryption requires a shared secret to encrypt and decrypt. 对称加密算法包括数据加密标准(DES)、三重DES (3DES) 和高级加密标准(AES)。
>
>   -   **Asymmetric Encryption**: 这种加密算法使用不同的密钥进行加密和解密，这两种密钥分别称为私钥和
>       公钥。
>
>       >   -   Private keys encrypt a hash from the message to create a digital signature that is then verified via decryption using the public key; 
>       >   -   Public keys encrypt a symmetric key for secure distribution to the receiving host, who then decrypts that symmetric key using their exclusively held private key. 
>       >   -   It is not possible to encrypt and decrypt using the same key. This is a variant of public key encryption that uses a combination of both a public and private key. An example of an asymmetric encryption is **Rivest, Shamir, and Adleman (RSA)**.

>   要在两个场点之间建立VPN, 思科提供了GUI接口以完成这个过程，这对于给VPN配置IPSec很有帮助，但超出了本书的范围。对管理力量有限的公司来说，思科的Easy VPN 让VPN配置起来容易得多。为帮助管理和部署
>   VPN ，思科提供了3 个组件:
>
>   -   Cisco Easy VPN Server 安装了Firewall IOS 或PIXIASA Firewall 的思科路由器，在场点到场点VPN 或远程接入VPN中充当VPN集中器;
>   -   Cisco Easy VPN Remote 安装了Firewall IOS 或PIXIASA Firewall 的思科路由器，充当VPN客户端，为远程网络中的主机提供服务;
>   -   Cisco Easy VPN Client 安装在PC 上，用于访问Cisco VPN Server。

### GRE VPN

>   -   **Generic Routing Encapsulation** (**GRE**) is a [tunneling protocol](https://en.wikipedia.org/wiki/Tunneling_protocol) developed by [Cisco Systems](https://en.wikipedia.org/wiki/Cisco_Systems) that can [encapsulate](https://en.wikipedia.org/wiki/Encapsulation_(networking)) a wide variety of [network layer](https://en.wikipedia.org/wiki/Network_layer) [protocols](https://en.wikipedia.org/wiki/Protocol_(computing)) inside virtual [point-to-point links](https://en.wikipedia.org/wiki/Point-to-point_(telecommunications)) or point-to-multipoint links over an [Internet Protocol](https://en.wikipedia.org/wiki/Internet_Protocol) network.
>
>   -   Generic Routing Encapsulation(IP), 路由器在内网报文的头部 添加公网地址(明文传输)
>
>   ![image-20220716215125519](https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/202207162151730.png)
>
>   -   https://ipwithease.com/gre-vs-ipsec/

![image-20220628210104396](https://cdn.jsdelivr.net/gh/Wolfxin/MyPicGo/img/image-20220628210104396.png)

R1:

```sh
# 开启 VPN 的 tunnel
R1(config)#interface tunnel 0
R1(config-if)#tunnel source 101.202.1.1
R1(config-if)#tunnel destination 202.101.1.1
# 为 tunnel添加 IP地址(私有地址)
R1(config-if)#ip add 192.168.3.1 255.255.255.0

# 开启 OSPF 路由协议
R1(config-if)#exi 
R1(config)#router ospf 1
R1(config-router)#router-id 1.1.1.1
R1(config-router)#network 192.168.0.0 0.0.255.255 area 0
```

配置加密传输

```shell
R1(config)#crypto isakmp policy 10
R1(config-isakmp)#encryption ?
  3des  Three key triple DES
  aes   AES - Advanced Encryption Standard.
  des   DES - Data Encryption Standard (56 bit keys).
R1(config-isakmp)#encryption aes

R1(config-isakmp)#hash ?
  md5     Message Digest 5
  sha     Secure Hash Standard
  sha256  Secure Hash Standard 2 (256 bit)
  sha384  Secure Hash Standard 2 (384 bit)
  sha512  Secure Hash Standard 2 (512 bit)
R1(config-isakmp)#hash md5 

R1(config-isakmp)#authentication pre-share 
R1(config-isakmp)#lifetime 86400
R1(config-isakmp)#group 2
R1(config-isakmp)#exi
R1(config)#crypto isakmp key CCIE address 202.101.1.1
R1(config)#crypto ipsec transform-set MYSET esp-aes 
R1(cfg-crypto-trans)#mode transport
R1(cfg-crypto-trans)#exi

R1(config)#crypto ipsec profile MYPRO
R1(ipsec-profile)#set transform-set MYSET

R1(config)#do sh run | section cry
    no service password-encryption
    crypto isakmp policy 10
     encr aes
     hash md5
     authentication pre-share
     group 2
    crypto isakmp key CCIE address 202.101.1.1    
    crypto ipsec transform-set MYSET esp-aes 
     mode transport
    crypto ipsec profile MYPRO
     set transform-set MYSET 
```

```sh
R1(config)#interface tunnel 0
R1(config-if)#tunnel protection ipsec profile MYPRO

```



R2 端:

```sh
R2(config)#int tunnel 0
R2(config-if)#tunnel source 202.101.1.1
R2(config-if)#tunnel destination 101.202.1.1

R2(config-if)#ip add 192.168.3.2 255.255.255.0
R2(config-if)#exi

R2(config)#router ospf 1
R2(config-router)#router-id 2.2.2.2
R2(config-router)#network 192.168.0.0 0.0.255.255 area 0
```

配置加密传输

```shell
R2(config)#

# 粘贴以下:
crypto isakmp policy 10
encr aes
hash md5
authentication pre-share
group 2
crypto isakmp key CCIE address 101.202.1.1    
crypto ipsec transform-set MYSET esp-aes 
mode transport
crypto ipsec profile MYPRO
set transform-set MYSET 
```



### MPLS VPN

>   MPLS（多协议标签交换）是一种网络协议，用于加速和管理数据包在网络中的转发，同时提高网络的可靠性、灵活性和安全性。
>
>   MPLS协议将网络数据包包装在一个包含标签的封装头中，这个标签可以告诉路由器如何处理这个数据包，从而使数据包的转发过程更快速和有效。MPLS不依赖于任何特定的数据链路层技术，可以在不同的网络环境下运行，如局域网（LAN）、广域网（WAN）或互联网。
>
>   MPLS的主要功能包括：
>
>   1.  基于标签的数据包转发：通过给数据包打上标签，将其与特定的流量工程、服务质量和安全性策略相关联，实现更快速和更可靠的数据包转发。
>   2.  服务质量（QoS）保证：通过使用MPLS，网络管理员可以对不同类型的数据流量进行分类和优先级管理，从而保证关键数据流量的优先传输和服务质量。
>   3.  灵活的虚拟专用网络（VPN）支持：MPLS可以实现虚拟专用网络（VPN）功能，允许不同的组织或用户在共享基础设施上建立私有网络。
>
>   MPLS已被广泛应用于各种网络环境，包括企业内部网络、服务提供商的网络和互联网中。

#### 基本配置

Configuring MPLS on two Cisco routers involves a series of steps. Here is an overview of the steps involved:

1.  Configure basic IP connectivity between the two routers.
2.  Enable MPLS on each router.
3.  Configure a loopback interface on each router to use as the router ID for MPLS.
4.  Configure the label distribution protocol (LDP) to advertise labels between the routers.
5.  Configure the MPLS forwarding table.
6.  Test MPLS connectivity between the routers.



Here are the detailed steps to configure MPLS on two Cisco routers:

1.  Configure basic IP connectivity between the two routers:

```sh
Router1(config)#interface fastEthernet 0/0 
Router1(config-if)#ip address 10.1.1.1 255.255.255.0 
Router1(config-if)#no shutdown

Router2(config)#interface fastEthernet 0/0 
Router2(config-if)#ip address 10.1.1.2 255.255.255.0 
Router2(config-if)#no shutdown
```



2.   Enable MPLS on each router:

```sh
Router1(config)#mpls ip

Router2(config)#mpls ip
```



3.   Configure a loopback interface on each router to use as the router ID for MPLS:

```sh
Router1(config)#interface loopback 0 
Router1(config-if)#ip address 1.1.1.1 255.255.255.255

Router2(config)#interface loopback 0 
Router2(config-if)#ip address 2.2.2.2 255.255.255.255
```

4.   Configure the label distribution protocol (LDP) to advertise labels between the routers:

```sh
Router1(config)#mpls label protocol ldp 
Router1(config)#interface fastEthernet 0/0 
Router1(config-if)#mpls ip

Router2(config)#mpls label protocol ldp 
Router2(config)#interface fastEthernet 0/0 
Router2(config-if)#mpls ip
```



5.   Configure the MPLS forwarding table:

```sh
Router1(config)#ip route 10.2.2.0 255.255.255.0 10.1.1.2 
Router1(config)#mpls label protocol ldp 
Router1(config)#mpls ldp router-id loopback0

Router2(config)#ip route 10.1.1.0 255.255.255.0 10.2.2.1 
Router2(config)#mpls label protocol ldp 
Router2(config)#mpls ldp router-id loopback0
```



6.   Test MPLS connectivity between the routers:

```sh
Router1#ping 10.2.2.2 source loopback0 
Router1#show mpls forwarding-table

Router2#ping 10.1.1.1 source loopback0 
Router2#show mpls forwarding-table
```



These steps provide a basic configuration for MPLS on two Cisco routers. However, there are many additional configuration options and features that can be enabled to customize MPLS for specific network requirements.
